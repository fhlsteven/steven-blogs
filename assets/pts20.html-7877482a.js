import{_ as n,o as s,c as a,a as t}from"./app-a2b6e588.js";const p={},o=t(`<h1 id="如何用c-编写一个有实用型的window-server-类似iis-的那种" tabindex="-1"><a class="header-anchor" href="#如何用c-编写一个有实用型的window-server-类似iis-的那种" aria-hidden="true">#</a> 如何用C#编写一个有实用型的window server(类似IIS)的那种</h1><div class="language-txt" data-ext="txt"><pre class="language-txt"><code>主　　题：  如何用C#编写一个有实用型的window server(类似IIS)的那种。
作　　者：  qqq123 (qqq123)  
等　　级：  ^^^
信 誉 值：  100
所属论坛：  .NET技术 C#
问题点数：  100
回复次数：  8
发表时间：  2003-11-27 10:12:07
</code></pre></div><p>我学过Socket，也编写过一些window server 的例子代码，可是这些都没有实用价值，我想问C#是否可以编写出一个实用型的window server？<br> 如果可以的话，在编写过程中应当注意什么? 你有什么想法和建议 或 相关资料 请 不吝赐教 ！！！ 重分感谢!!!</p><hr><hr><p>回复人： hlj321(hlj321) ( 三级(初级)) 信誉：100 2003-11-27 10:20:13 得分:0</p><blockquote><p>昨天在网上下载了一个对IIS控制的一个类，如需要可给你。</p></blockquote><p>回复人： NicholasZhr(只在乎一时的灵感) ( 二级(初级)) 信誉：100 2003-11-27 10:30:51 得分:0</p><blockquote><p>偶也想要！谢谢楼上的了！<br> mailto:NicholasZhr@163.com</p></blockquote><p>回复人： polarlm(polarlm) ( 三级(初级)) 信誉：100 2003-11-27 10:31:30 得分:100</p><blockquote></blockquote><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>DirectoryServices</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">WayControls<span class="token punctuation">.</span>IIS</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token doc-comment comment">/// IISWebServer的状态</span>
    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">IISServerState</span>
    <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// </span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        Starting <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// </span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        Started <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// </span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        Stopping <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// </span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        Stopped <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// </span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        Pausing <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// </span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        Paused <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// </span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        Continuing <span class="token operator">=</span> <span class="token number">7</span>

    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token doc-comment comment">/// IISManagement 的摘要说明。</span>
    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IISManagement</span>
    <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// </span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword">public</span> <span class="token class-name">IISWebServerCollection</span> WebServers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IISWebServerCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">string</span></span> Machinename <span class="token operator">=</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// </span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword">public</span> <span class="token function">IISManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// </span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MachineName<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>机器名,默认值为localhost<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword">public</span> <span class="token function">IISManagement</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> MachineName<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>MachineName<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
                Machinename <span class="token operator">=</span> MachineName<span class="token punctuation">;</span>
            <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">DirectoryEntry</span> Service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryEntry</span><span class="token punctuation">(</span><span class="token string">&quot;IIS://&quot;</span> <span class="token operator">+</span> Machinename <span class="token operator">+</span> <span class="token string">&quot;/W3SVC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DirectoryEntry</span> Server<span class="token punctuation">;</span>
            <span class="token class-name">DirectoryEntry</span> Root <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token class-name">DirectoryEntry</span> VirDir<span class="token punctuation">;</span>

            <span class="token class-name">IEnumerator</span> ie <span class="token operator">=</span> Service<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">IEnumerator</span> ieRoot<span class="token punctuation">;</span>
            <span class="token class-name">IISWebServer</span> item<span class="token punctuation">;</span>
            <span class="token class-name">IISWebVirtualDir</span> item_virdir<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">bool</span></span> finded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ie<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Server <span class="token operator">=</span> <span class="token punctuation">(</span>DirectoryEntry<span class="token punctuation">)</span>ie<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>Server<span class="token punctuation">.</span>SchemaClassName <span class="token operator">==</span> <span class="token string">&quot;IIsWebServer&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IISWebServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    item<span class="token punctuation">.</span>index <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt16</span><span class="token punctuation">(</span>Server<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    item<span class="token punctuation">.</span>ServerComment <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;ServerComment&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    item<span class="token punctuation">.</span>AccessRead <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;AccessRead&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    item<span class="token punctuation">.</span>AccessScript <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;AccessScript&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    item<span class="token punctuation">.</span>DefaultDoc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;DefaultDoc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    item<span class="token punctuation">.</span>EnableDefaultDoc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;EnableDefaultDoc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    item<span class="token punctuation">.</span>EnableDirBrowsing <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;EnableDirBrowsing&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    ieRoot <span class="token operator">=</span> Server<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">while</span> <span class="token punctuation">(</span>ieRoot<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        Root <span class="token operator">=</span> <span class="token punctuation">(</span>DirectoryEntry<span class="token punctuation">)</span>ieRoot<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>Root<span class="token punctuation">.</span>SchemaClassName <span class="token operator">==</span> <span class="token string">&quot;IIsWebVirtualDir&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            finded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>finded<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        item<span class="token punctuation">.</span>Path <span class="token operator">=</span> Root<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    item<span class="token punctuation">.</span>Port <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt16</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;Serverbindings&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;Serverbindings&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>WebServers<span class="token punctuation">.</span><span class="token function">Add_</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ieRoot <span class="token operator">=</span> Root<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>ieRoot<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        VirDir <span class="token operator">=</span> <span class="token punctuation">(</span>DirectoryEntry<span class="token punctuation">)</span>ieRoot<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>VirDir<span class="token punctuation">.</span>SchemaClassName <span class="token operator">!=</span> <span class="token string">&quot;IIsWebVirtualDir&quot;</span> <span class="token operator">&amp;&amp;</span> VirDir<span class="token punctuation">.</span>SchemaClassName <span class="token operator">!=</span> <span class="token string">&quot;IIsWebDirectory&quot;</span><span class="token punctuation">)</span>
                            <span class="token keyword">continue</span><span class="token punctuation">;</span>
                        item_virdir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IISWebVirtualDir</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>ServerComment<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        item_virdir<span class="token punctuation">.</span>Name <span class="token operator">=</span> VirDir<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
                        item_virdir<span class="token punctuation">.</span>AccessRead <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span>VirDir<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;AccessRead&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        item_virdir<span class="token punctuation">.</span>AccessScript <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span>VirDir<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;AccessScript&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        item_virdir<span class="token punctuation">.</span>DefaultDoc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>VirDir<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;DefaultDoc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        item_virdir<span class="token punctuation">.</span>EnableDefaultDoc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span>VirDir<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;EnableDefaultDoc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>VirDir<span class="token punctuation">.</span>SchemaClassName <span class="token operator">==</span> <span class="token string">&quot;IIsWebVirtualDir&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            item_virdir<span class="token punctuation">.</span>Path <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>VirDir<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;Path&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>VirDir<span class="token punctuation">.</span>SchemaClassName <span class="token operator">==</span> <span class="token string">&quot;IIsWebDirectory&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            item_virdir<span class="token punctuation">.</span>Path <span class="token operator">=</span> Root<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;Path&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;\\\\&quot;</span> <span class="token operator">+</span> VirDir<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        item<span class="token punctuation">.</span>WebVirtualDirs<span class="token punctuation">.</span><span class="token function">Add_</span><span class="token punctuation">(</span>item_virdir<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>回复人： polarlm(polarlm) ( 三级(初级)) 信誉：100 2003-11-27 10:32:02 得分:0</p><blockquote></blockquote><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// 创建站点</span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iisServer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreateIISWebServer</span><span class="token punctuation">(</span><span class="token class-name">IISWebServer</span> iisServer<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>iisServer<span class="token punctuation">.</span>ServerComment<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;IISWebServer的ServerComment不能为空!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DirectoryEntry</span> Service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryEntry</span><span class="token punctuation">(</span><span class="token string">&quot;IIS://&quot;</span> <span class="token operator">+</span> IISManagement<span class="token punctuation">.</span>Machinename <span class="token operator">+</span> <span class="token string">&quot;/W3SVC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DirectoryEntry</span> Server<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">IEnumerator</span> ie <span class="token operator">=</span> Service<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>ie<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Server <span class="token operator">=</span> <span class="token punctuation">(</span>DirectoryEntry<span class="token punctuation">)</span>ie<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Server<span class="token punctuation">.</span>SchemaClassName <span class="token operator">==</span> <span class="token string">&quot;IIsWebServer&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Convert<span class="token punctuation">.</span><span class="token function">ToInt16</span><span class="token punctuation">(</span>Server<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> i<span class="token punctuation">)</span>
                i <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt16</span><span class="token punctuation">(</span>Server<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// if( Server.Properties[&quot;Serverbindings&quot;][0].ToString() == &quot;:&quot; + iisServer.Port + &quot;:&quot; )</span>
            <span class="token comment">// {</span>
            <span class="token comment">// Server.Invoke(&quot;stop&quot;,new object[0]);</span>
            <span class="token comment">// }</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    i<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        iisServer<span class="token punctuation">.</span>index <span class="token operator">=</span> i<span class="token punctuation">;</span>
        Server <span class="token operator">=</span> Service<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;IIsWebServer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;ServerComment&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>ServerComment<span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;Serverbindings&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> iisServer<span class="token punctuation">.</span>Port <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;AccessScript&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>AccessScript<span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;AccessRead&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>AccessRead<span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;EnableDirBrowsing&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>EnableDirBrowsing<span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;DefaultDoc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>DefaultDoc<span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;EnableDefaultDoc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>EnableDefaultDoc<span class="token punctuation">;</span>

        <span class="token class-name">DirectoryEntry</span> root <span class="token operator">=</span> Server<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;IIsWebVirtualDir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        root<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>Path<span class="token punctuation">;</span>

        Service<span class="token punctuation">.</span><span class="token function">CommitChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span><span class="token function">CommitChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        root<span class="token punctuation">.</span><span class="token function">CommitChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//Server.Invoke(&quot;start&quot;,new object[0]);</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> es<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// 删除IISWebServer</span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RemoveIISWebServer</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> ServerComment<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DirectoryEntry</span> Service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryEntry</span><span class="token punctuation">(</span><span class="token string">&quot;IIS://&quot;</span> <span class="token operator">+</span> IISManagement<span class="token punctuation">.</span>Machinename <span class="token operator">+</span> <span class="token string">&quot;/W3SVC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DirectoryEntry</span> Server<span class="token punctuation">;</span>
    <span class="token class-name">IEnumerator</span> ie <span class="token operator">=</span> Service<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ServerComment <span class="token operator">=</span> ServerComment<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>ie<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Server <span class="token operator">=</span> <span class="token punctuation">(</span>DirectoryEntry<span class="token punctuation">)</span>ie<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Server<span class="token punctuation">.</span>SchemaClassName <span class="token operator">==</span> <span class="token string">&quot;IIsWebServer&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;ServerComment&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ServerComment<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Service<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>Server<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Service<span class="token punctuation">.</span><span class="token function">CommitChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// 删除IISWebServer</span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RemoveIISWebServer</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> index<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DirectoryEntry</span> Service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryEntry</span><span class="token punctuation">(</span><span class="token string">&quot;IIS://&quot;</span> <span class="token operator">+</span> IISManagement<span class="token punctuation">.</span>Machinename <span class="token operator">+</span> <span class="token string">&quot;/W3SVC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">DirectoryEntry</span> Server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryEntry</span><span class="token punctuation">(</span><span class="token string">&quot;IIS://&quot;</span> <span class="token operator">+</span> IISManagement<span class="token punctuation">.</span>Machinename <span class="token operator">+</span> <span class="token string">&quot;/W3SVC/&quot;</span> <span class="token operator">+</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Server <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Service<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>Server<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Service<span class="token punctuation">.</span><span class="token function">CommitChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;找不到此IISWebServer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;找不到此IISWebServer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// 检查是否存在IISWebServer</span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ServerComment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>网站说明<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span></span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ExistsIISWebServer</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> ServerComment<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ServerComment <span class="token operator">=</span> ServerComment<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DirectoryEntry</span> Service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryEntry</span><span class="token punctuation">(</span><span class="token string">&quot;IIS://&quot;</span> <span class="token operator">+</span> IISManagement<span class="token punctuation">.</span>Machinename <span class="token operator">+</span> <span class="token string">&quot;/W3SVC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DirectoryEntry</span> Server <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">IEnumerator</span> ie <span class="token operator">=</span> Service<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">string</span></span> comment<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>ie<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Server <span class="token operator">=</span> <span class="token punctuation">(</span>DirectoryEntry<span class="token punctuation">)</span>ie<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Server<span class="token punctuation">.</span>SchemaClassName <span class="token operator">==</span> <span class="token string">&quot;IIsWebServer&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            comment <span class="token operator">=</span> Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;ServerComment&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>comment <span class="token operator">==</span> ServerComment<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// 返回指定的IISWebServer</span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ServerComment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span></span>
<span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token return-type class-name">DirectoryEntry</span> <span class="token function">returnIISWebserver</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> ServerComment<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ServerComment <span class="token operator">=</span> ServerComment<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DirectoryEntry</span> Service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryEntry</span><span class="token punctuation">(</span><span class="token string">&quot;IIS://&quot;</span> <span class="token operator">+</span> IISManagement<span class="token punctuation">.</span>Machinename <span class="token operator">+</span> <span class="token string">&quot;/W3SVC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DirectoryEntry</span> Server <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">IEnumerator</span> ie <span class="token operator">=</span> Service<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">string</span></span> comment<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>ie<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Server <span class="token operator">=</span> <span class="token punctuation">(</span>DirectoryEntry<span class="token punctuation">)</span>ie<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Server<span class="token punctuation">.</span>SchemaClassName <span class="token operator">==</span> <span class="token string">&quot;IIsWebServer&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            comment <span class="token operator">=</span> Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;ServerComment&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>comment <span class="token operator">==</span> ServerComment<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> Server<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">///  返回指定的IISWebServer</span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span></span>
<span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token return-type class-name">DirectoryEntry</span> <span class="token function">returnIISWebserver</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> index<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DirectoryEntry</span> Server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryEntry</span><span class="token punctuation">(</span><span class="token string">&quot;IIS://&quot;</span> <span class="token operator">+</span> IISManagement<span class="token punctuation">.</span>Machinename <span class="token operator">+</span> <span class="token string">&quot;/W3SVC/&quot;</span> <span class="token operator">+</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">IEnumerator</span> ie <span class="token operator">=</span> Server<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Server<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// 修改与给定的IISWebServer具有相同网站说明的站点配置</span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iisServer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>给定的IISWebServer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EditIISWebServer</span><span class="token punctuation">(</span><span class="token class-name">IISWebServer</span> iisServer<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>iisServer<span class="token punctuation">.</span>index <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;找不到给定的站点!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DirectoryEntry</span> Service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryEntry</span><span class="token punctuation">(</span><span class="token string">&quot;IIS://&quot;</span> <span class="token operator">+</span> IISManagement<span class="token punctuation">.</span>Machinename <span class="token operator">+</span> <span class="token string">&quot;/W3SVC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DirectoryEntry</span> Server<span class="token punctuation">;</span>

    <span class="token class-name">IEnumerator</span> ie <span class="token operator">=</span> Service<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>ie<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Server <span class="token operator">=</span> <span class="token punctuation">(</span>DirectoryEntry<span class="token punctuation">)</span>ie<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Server<span class="token punctuation">.</span>SchemaClassName <span class="token operator">==</span> <span class="token string">&quot;IIsWebServer&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;Serverbindings&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> iisServer<span class="token punctuation">.</span>Port <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Server<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token string">&quot;stop&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">object</span></span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    Server <span class="token operator">=</span> <span class="token function">returnIISWebserver</span><span class="token punctuation">(</span>iisServer<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Server <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;找不到给定的站点!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;ServerComment&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>ServerComment<span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;Serverbindings&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> iisServer<span class="token punctuation">.</span>Port <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;AccessScript&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>AccessScript<span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;AccessRead&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>AccessRead<span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;EnableDirBrowsing&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>EnableDirBrowsing<span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;DefaultDoc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>DefaultDoc<span class="token punctuation">;</span>
        Server<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;EnableDefaultDoc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>EnableDefaultDoc<span class="token punctuation">;</span>

        ie <span class="token operator">=</span> Server<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ie<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DirectoryEntry</span> root <span class="token operator">=</span> <span class="token punctuation">(</span>DirectoryEntry<span class="token punctuation">)</span>ie<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
        root<span class="token punctuation">.</span>Properties<span class="token punctuation">[</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> iisServer<span class="token punctuation">.</span>Path<span class="token punctuation">;</span>

        Server<span class="token punctuation">.</span><span class="token function">CommitChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        root<span class="token punctuation">.</span><span class="token function">CommitChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Server<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">object</span></span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> es<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>回复人： chenwei518(makelive) ( 二级(初级)) 信誉：100 2003-11-27 10:36:45 得分:0</p><blockquote><p>去看一看TCP/IP</p></blockquote><p>回复人： hlj321(hlj321) ( 三级(初级)) 信誉：100 2003-11-27 10:43:11 得分:0</p><blockquote><p>NicholasZhr ： polarlm(polarlm) 发的就是</p></blockquote><p>回复人： qqq123(qqq123) ( 三级(初级)) 信誉：100 2003-11-27 10:45:29 得分:0</p><blockquote><p>Mail: shaleone2000@yahoo.com.cn <br> 谢谢！</p></blockquote><p>回复人： liduke(天下有雪) ( 五级(中级)) 信誉：100 2003-11-27 11:30:54 得分:0</p><blockquote><p>我觉得还是多往remoting上着眼比较好</p></blockquote><p>该问题已经结贴 ，得分记录： polarlm (100)、</p>`,24),c=[o];function e(u,l){return s(),a("div",null,c)}const i=n(p,[["render",e],["__file","pts20.html.vue"]]);export{i as default};
