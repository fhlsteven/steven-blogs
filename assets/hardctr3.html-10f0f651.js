import{_ as n,o as s,c as a,a as p}from"./app-d9da1b6d.js";const t={},o=p(`<h1 id="c-捕捉视频头-源码" tabindex="-1"><a class="header-anchor" href="#c-捕捉视频头-源码" aria-hidden="true">#</a> C#捕捉视频头(源码)</h1><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Wuyin<span class="token punctuation">.</span>ShoesManager</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token doc-comment comment">/// VedioCapture 的摘要说明。</span>
    <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VedioCapture</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> hCaptureM<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> isUnLoad <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token function">VedioCapture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;avicap32.dll&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">capCreateCaptureWindow</span><span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">string</span></span> strWindowName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> dwStyle<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> y <span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> width<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> height <span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> hwdParent<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> nID <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;user32.dll&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">int</span></span> hwnd <span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> wMsg<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> wParam <span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> lParam <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;user32.dll&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">int</span></span> hwnd <span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> wMsg<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> wParam <span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> lParam <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Kernel32.dll&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CloseHandle</span><span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">int</span></span> hObject <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Initialize</span><span class="token punctuation">(</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Control</span> aContainer <span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> intWidth<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> intHeight <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            hCaptureM <span class="token operator">=</span> <span class="token function">capCreateCaptureWindow</span><span class="token punctuation">(</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token number">0x40000000</span> <span class="token operator">|</span> <span class="token number">0x10000000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>intWidth<span class="token punctuation">,</span>intHeight<span class="token punctuation">,</span>aContainer<span class="token punctuation">.</span>Handle<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> hCaptureM <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> hCaptureM <span class="token punctuation">,</span> <span class="token number">1034</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">CloseHandle</span><span class="token punctuation">(</span>hCaptureM<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//WM_CAP_SET_PREVIEW</span>
            ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> hCaptureM<span class="token punctuation">,</span> <span class="token number">1074</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">UnLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//WM_CAP_SET_SCALE</span>
            ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> hCaptureM<span class="token punctuation">,</span> <span class="token number">1077</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">UnLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//WM_CAP_SET_PREVIEWRATE</span>
            ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> hCaptureM<span class="token punctuation">,</span> <span class="token number">1076</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">UnLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SingleFrameBegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//</span>
            <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> hCaptureM<span class="token punctuation">,</span> <span class="token number">1094</span> <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SingleFrameEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//</span>
            <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> hCaptureM<span class="token punctuation">,</span> <span class="token number">1095</span> <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SingleFrameMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//WM_CAP_GRAB_FRAME</span>
            <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span>  hCaptureM<span class="token punctuation">,</span> <span class="token number">1084</span> <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//WM_CAP_SET_PREVIEW </span>
            <span class="token comment">//int ret = SendMessage(  hCaptureM, 1074 , 0, 0 );</span>
            <span class="token comment">//WM_CAP_SINGLE_FRAME</span>
            <span class="token comment">//ret = SendMessage( hCaptureM, 1096 , 0, 0 );</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PreviewMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> hCaptureM<span class="token punctuation">,</span> <span class="token number">1074</span> <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>        

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UnLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> hCaptureM<span class="token punctuation">,</span> <span class="token number">1035</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">CloseHandle</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hCaptureM <span class="token punctuation">)</span><span class="token punctuation">;</span>
            isUnLoad <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CopyToClipBorad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span>  hCaptureM<span class="token punctuation">,</span> <span class="token number">1054</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowFormatDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span>  hCaptureM<span class="token punctuation">,</span> <span class="token number">1065</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SaveToDIB</span><span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span>  hCaptureM<span class="token punctuation">,</span> <span class="token number">1049</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> fileName <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowDisplayDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">SendMessage</span><span class="token punctuation">(</span> hCaptureM<span class="token punctuation">,</span> <span class="token number">1067</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Image</span> <span class="token function">getCaptureImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>IDataObject</span> iData <span class="token operator">=</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Clipboard<span class="token punctuation">.</span><span class="token function">GetDataObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Image</span> retImage <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> iData <span class="token operator">!=</span>  <span class="token keyword">null</span> <span class="token punctuation">)</span> 
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span> iData<span class="token punctuation">.</span><span class="token function">GetDataPresent</span><span class="token punctuation">(</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>DataFormats<span class="token punctuation">.</span>Bitmap <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    retImage <span class="token operator">=</span> <span class="token punctuation">(</span>System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Image<span class="token punctuation">)</span>iData<span class="token punctuation">.</span><span class="token function">GetData</span><span class="token punctuation">(</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>DataFormats<span class="token punctuation">.</span>Bitmap <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> 
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> iData<span class="token punctuation">.</span><span class="token function">GetDataPresent</span><span class="token punctuation">(</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>DataFormats<span class="token punctuation">.</span>Dib  <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    retImage <span class="token operator">=</span> <span class="token punctuation">(</span>System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Image<span class="token punctuation">)</span>iData<span class="token punctuation">.</span><span class="token function">GetData</span><span class="token punctuation">(</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>DataFormats<span class="token punctuation">.</span>Dib <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> retImage<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token operator">~</span><span class="token function">VedioCapture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>isUnLoad <span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">UnLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>`,2),e=[o];function c(u,l){return s(),a("div",null,e)}const i=n(t,[["render",c],["__file","hardctr3.html.vue"]]);export{i as default};
