import{_ as n,o as s,c as a,a as p}from"./app-57d1f7b1.js";const o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAQCAIAAADfzGvmAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADCSURBVEhL7ZBLEsQgCAU5+tx8Bn3hpwHNwqwm1QG1+kUq9H3yEB33EeC6xQs+NwvQ5x4Thgukj8hq8hOcz80FIsM07aT0r67btR+mYarAPE07LC5A122n9MdpmBDABBkaUB8lpbfol4jvAhEdwlP4rfhtp/Snk2Ig/1c86QXouhVyf2MgDJGhAfVRUnqLfon4FrBbi4XzW1ktot9ruQiB/0A3CwvwlUsQgI/vLAj+BvxaYI8XfG7PAqd9bui7z1mf6AdIWw3XfJ8CdQAAAABJRU5ErkJggg==",t="data:image/png;base64,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",e={},c=p(`<h1 id="从window系统托盘控制windows服务" tabindex="-1"><a class="header-anchor" href="#从window系统托盘控制windows服务" aria-hidden="true">#</a> 从Window系统托盘控制Windows服务</h1><div class="language-txt" data-ext="txt"><pre class="language-txt"><code>net_lover（原作）
作者： 孟宪会 出自： 【孟宪会之精彩世界】 发布日期： 2003-8-5 17:38:11
</code></pre></div><p>VB.NET有许多内建的类，可以让我们轻松创建Windows服务程序，但如何轻松控制这些服务呢？一般是到管理工具里面进行控制。本文将描述如何创建一个运行在系统托盘里的程序来轻松控制一个服务程序。至于如何创建服务程序，可以参考.NET SDK或其它创建服务程序的文章，本文的例子利用IIS的W3SVC服务来做例子，来控制IIS的停止与启动。</p><p>要开发这样的程序，我们先打开Microsoft Visual Studio.NET，新建一个名为ServiceController的解决方案，然后新建名为WinForm的Visual Basic类型的Windows应用程序，然后把VS.NET自动创建的Form1.vb删除掉，因为我们创建的应用程序没有用户界面，我们在Sub Main运行程序。</p><p>先添加引用－.NET－System.ServiceProcess.dll，新建名为modMain的模块，代码如下：</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Imports</span> System<span class="token punctuation">.</span>Text
<span class="token keyword">Imports</span> System<span class="token punctuation">.</span>Diagnostics
<span class="token keyword">Imports</span> System<span class="token punctuation">.</span>ServiceProcess

<span class="token keyword">Public</span> <span class="token keyword">Module</span> modMain

  <span class="token keyword">Private</span> <span class="token keyword">WithEvents</span> mobNotifyIcon <span class="token keyword">As</span> NotifyIcon
  <span class="token keyword">Private</span> <span class="token keyword">WithEvents</span> mobContextMenu <span class="token keyword">As</span> ContextMenu
  <span class="token keyword">Private</span> <span class="token keyword">WithEvents</span> mobTimer <span class="token keyword">As</span> Timers<span class="token punctuation">.</span>Timer
  <span class="token keyword">Private</span> mobServiceController <span class="token keyword">As</span> ServiceController

<span class="token keyword">End</span> <span class="token keyword">Module</span>
</code></pre></div><p>上面的代码首先引用了三个名称空间，然后分别定义了四个变量：mobNotifyIcon将会在系统托盘里显示；ContextMenu显示菜单信息；mobTimer为定时器，原来检查服务的状态，以随时变更菜单和图标的状态；mobServiceController表示Windows服务应用程序并允许连接到正在运行或者已停止的服务、对其进行操作或获取有关它的信息。</p><p>由于服务程序是没有用户界面的，因此我们设置三种图标标识服务的状态，这里做了三个简单的图标来标识服务的状态：Running.ico，Paused.ico，Stopped.ico，分别如下：</p><p><img src="`+o+`" alt="pst21_1"></p><p>下面我们就建立定时器SetUpTimer过程，通常，IIS停止或启动的间隔为5秒，我们就用5秒来做定时器的间隔，代码如下：</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> SetUpTimer<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Try</span>
        mobTimer <span class="token operator">=</span> <span class="token keyword">New</span> Timers<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">With</span> mobTimer
            <span class="token punctuation">.</span>AutoReset <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token punctuation">.</span>Interval <span class="token operator">=</span> <span class="token number">5000</span>
            <span class="token punctuation">.</span>Start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        <span class="token keyword">Throw</span> obEx
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre></div><p>下面，创建上下文菜单的过程，并为每个菜单项添加事件处理程序：</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> CreateMenu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Try</span>
        mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">New</span> MenuItem<span class="token punctuation">(</span><span class="token string">&quot;停止&quot;</span><span class="token punctuation">,</span><span class="token keyword">New</span> EventHandler<span class="token punctuation">(</span><span class="token keyword">AddressOf</span> StopService<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">New</span> MenuItem<span class="token punctuation">(</span><span class="token string">&quot;暂停&quot;</span><span class="token punctuation">,</span><span class="token keyword">New</span> EventHandler<span class="token punctuation">(</span><span class="token keyword">AddressOf</span> PauseService<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">New</span> MenuItem<span class="token punctuation">(</span><span class="token string">&quot;继续&quot;</span><span class="token punctuation">,</span><span class="token keyword">New</span> EventHandler<span class="token punctuation">(</span><span class="token keyword">AddressOf</span> ContinueService<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">New</span> MenuItem<span class="token punctuation">(</span><span class="token string">&quot;开始&quot;</span><span class="token punctuation">,</span><span class="token keyword">New</span> EventHandler<span class="token punctuation">(</span><span class="token keyword">AddressOf</span> StartService<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span>
        mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">New</span> MenuItem<span class="token punctuation">(</span><span class="token string">&quot;关于&quot;</span><span class="token punctuation">,</span><span class="token keyword">New</span> EventHandler<span class="token punctuation">(</span><span class="token keyword">AddressOf</span> AboutBox<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">New</span> MenuItem<span class="token punctuation">(</span><span class="token string">&quot;退出&quot;</span><span class="token punctuation">,</span><span class="token keyword">New</span> EventHandler<span class="token punctuation">(</span><span class="token keyword">AddressOf</span> ExitController<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        <span class="token keyword">Throw</span> obEx
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre></div><p>当我们改变了服务的运行状态时，我们应当向用户反映这一变化，这里用托盘的图标不同来进行标识。当服务程序启动时，就要先建立服务的状态，首先GetServiceStatus过程调用ServiceController的Refresh方法，它将会刷新的ServiceController所有属性。要准确得到服务程序的状态，这一过程是至关重要的，下面的Select Case语句根据不同的服务程序的状态，建立不同的菜单项和托盘图标。</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> GetServiceStatus<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Try</span>
    <span class="token comment">&#39;//读取状态之前先进行刷新</span>
    mobServiceController<span class="token punctuation">.</span>Refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">&#39;//变更菜单项和图标</span>
    <span class="token keyword">Select</span> <span class="token keyword">Case</span> mobServiceController<span class="token punctuation">.</span>Status<span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">Case</span> ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>Paused
          mobNotifyIcon<span class="token punctuation">.</span>Icon <span class="token operator">=</span> <span class="token keyword">New</span> Icon<span class="token punctuation">(</span><span class="token string">&quot;Paused.ico&quot;</span><span class="token punctuation">)</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">True</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          <span class="token keyword">Case</span> ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>Running
          mobNotifyIcon<span class="token punctuation">.</span>Icon <span class="token operator">=</span> <span class="token keyword">New</span> Icon<span class="token punctuation">(</span><span class="token string">&quot;Running.ico&quot;</span><span class="token punctuation">)</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">True</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">True</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          <span class="token keyword">Case</span> ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>Stopped
          mobNotifyIcon<span class="token punctuation">.</span>Icon <span class="token operator">=</span> <span class="token keyword">New</span> Icon<span class="token punctuation">(</span><span class="token string">&quot;Stopped.ico&quot;</span><span class="token punctuation">)</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">True</span>
          <span class="token keyword">Case</span> <span class="token operator">_</span>
          ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>ContinuePending<span class="token punctuation">,</span> <span class="token operator">_</span>
              ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>PausePending<span class="token punctuation">,</span> <span class="token operator">_</span>
              ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>StartPending<span class="token punctuation">,</span> <span class="token operator">_</span>
              ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>StopPending
          mobNotifyIcon<span class="token punctuation">.</span>Icon <span class="token operator">=</span> <span class="token keyword">New</span> Icon<span class="token punctuation">(</span><span class="token string">&quot;Paused.ico&quot;</span><span class="token punctuation">)</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
          mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">End</span> <span class="token keyword">Select</span>
    <span class="token comment">&#39;//检查“暂停”和“继续”使用可用</span>
    <span class="token keyword">If</span> mobServiceController<span class="token punctuation">.</span>CanPauseAndContinue <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token keyword">Then</span>
        mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
        mobContextMenu<span class="token punctuation">.</span>MenuItems<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>

    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        <span class="token keyword">Throw</span> obEx
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre></div><p>下面建立菜单项的事件处理程序:</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39;//停止服务的过程</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> StopService<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> EventArgs<span class="token punctuation">)</span>
    <span class="token keyword">Try</span>
        <span class="token keyword">If</span> mobServiceController<span class="token punctuation">.</span>Status <span class="token operator">=</span> ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>Running <span class="token keyword">Then</span>
            <span class="token keyword">If</span> mobServiceController<span class="token punctuation">.</span>CanStop <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token keyword">Then</span>
                mobServiceController<span class="token punctuation">.</span><span class="token keyword">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        <span class="token keyword">Throw</span> obEx
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token comment">&#39;//暂停服务的过程</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> PauseService<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> EventArgs<span class="token punctuation">)</span>
    <span class="token keyword">Try</span>
        <span class="token keyword">If</span> <span class="token keyword">Not</span> mobServiceController<span class="token punctuation">.</span>Status <span class="token operator">=</span> ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>Paused <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token keyword">Then</span>
            <span class="token keyword">If</span> mobServiceController<span class="token punctuation">.</span>CanPauseAndContinue <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token keyword">Then</span>
                mobServiceController<span class="token punctuation">.</span>Pause<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        <span class="token keyword">Throw</span> obEx
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token comment">&#39;//继续服务程序的过程</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> ContinueService<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> EventArgs<span class="token punctuation">)</span>
    <span class="token keyword">Try</span>
        <span class="token keyword">If</span> mobServiceController<span class="token punctuation">.</span>Status <span class="token operator">=</span> ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>Paused <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token keyword">Then</span>
            <span class="token keyword">If</span> mobServiceController<span class="token punctuation">.</span>CanPauseAndContinue <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token keyword">Then</span>
                mobServiceController<span class="token punctuation">.</span><span class="token keyword">Continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        <span class="token keyword">Throw</span> obEx
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token comment">&#39;//开始服务程序的过程</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> StartService<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> EventArgs<span class="token punctuation">)</span>
        <span class="token keyword">Try</span>
        <span class="token keyword">If</span> mobServiceController<span class="token punctuation">.</span>Status <span class="token operator">=</span> ServiceProcess<span class="token punctuation">.</span>ServiceControllerStatus<span class="token punctuation">.</span>Stopped <span class="token keyword">Then</span>
            mobServiceController<span class="token punctuation">.</span>Start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        <span class="token keyword">Throw</span> obEx
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token comment">&#39;//“关于”菜单项的过程</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> AboutBox<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> EventArgs<span class="token punctuation">)</span>
    <span class="token keyword">Try</span>
        <span class="token keyword">Dim</span> obStringBuilder <span class="token keyword">As</span> <span class="token keyword">New</span> StringBuilder<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">With</span> obStringBuilder
            <span class="token punctuation">.</span>Append<span class="token punctuation">(</span><span class="token string">&quot;Service Controller 使用例子&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>Append<span class="token punctuation">(</span>vbCrLf<span class="token punctuation">)</span>
            <span class="token punctuation">.</span>Append<span class="token punctuation">(</span><span class="token string">&quot;CLR 版本：&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>Append<span class="token punctuation">(</span>Environment<span class="token punctuation">.</span>Version<span class="token punctuation">.</span>ToString<span class="token punctuation">)</span>
            MsgBox<span class="token punctuation">(</span><span class="token punctuation">.</span>ToString<span class="token punctuation">,</span> MsgBoxStyle<span class="token punctuation">.</span>Information<span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">With</span>
        obStringBuilder <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        <span class="token keyword">Throw</span> obEx
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token comment">&#39;//退出服务程序的过程</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> ExitController<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> EventArgs<span class="token punctuation">)</span>
    <span class="token keyword">Try</span>
        mobTimer<span class="token punctuation">.</span><span class="token keyword">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        mobTimer<span class="token punctuation">.</span>Dispose<span class="token punctuation">(</span><span class="token punctuation">)</span>
        mobNotifyIcon<span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">False</span>
        mobNotifyIcon<span class="token punctuation">.</span>Dispose<span class="token punctuation">(</span><span class="token punctuation">)</span>
        mobServiceController<span class="token punctuation">.</span>Dispose<span class="token punctuation">(</span><span class="token punctuation">)</span>
        Application<span class="token punctuation">.</span><span class="token keyword">Exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        <span class="token keyword">Throw</span> obEx
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token comment">&#39;//定时器停止</span>
<span class="token keyword">Public</span> <span class="token keyword">Sub</span> mobTimer_Elapsed<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>Timers<span class="token punctuation">.</span>ElapsedEventArgs<span class="token punctuation">)</span> <span class="token operator">_</span>
    <span class="token keyword">Handles</span> mobTimer<span class="token punctuation">.</span>Elapsed
    <span class="token keyword">Try</span>
        GetServiceStatus<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        <span class="token keyword">Throw</span> obEx
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token comment">&#39;//系统托盘图标单击事件</span>
<span class="token keyword">Public</span> <span class="token keyword">Sub</span> mobNotifyIcon_Click<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>EventArgs<span class="token punctuation">)</span> <span class="token operator">_</span>
    <span class="token keyword">Handles</span> mobNotifyIcon<span class="token punctuation">.</span>Click
    System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process<span class="token punctuation">.</span>Start<span class="token punctuation">(</span><span class="token string">&quot;IExplore.exe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://xml.sz.luohuedu.net/&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre></div><p>下面就是主程序：</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> Main<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Try</span>
        <span class="token comment">&#39;//建立与服务程序的连接</span>
        mobServiceController <span class="token operator">=</span> <span class="token keyword">New</span> System<span class="token punctuation">.</span>ServiceProcess<span class="token punctuation">.</span>ServiceController<span class="token punctuation">(</span><span class="token string">&quot;IISAdmin&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">&#39;//隐藏图标，知道菜单项和图标准备好以后。</span>
        mobNotifyIcon <span class="token operator">=</span> <span class="token keyword">New</span> NotifyIcon<span class="token punctuation">(</span><span class="token punctuation">)</span>
        mobNotifyIcon<span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">False</span>
        mobContextMenu <span class="token operator">=</span> <span class="token keyword">New</span> ContextMenu<span class="token punctuation">(</span><span class="token punctuation">)</span>
        CreateMenu<span class="token punctuation">(</span><span class="token punctuation">)</span>
        mobNotifyIcon<span class="token punctuation">.</span>ContextMenu <span class="token operator">=</span> mobContextMenu
        mobNotifyIcon<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;【孟宪会之精彩世界】&quot;</span> <span class="token operator">+</span> <span class="token operator">_</span>
            Microsoft<span class="token punctuation">.</span>VisualBasic<span class="token punctuation">.</span>ChrW<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;http://xml.sz.luohuedu.net/&quot;</span>
        SetUpTimer<span class="token punctuation">(</span><span class="token punctuation">)</span>
        mobNotifyIcon<span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">True</span>
        Application<span class="token punctuation">.</span>Run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Catch</span> obEx <span class="token keyword">As</span> Exception
        MsgBox<span class="token punctuation">(</span>obEx<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>ToString<span class="token punctuation">,</span> MsgBoxStyle<span class="token punctuation">.</span>Critical<span class="token punctuation">)</span>
        <span class="token keyword">End</span>
    <span class="token keyword">End</span> <span class="token keyword">Try</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre></div><p>运行结果如下：</p><p><img src="`+t+'" alt="pts21_2"></p><hr><p>liuguangwei (2003-10-7 11:17:47)</p><blockquote><p>很不错的程序!值得学习.</p></blockquote><p>ceocio (2003-8-24 10:57:28)</p><blockquote><p>孟子出马，果然不同凡响！：）</p></blockquote>',26),k=[c];function l(u,r){return s(),a("div",null,k)}const d=n(e,[["render",l],["__file","pts21.html.vue"]]);export{d as default};
