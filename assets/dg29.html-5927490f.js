import{_ as n,o as s,c as a,a as p}from"./app-f0851ed3.js";const t={},o=p(`<h1 id="显示datagrid序号的一个适用的方法" tabindex="-1"><a class="header-anchor" href="#显示datagrid序号的一个适用的方法" aria-hidden="true">#</a> 显示DataGrid序号的一个适用的方法</h1><blockquote><p>wangj2001（原作） 关键字 C#,DataGrid</p></blockquote><p>我在网上查了好几个例子，如果数据量小的话没有问题，一旦数据量大，显示特别慢，还有个缺点就是拖动行高时行号不随行高的变化而变动，出现是几个序号在一个单元格中显示。我自己对他们的算法进行总结，写出一个效果比较不错的带序号的DataGrid。原理：只显示表格中显示行的序号，并且拖动行，行号一起移动。</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">override</span> <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPaint</span><span class="token punctuation">(</span><span class="token class-name">PaintEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnPaint</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>DataSource<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> yDelta<span class="token punctuation">;</span>
            <span class="token class-name">System<span class="token punctuation">.</span>Drawing <span class="token punctuation">.</span>Rectangle</span> cell<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetCellBounds</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> y<span class="token operator">=</span>cell<span class="token punctuation">.</span>Top <span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>Graphics<span class="token punctuation">.</span><span class="token function">DrawString</span><span class="token punctuation">(</span><span class="token string">&quot;编号&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Font<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SolidBrush</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>Black<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> y<span class="token operator">-</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>VisibleRowCount <span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//只在有记录集时在表格中显示序号</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">CurrencyManager</span> cm<span class="token punctuation">;</span>
                cm <span class="token operator">=</span> <span class="token punctuation">(</span>CurrencyManager<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>BindingContext<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DataMember<span class="token punctuation">]</span><span class="token punctuation">;</span> 

                <span class="token keyword">if</span><span class="token punctuation">(</span>cm<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name"><span class="token keyword">int</span></span> nRow<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                    y<span class="token operator">=</span><span class="token number">41</span><span class="token punctuation">;</span>           <span class="token comment">//为第一行默认高度</span>

                    <span class="token keyword">while</span><span class="token punctuation">(</span>nRow<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        nRow<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>HitTest <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">.</span>Row<span class="token punctuation">;</span>
                        y<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token class-name"><span class="token keyword">int</span></span> nCount<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

                    <span class="token keyword">while</span><span class="token punctuation">(</span>y<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>Height <span class="token operator">&amp;&amp;</span> nCount<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>VisibleRowCount<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token class-name"><span class="token keyword">string</span></span> text <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> nRow<span class="token operator">+</span>nCount<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        e<span class="token punctuation">.</span>Graphics<span class="token punctuation">.</span><span class="token function">DrawString</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Font<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SolidBrush</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>Black<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        yDelta <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetCellBounds</span><span class="token punctuation">(</span>nRow<span class="token operator">+</span>nCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Height <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//****表示一行高度的参数</span>
                        y <span class="token operator">+=</span> yDelta<span class="token punctuation">;</span>
                        <span class="token comment">//如果下面有子行显示序号的区分显示</span>

                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsExpanded <span class="token punctuation">(</span>nRow<span class="token operator">+</span>nCount<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span> nRow<span class="token operator">+</span>nCount<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">&lt;</span> cm<span class="token punctuation">.</span>Count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            y<span class="token operator">+=</span><span class="token keyword">this</span><span class="token punctuation">.</span>GetCellBounds <span class="token punctuation">(</span>nRow<span class="token operator">+</span>nCount<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Height <span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        nCount<span class="token operator">++</span><span class="token punctuation">;</span> 
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>重载了DataGrid中的Paint，这样用起来会特别方便,区区雕虫小技，希望和大家共同分享。</p><p>我的Email:<code>gangleader@126.com</code></p>`,6),c=[o];function e(u,l){return s(),a("div",null,c)}const i=n(t,[["render",e],["__file","dg29.html.vue"]]);export{i as default};
