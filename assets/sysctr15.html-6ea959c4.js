import{_ as n,o as s,c as a,a as t}from"./app-d9da1b6d.js";const p={},o=t(`<h1 id="在c-中的cookie编程" tabindex="-1"><a class="header-anchor" href="#在c-中的cookie编程" aria-hidden="true">#</a> 在C#中的cookie编程</h1><p>本文将关注列出、执行DTS包和改变DTS包的属性或者全局变量。</p><p>首先我们看看如何列出保存在本地(local or (local)\\NetSDK)服务器为本地包。在DOTNET中处理DTS包的关键是增加对“Microsoft DTSPackage Object Library”的引用（dts.dll）。</p><p>以下代码可以列出服务器上的本地包。</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DTS<span class="token punctuation">.</span>Application</span> App <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DTS<span class="token punctuation">.</span>Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DTS<span class="token punctuation">.</span>PackageSQLServer</span> package <span class="token operator">=</span> App<span class="token punctuation">.</span><span class="token function">GetPackageSQLServer</span><span class="token punctuation">(</span><span class="token string">&quot;(local)\\\\NetSDK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sa&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> DTS<span class="token punctuation">.</span>DTSSQLServerStorageFlags<span class="token punctuation">.</span>DTSSQLStgFlag_Default<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DTS<span class="token punctuation">.</span>PackageInfos</span> Infos<span class="token punctuation">;</span>
    Infos <span class="token operator">=</span> package<span class="token punctuation">.</span><span class="token function">EnumPackageInfos</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DTS<span class="token punctuation">.</span>PackageInfo</span> Info <span class="token keyword">in</span> Infos<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Name : {0}\\tVersionID : {1}&quot;</span><span class="token punctuation">,</span> Info<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> Info<span class="token punctuation">.</span>VersionID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>取保存在格式化存储文件中的dts包属性代码如下：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DTS<span class="token punctuation">.</span>Package2Class</span> package <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DTS<span class="token punctuation">.</span>Package2Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DTS<span class="token punctuation">.</span>SavedPackageInfos</span> Infos <span class="token operator">=</span>
                   package<span class="token punctuation">.</span><span class="token function">GetSavedPackageInfos</span><span class="token punctuation">(</span><span class="token string">&quot;C:\\\\Pubs2Pubs2Package.dts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DTS<span class="token punctuation">.</span>SavedPackageInfo</span> Info <span class="token keyword">in</span> Infos<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Name : {0}\\tVersionID : {1}&quot;</span><span class="token punctuation">,</span> Info<span class="token punctuation">.</span>PackageName<span class="token punctuation">,</span> Info<span class="token punctuation">.</span>VersionID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    package<span class="token punctuation">.</span><span class="token function">UnInitialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过Package2Class对象可以执行dts包，或者操作dts包的属性。代码如下：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DTS<span class="token punctuation">.</span>Package2Class</span> package <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DTS<span class="token punctuation">.</span>Package2Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> MIA <span class="token operator">=</span> System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>Missing<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
        package<span class="token punctuation">.</span><span class="token function">LoadFromSQLServer</span><span class="token punctuation">(</span><span class="token string">&quot;(local)\\\\NetSDK&quot;</span><span class="token punctuation">,</span>
                          <span class="token string">&quot;sa&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> DTS<span class="token punctuation">.</span>DTSSQLServerStorageFlags<span class="token punctuation">.</span>DTSSQLStgFlag_Default<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                          <span class="token string">&quot;{F580DFC4-1F6A-4D70-B6A1-1C200B0D7890}&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CustomTaskPKG&quot;</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> MIA<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>package<span class="token punctuation">.</span>Description<span class="token punctuation">)</span><span class="token punctuation">;</span>
        package<span class="token punctuation">.</span>Description <span class="token operator">=</span> <span class="token string">&quot;My description&quot;</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>package<span class="token punctuation">.</span>Description<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span>
    <span class="token punctuation">{</span>
        package<span class="token punctuation">.</span><span class="token function">UnInitialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        package <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果要使用最新的版本信息，则不填写版本id信息，代码如下：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code>package<span class="token punctuation">.</span><span class="token function">SaveToSQLServer</span><span class="token punctuation">(</span><span class="token string">&quot;(local)\\\\NetSDK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sa&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    DTS<span class="token punctuation">.</span>DTSSQLServerStorageFlags<span class="token punctuation">.</span>DTSSQLStgFlag_Default<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token keyword">ref</span> MIA<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>以下是设置dts包全局变量的过程：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DTS<span class="token punctuation">.</span>Package2Class</span> package <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DTS<span class="token punctuation">.</span>Package2Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> MIA <span class="token operator">=</span> System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>Missing<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
        package<span class="token punctuation">.</span><span class="token function">LoadFromStorageFile</span><span class="token punctuation">(</span><span class="token string">&quot;C:\\\\Pubs2Pubs2Package.dts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Pubs2Pubs2Package&quot;</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> MIA<span class="token punctuation">)</span><span class="token punctuation">;</span>
        package<span class="token punctuation">.</span>GlobalVariables<span class="token punctuation">.</span><span class="token function">AddGlobalVariable</span><span class="token punctuation">(</span><span class="token string">&quot;MyVariable&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MyValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DTS<span class="token punctuation">.</span>GlobalVariable</span> GVar <span class="token keyword">in</span> package<span class="token punctuation">.</span>GlobalVariables<span class="token punctuation">)</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Name : {0}\\tValue : {1}&quot;</span><span class="token punctuation">,</span> GVar<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> GVar<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span>
    <span class="token punctuation">{</span>
        package<span class="token punctuation">.</span><span class="token function">UnInitialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改全局变量值语句：</p><p><code>package.GlobalVariables.Item(&quot;MyVariable&quot;).let_Value(&quot;Hello from C#&quot;);</code></p><p>以下语句将改动保存到dts包中。</p><p><code>package.SaveToStorageFile(&quot;C:\\\\Pubs2Pubs2Package.dts&quot;,&quot;&quot;,&quot;&quot;,ref MIA,false);</code></p><p>执行包：</p><p><code>package.Execute();</code></p>`,19),c=[o];function e(u,l){return s(),a("div",null,c)}const i=n(p,[["render",e],["__file","sysctr15.html.vue"]]);export{i as default};
