import{_ as n,o as s,c as a,a as t}from"./app-a2b6e588.js";const p={},o=t(`<h1 id="c-中操作api" tabindex="-1"><a class="header-anchor" href="#c-中操作api" aria-hidden="true">#</a> C#中操作API</h1><p>作为初学者来说，在C#中使用API确是一件令人头疼的问题。在使用API之间你必须知道如何在C#中使用结构、类型转换、安全/不安全代码，可控/不可控代码等许多知识。</p><p>一切从简单开始，复杂的大家一时不能接受。我们就从实现一个简单的MessageBox开始。首先打开VS.Net ，创建一个新的C#工程，并添加一个Button按钮。当这个按钮被点击，则显示一个MessageBox对话框。</p><p>即然我们需要引用外来库，所以必须导入一个Namespace：</p><p><code>using System.Runtime.InteropServices;</code></p><p>接着添加下面的代码来声明一个API：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;User32.dll&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> 
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> h<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> m<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> c<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>此处DllImport属性被用来从不可控代码中调用一方法。&quot;User32.dll&quot;则设定了类库名。DllImport属性指定dll的位置，这个dll中包括调用的外部方法。Static修饰符则声明一个静态元素，而这个元素属于类型本身而不是上面指定的对象。extern则表示这个方法将在工程外部执行，使用DllImport导入的方法必须使用extern修饰符。</p><p>MessageBox 则是函数名，拥有4个参数，其返回值为数字。</p><p>大多数的API都能传递并返回值。</p><p>添中Click点击事件代码:</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    MessageBox <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;API Message Box&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;API Demo&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编译并运行这个程序，当你点击按钮后，你将会看到对话框，这便是你使用的API函数。</p><h2 id="使用结构体" tabindex="-1"><a class="header-anchor" href="#使用结构体" aria-hidden="true">#</a> 使用结构体</h2><p>操作带有结构体的API比使用简单的API要复杂的多。但是一旦你掌握了API的过程，那个整个API世界将在你的掌握之中。</p><p>下面的例子中我们将使用GetSystemInfo API 来获取整个系统的信息。</p><p>第一步还是打开C#建立一个Form工程，同样的添中一个Button按钮，在代码窗中输入下面的代码，导入Namespace：</p><p><code>using System.Runtime.InteropServices;</code></p><p>声明一个结构体，它将做为GetSystemInfo的一个参数：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">StructLayout</span><span class="token attribute-arguments"><span class="token punctuation">(</span>LayoutKind<span class="token punctuation">.</span>Sequential<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">SYSTEM_INFO</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwOemId<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwPageSize<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> lpMinimumApplicationAddress<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> lpMaximumApplicationAddress<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwActiveProcessorMask<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwNumberOfProcessors<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwProcessorType<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwAllocationGranularity<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwProcessorLevel<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwProcessorRevision<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>声明API函数:</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;kernel32&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GetSystemInfo</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name">SYSTEM_INFO</span> pSI<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>添加下面的代码至按钮的点击事件处理中：</p><p>首先创建一个SYSTEM_INFO结构体，并将其传递给GetSystemInfo函数。</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> button1_Click <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SYSTEM_INFO</span> pSI <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SYSTEM_INFO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">GetSystemInfo</span><span class="token punctuation">(</span><span class="token keyword">ref</span> pSI<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一旦你接收到返回的结构体，那么就可以以返回的参数来执行操作了。</span>
        e<span class="token punctuation">.</span>g<span class="token punctuation">.</span>listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>pSI<span class="token punctuation">.</span>dwActiveProcessorMask<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> er<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>er<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">//Created By Ajit Mungale</span>
<span class="token comment">//程序补充 飞刀</span>
<span class="token keyword">namespace</span> <span class="token namespace">UsingAPI</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Drawing</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>ComponentModel</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>WinForms</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices</span><span class="token punctuation">;</span>

    <span class="token comment">//Struct 收集系统信息 </span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">StructLayout</span><span class="token attribute-arguments"><span class="token punctuation">(</span>LayoutKind<span class="token punctuation">.</span>Sequential<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">SYSTEM_INFO</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwOemId<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwPageSize<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> lpMinimumApplicationAddress<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> lpMaximumApplicationAddress<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwActiveProcessorMask<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwNumberOfProcessors<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwProcessorType<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwAllocationGranularity<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwProcessorLevel<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwProcessorRevision<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//struct 收集内存情况 </span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">StructLayout</span><span class="token attribute-arguments"><span class="token punctuation">(</span>LayoutKind<span class="token punctuation">.</span>Sequential<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">MEMORYSTATUS</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwLength<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwMemoryLoad<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwTotalPhys<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwAvailPhys<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwTotalPageFile<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwAvailPageFile<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwTotalVirtual<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">uint</span></span> dwAvailVirtual<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Form1</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>WinForms<span class="token punctuation">.</span>Form</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>Container</span> components<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">System<span class="token punctuation">.</span>WinForms<span class="token punctuation">.</span>MenuItem</span> menuAbout<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">System<span class="token punctuation">.</span>WinForms<span class="token punctuation">.</span>MainMenu</span> mainMenu1<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">System<span class="token punctuation">.</span>WinForms<span class="token punctuation">.</span>ListBox</span> listBox1<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">System<span class="token punctuation">.</span>WinForms<span class="token punctuation">.</span>Button</span> button1<span class="token punctuation">;</span>

        <span class="token comment">//获取系统信息 </span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;kernel32&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GetSystemInfo</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name">SYSTEM_INFO</span> pSI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取内存信息 </span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;kernel32&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GlobalMemoryStatus</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name">MEMORYSTATUS</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//处理器类型 </span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> PROCESSOR_INTEL_386 <span class="token operator">=</span> <span class="token number">386</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> PROCESSOR_INTEL_486 <span class="token operator">=</span> <span class="token number">486</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> PROCESSOR_INTEL_PENTIUM <span class="token operator">=</span> <span class="token number">586</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> PROCESSOR_MIPS_R4000 <span class="token operator">=</span> <span class="token number">4000</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> PROCESSOR_ALPHA_21064 <span class="token operator">=</span> <span class="token number">21064</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">Form1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            components<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>components <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>mainMenu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>WinForms<span class="token punctuation">.</span>MainMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>button1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>WinForms<span class="token punctuation">.</span>Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>listBox1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>WinForms<span class="token punctuation">.</span>ListBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>menuAbout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>WinForms<span class="token punctuation">.</span>MenuItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mainMenu1<span class="token punctuation">.</span>MenuItems<span class="token punctuation">.</span>All <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>WinForms<span class="token punctuation">.</span>MenuItem</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>menuAbout <span class="token punctuation">}</span><span class="token punctuation">;</span>
            button1<span class="token punctuation">.</span>Location <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">148</span><span class="token punctuation">,</span> <span class="token number">168</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button1<span class="token punctuation">.</span>Size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button1<span class="token punctuation">.</span>TabIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            button1<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;&amp;Get Info&quot;</span><span class="token punctuation">;</span>
            button1<span class="token punctuation">.</span>Click <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>EventHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>button1_Click<span class="token punctuation">)</span><span class="token punctuation">;</span>
            listBox1<span class="token punctuation">.</span>Location <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            listBox1<span class="token punctuation">.</span>Size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">368</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            listBox1<span class="token punctuation">.</span>TabIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            menuAbout<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;&amp;About&quot;</span><span class="token punctuation">;</span>
            menuAbout<span class="token punctuation">.</span>Index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            menuAbout<span class="token punctuation">.</span>Click <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>EventHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>menuAbout_Click<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">&quot;System Information - Using API&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>MaximizeBox <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>AutoScaleBaseSize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>MinimizeBox <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Menu <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mainMenu1<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ClientSize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">408</span><span class="token punctuation">,</span> <span class="token number">213</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Controls<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>listBox1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Controls<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>button1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">menuAbout_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">Form</span> abt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">about</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            abt<span class="token punctuation">.</span><span class="token function">ShowDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">SYSTEM_INFO</span> pSI <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SYSTEM_INFO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">GetSystemInfo</span><span class="token punctuation">(</span><span class="token keyword">ref</span> pSI<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">string</span></span> CPUType<span class="token punctuation">;</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>pSI<span class="token punctuation">.</span>dwProcessorType<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> PROCESSOR_INTEL_386<span class="token punctuation">:</span>
                        CPUType <span class="token operator">=</span> <span class="token string">&quot;Intel 386&quot;</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> PROCESSOR_INTEL_486<span class="token punctuation">:</span>
                        CPUType <span class="token operator">=</span> <span class="token string">&quot;Intel 486&quot;</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> PROCESSOR_INTEL_PENTIUM<span class="token punctuation">:</span>
                        CPUType <span class="token operator">=</span> <span class="token string">&quot;Intel Pentium&quot;</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> PROCESSOR_MIPS_R4000<span class="token punctuation">:</span>
                        CPUType <span class="token operator">=</span> <span class="token string">&quot;MIPS R4000&quot;</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> PROCESSOR_ALPHA_21064<span class="token punctuation">:</span>
                        CPUType <span class="token operator">=</span> <span class="token string">&quot;DEC Alpha 21064&quot;</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">default</span><span class="token punctuation">:</span>
                        CPUType <span class="token operator">=</span> <span class="token string">&quot;(unknown)&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;Active Processor Mask :&quot;</span> <span class="token operator">+</span> pSI<span class="token punctuation">.</span>dwActiveProcessorMask<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Allocation Granularity :&quot;</span> <span class="token operator">+</span> pSI<span class="token punctuation">.</span>dwAllocationGranularity<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Number Of Processors :&quot;</span> <span class="token operator">+</span> pSI<span class="token punctuation">.</span>dwNumberOfProcessors<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;OEM ID :&quot;</span> <span class="token operator">+</span> pSI<span class="token punctuation">.</span>dwOemId<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;Page Size:&quot;</span> <span class="token operator">+</span> pSI<span class="token punctuation">.</span>dwPageSize<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;Processor Level Value:&quot;</span> <span class="token operator">+</span> pSI<span class="token punctuation">.</span>dwProcessorLevel<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&quot;Processor Revision:&quot;</span> <span class="token operator">+</span> pSI<span class="token punctuation">.</span>dwProcessorRevision<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">&quot;CPU type:&quot;</span> <span class="token operator">+</span> CPUType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&quot;Maximum Application Address: &quot;</span> <span class="token operator">+</span> pSI<span class="token punctuation">.</span>lpMaximumApplicationAddress<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">&quot;Minimum Application Address:&quot;</span> <span class="token operator">+</span> pSI<span class="token punctuation">.</span>lpMinimumApplicationAddress<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">/************** 从 GlobalMemoryStatus 获取返回值****************/</span>

                <span class="token class-name">MEMORYSTATUS</span> memSt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MEMORYSTATUS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">GlobalMemoryStatus</span><span class="token punctuation">(</span><span class="token keyword">ref</span> memSt<span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&quot;Available Page File :&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>memSt<span class="token punctuation">.</span>dwAvailPageFile <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">&quot;Available Physical Memory : &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>memSt<span class="token punctuation">.</span>dwAvailPhys <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">&quot;Available Virtual Memory:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>memSt<span class="token punctuation">.</span>dwAvailVirtual <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">&quot;Size of structur :&quot;</span> <span class="token operator">+</span> memSt<span class="token punctuation">.</span>dwLength<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token string">&quot;Memory In Use :&quot;</span> <span class="token operator">+</span> memSt<span class="token punctuation">.</span>dwMemoryLoad<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">&quot;Total Page Size :&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>memSt<span class="token punctuation">.</span>dwTotalPageFile <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">&quot;Total Physical Memory :&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>memSt<span class="token punctuation">.</span>dwTotalPhys <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                listBox1<span class="token punctuation">.</span><span class="token function">InsertItem</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token string">&quot;Total Virtual Memory :&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>memSt<span class="token punctuation">.</span>dwTotalVirtual <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> er<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>er<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                Application<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Form1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> er<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>er<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>`,26),c=[o];function e(u,l){return s(),a("div",null,c)}const i=n(p,[["render",e],["__file","cspapi5.html.vue"]]);export{i as default};
