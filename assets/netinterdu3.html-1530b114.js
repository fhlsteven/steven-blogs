import{_ as n,o as s,c as a,a as t}from"./app-f0851ed3.js";const p={},o=t(`<h1 id="c-上传文件的一个实现" tabindex="-1"><a class="header-anchor" href="#c-上传文件的一个实现" aria-hidden="true">#</a> C#上传文件的一个实现</h1><blockquote><p>你是第112位浏览该文章的人 痕迹 程序员大联盟 2003-4-9</p></blockquote><p>实现这个General类</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>SqlClient</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">CA<span class="token punctuation">.</span>Components</span><span class="token punctuation">;</span> <span class="token comment">//全部在组件名称空间下</span>

<span class="token keyword">namespace</span> <span class="token namespace">CA<span class="token punctuation">.</span>Components</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">General</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> FilePath<span class="token punctuation">;</span> <span class="token comment">//文件路径</span>

        <span class="token comment">//定义一个枚举用来存放文件的信息 </span>
        <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">File</span>
        <span class="token punctuation">{</span>
            FILE_SIZE<span class="token punctuation">,</span> <span class="token comment">//大小</span>
            FILE_POSTNAME<span class="token punctuation">,</span> <span class="token comment">//</span>
            FILE_SYSNAME<span class="token punctuation">,</span>
            FILE_ORGINNAME<span class="token punctuation">,</span>
            FILE_PATH
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//构造函数</span>
        <span class="token keyword">public</span> <span class="token function">general</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//在WEB.CONFIG中设定AppSettings[&quot;filepath&quot;]，用于存放文件的路径。</span>
            FilePath <span class="token operator">=</span> System<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>ConfigurationSettings<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">&quot;filepath&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// 上传文件通用函数，此方法为静态，系统任何时候均可调用。</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>参数为页面的FILE控件对象<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">UploadFile</span><span class="token punctuation">(</span><span class="token class-name">HtmlInputFile</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">String</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//通过系统时间生成文件名，此功能可以封闭掉，不过中文长文件名支持的不好。</span>
            <span class="token class-name"><span class="token keyword">string</span></span> FileName <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> FileOrginName <span class="token operator">=</span> file<span class="token punctuation">.</span>PostedFile<span class="token punctuation">.</span>FileName<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>PostedFile<span class="token punctuation">.</span>FileName<span class="token punctuation">.</span><span class="token function">LastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>PostedFile<span class="token punctuation">.</span>ContentLength <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> postFileName<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">general</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>FilePath <span class="token operator">+</span> <span class="token string">&quot;\\\\&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">int</span></span> pos <span class="token operator">=</span> file<span class="token punctuation">.</span>PostedFile<span class="token punctuation">.</span>FileName<span class="token punctuation">.</span><span class="token function">LastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                postFileName <span class="token operator">=</span> file<span class="token punctuation">.</span>PostedFile<span class="token punctuation">.</span>FileName<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> file<span class="token punctuation">.</span>PostedFile<span class="token punctuation">.</span>FileName<span class="token punctuation">.</span>Length <span class="token operator">-</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
                file<span class="token punctuation">.</span>PostedFile<span class="token punctuation">.</span><span class="token function">SaveAs</span><span class="token punctuation">(</span>path <span class="token operator">+</span> FileName <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> postFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> exec<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token punctuation">(</span>exec<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name"><span class="token keyword">double</span></span> unit <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">double</span></span> size <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">Round</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>PostedFile<span class="token punctuation">.</span>ContentLength <span class="token operator">/</span> unit<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>File<span class="token punctuation">.</span>FILE_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> size<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//文件大小</span>
            arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>File<span class="token punctuation">.</span>FILE_POSTNAME<span class="token punctuation">]</span> <span class="token operator">=</span> postFileName<span class="token punctuation">;</span><span class="token comment">//文件类型（文件后缀名）</span>
            arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>File<span class="token punctuation">.</span>FILE_SYSNAME<span class="token punctuation">]</span> <span class="token operator">=</span> FileName<span class="token punctuation">;</span><span class="token comment">//文件系统名</span>
            arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>File<span class="token punctuation">.</span>FILE_ORGINNAME<span class="token punctuation">]</span> <span class="token operator">=</span> FileOrginName<span class="token punctuation">;</span><span class="token comment">//文件原来的名字</span>
            arr<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>File<span class="token punctuation">.</span>FILE_PATH<span class="token punctuation">]</span> <span class="token operator">=</span> path <span class="token operator">+</span> FileName <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> postFileName<span class="token punctuation">;</span><span class="token comment">//文件路径</span>
            <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
            <span class="token comment">//throw(new Exception(HtmlUtility.HtmlEncode(IDNO.PostedFile.FileName)));</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>`,4),e=[o];function c(l,u){return s(),a("div",null,e)}const i=n(p,[["render",c],["__file","netinterdu3.html.vue"]]);export{i as default};
