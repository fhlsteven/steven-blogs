import{_ as n,o as s,c as a,a as t}from"./app-d9da1b6d.js";const p="/steven-blogs/assets/diag5_1-69b360ae.png",o="/steven-blogs/assets/diag5_2-8b09e789.png",e="/steven-blogs/assets/diag5_3-3a63a22e.png",c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALjSURBVDhPJZJJTFNRFIbPm2lfW1DAYFy7c+1G4w4SYyAkSggBIiA4ABVBoSCltu8xNNJShogxwSUkrEyMURFECgiVsdZaKEICSC3QidIiSGmu92lyFueee4b/3vOBjE8AAoCUTKkCkgIKgCNZGZ0GcA7gPEtfADgLhJJJ5IABwNkpZxIsPdonwi2tPt8gFIniHZaGU0oVATxAMk3iSgXBMUADsACqJFBXZ78ZNnoDr96PaQKRQdu8WS9k0zTI5aDggSCBkwPuzacClwyg06onPw/4gu++r1p293pnHbVr65b5haft7Tmm9pttxiKhuVBoLe7sfSS1x5JMBks04EVoJXbyFqFBhPoRws5Q7MiKkOPkeAahJYTW6zUlchlD4ApdVSuKxfaDVsdXgz/U6nTddbsbFuYa4n9ez9pafL7+8XHB7xtubblHAalk00B3vwHFQx8/aNY3Na7VG4H90inb1UjEMDqS490WvrkqQtHOUWtNd3cRVsQCB11CSzyy4t/pszsLdkJ5886Lx/EH07aMg0PtnD1nO1Bps+fuBs0mUxZL4HQKmuvqENqatNbsRbVzjivho8JFR3ogWOl05fnD1XZX9vJGydqmrqMjiyPxBBI6xcbjsP3w98DE1PVorOrLwuVtf6n7R4HHWzk1mxlD2qHx9J+7YmPTJTxBJWOhWVuG0PKiXR8+aBubztg/qnG48jc8audSyU6wzjpzLRIXZxxV5p5MigYl3mTfc9G7NeHxDNpmtZu/jAuOh5sek8st7AZ6Rz7d3j98MTpZvuF9aTTlEZgZDFFtdc2zbnO7UWPQl3Z1qBvrc41imagr7jTfb3qcZ7FUiM0lOn15k66OphUEnMavYBgKy5OYS6DxWAmZ/ybnMIpSU4piKEpJkCkYLQlSCi+cAIWcx4uUMwqW4BIoTiUdITU1WarAPNEcEAzFq/7hQUsRkqTxRxMg4wieAuyTDIPvSD4xiWQ5SYmKBwr+Ak54PBfwDJLrAAAAAElFTkSuQmCC",u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALUSURBVDhPJVJbTxNBFD5763a72wKl5aIPvvg/9NHgi0I0MaIEiWBoEZBLacuWtKV0C6VoTFTCxcRnX5QgEBRKwMhCgJRCicQYIHhpy6VcpLUUx1nNnExm5nznfOd8cwAgF4hsABIvXgCCApoECrBxKsgj4DwDFwCMrMqgYnmMAZrJB+B5nrNYTVZ7hUcyvXjuEu0PtWqBAsEgXCTAyIABgKMYmtOxmIEnKVbqbEModobWEVrf2nqP0HZj/b0sXk0Bo+PzaEKt0+mU9Jiapji323lw9HVouDu6PzQf6kqeDcuLfoTCHk9ZR3ttp2RvaTK7XC1Od5MSQADtcDQjtBlLvJWXLRvR1ndTV6PHjg8zpQgNpdKjZ2gRe9OZ7VbRxKgBBJ5ttlSlM2vhyEB0b3AsWH6KBqblqujus1BYOjock2f7Y7HZ8fGXvb1OLAkEuu2P6ku7fHU15ms+z4PW5rtPJItXbHzq9dZXVvud3i6X2+VoWl0J+nw1FA0gtlYjtIM7RugnQt+V/U8cJePoJIEyaZQ5tT4yY2kW5kZEsYLCDE7R9jsZn597/SM6MhG0HCb7puWyb3FRXrof23s8MdW4s/uG56Cj3dTuamCwUCzJ9fi9J78iwRnv8Wn/2PSVRKZ68culjb0SOVKUQoHJjzUOZ5FGA6KtgcLSEsDW1ZpwJTv7o/KSZW3LHN4o3kzcmPt8+QRZJj4VJ04GQysDuJg2uw2DQcPqCvJzrfbKVHo5gyaXVsXQem1k0xQ7cowESw5SffKSb27hVXePTeA5kuCUj8AWCLhw93V1NyWpUvKVd0i3/F23/YE7Nvt1f7fJai0P9DgVJEmAoUBDqpSYPGMOfsEy4BtWD5vAAUUAQUJhoVaZi/8GjIJSYSp8JHk1rWchG48dnlZDlhHH63PwDCtQWg3aXIxmQH+O+ReK+QQC9DQYGDBqyHwKeI1aix2YREkqANDwF0CuMnExhTREAAAAAElFTkSuQmCC",l="/steven-blogs/assets/diag5_3-3a63a22e.png",k="/steven-blogs/assets/diag5_7-b23009e6.png",i="/steven-blogs/assets/diag5_8-4b60bfa4.png",r="/steven-blogs/assets/diag5_9-a3f075a0.png",d={},m=t('<h1 id="用c-制作一个目录选择对话框" tabindex="-1"><a class="header-anchor" href="#用c-制作一个目录选择对话框" aria-hidden="true">#</a> 用C#制作一个目录选择对话框</h1><blockquote><p>作者：王凯明 本文选自：赛迪网 2002年03月19日</p></blockquote><p>C#作为Microsoft.Net战略下的新兴语言，有其不可比拟的强大功能。作为一种RAD语言，它有Visual Basic快速开发应用程序的优点，又不乏C++语言的面相对象的优良特性。</p><p>目录选择对话框是应用程序中经常用到的。它能让用户选择一个系统中的特定的文件目录，在安装程序以及媒体播放器中有大量的运用。本文就从C#快速开发的特点出发，介绍在C#下如何制作应用程序中常用到的目录选择对话框。本文介绍的目录选择对话框是完全基于Windows Forms的，因此具有一些标准窗口所共有的特性。</p><h2 id="一、系统要求" tabindex="-1"><a class="header-anchor" href="#一、系统要求" aria-hidden="true">#</a> 一、系统要求</h2><p>微软公司Windows 2000服务器版或Windows XP 版<br> .Net Framework SDK Beta 2版</p><h2 id="二、实现方法" tabindex="-1"><a class="header-anchor" href="#二、实现方法" aria-hidden="true">#</a> 二、实现方法</h2><p>1．在VS.net下新建一个C#的工程，不妨取名为&quot;FolderSelect&quot;，图示如下：</p><p><img src="'+p+'" alt="diag5_1"></p><p>2．接下来，我们开始界面部分的设计：</p><p>1)先往主界面上添加一个按钮控件、两个标签控件、两个文本框控件（用于显示目录的完整路径以及目录的一些信息）。将按钮控件的Text属性设置为&quot;浏览目录选择对话框&quot;，将两个标签控件的Text属性分别设置为&quot;完整路径：&quot;、&quot;路径信息：&quot;，将第二个文本框的MultiLine属性设置为True。最终设计所得的界面如下：</p><p><img src="'+o+'" alt="diag5_2"></p><p>2)现在我们的主界面已经好了，接着就是完成目录选择对话框的设计。</p><p>选择VS.net的菜单：项目&#39;添加Windows窗体，出现如下图形：</p><p><img src="'+e+'" alt="diag5_3"></p><p>选择默认即可，按&quot;打开&quot;。</p><p>现在开始设计目录选择对话框的界面：</p><p>往窗体上添加两个标签控件、两个按钮控件、一个文本框控件、一个图象列表（ImageList）控件和一个目录树（TreeView）控件。将两个标签控件的的Text属性分别设置为&quot;完整路径：&quot;、&quot;请选择一个文件夹：&quot;；将两个按钮控件的Text属性分别设置为&quot;选择&quot;和&quot;取消&quot;；编辑图象列表控件：给它的Images属性添加两个图标</p><p><img src="'+c+'" alt="diag5_4"></p><p>和</p><p><img src="'+u+'" alt="diag5_5"></p><p>分别表示文件夹关闭和打开状态；将目录树控件的ImageList属性设置为imageList1，并将它的ImageIndex和SelectedImageIndex属性分别设置为0和1。好了，最终的界面如下：</p><p><img src="'+l+`" alt="diag5_6"></p><p>3．现在我们开始编写代码：</p><p>因为我们的程序中均用到了有关目录信息的类，所以必须在每个代码文件的头上添加System.IO名字空间，具体如下：</p><p><code>using System.IO;</code></p><p>1)对于主窗体部分，我们要写的代码量相对较少。因为这是一个测试用的程序，所以主窗体的作用只是用来显示用户所选择的目录的一些相关信息以表明程序能正常运行、目录选择对话框能正常工作，所以只要添加主窗体上按钮的OnClick事件函数即可：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Form2</span> dlg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Form2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> dlg<span class="token punctuation">.</span><span class="token function">ShowDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> DialogResult<span class="token punctuation">.</span>OK<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">DirectoryInfo</span> info <span class="token operator">=</span> dlg<span class="token punctuation">.</span>info<span class="token punctuation">;</span>
            textBox1<span class="token punctuation">.</span>Text <span class="token operator">=</span> dlg<span class="token punctuation">.</span>fullPath<span class="token punctuation">;</span>

            <span class="token comment">// 在文本框中添加目录信息</span>
            <span class="token class-name"><span class="token keyword">string</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span> strArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span></span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            strArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;创建时间 : &quot;</span><span class="token operator">+</span> info<span class="token punctuation">.</span>CreationTime<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            strArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;全名 : &quot;</span><span class="token operator">+</span> info<span class="token punctuation">.</span>FullName<span class="token punctuation">;</span>
            strArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;上次访问时间 : &quot;</span><span class="token operator">+</span> info<span class="token punctuation">.</span>LastAccessTime<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            strArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;上次改写时间 : &quot;</span><span class="token operator">+</span> info<span class="token punctuation">.</span>LastWriteTime<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            textBox2<span class="token punctuation">.</span>Lines <span class="token operator">=</span> strArray<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span> <span class="token class-name">Exception</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  
</code></pre></div><p>2)对于文件选择对话框，我们要完成系统驱动器及其子目录的取得并显示、设定目录路径信息以及目录相关信息等工作，所以代码量相对较大。先给该类添加两个必须的私有数据成员如下：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">string</span></span> driveLetters <span class="token operator">=</span> <span class="token string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 用于列举驱动器盘符</span>
<span class="token keyword">private</span> <span class="token class-name">DirectoryInfo</span> folder<span class="token punctuation">;</span> <span class="token comment">// 用于保存目录信息</span>

修改类的构造函数如下：<span class="token function">fillTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span>函数在后面介绍
<span class="token keyword">public</span> <span class="token function">Form2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
    <span class="token comment">// Required for Windows Form Designer support</span>
    <span class="token comment">//</span>
    <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//</span>
    <span class="token comment">// TODO: Add any constructor code after InitializeComponent call</span>
    <span class="token comment">//</span>
    <span class="token function">fillTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 该函数调用完成目录选择对话框的初始设置</span>
<span class="token punctuation">}</span>  
</code></pre></div><p>接着为该类添加几个有用的成员函数<code>fillTree()</code>、<code>getSubDirs()</code>、<code>fixPath()</code>，访问类型均为Private。<code>fillTree()</code>函数用来设置目录树的各个节点以填充到目录树控件，这样目录树中就充满了系统中各个根目录以及其所有子目录的节点。<code>getSubDirs()</code>函数用来获得各个目录节点可能存在的所有子节点，其中用到了递推搜索算法。<code>fixPath()</code>函数用来设置文本框的内容，使当前用户所选择的目录显示在文本框中。各函数如下：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">fillTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DirectoryInfo</span> directory<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> sCurPath <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 重新清空</span>
    treeView1<span class="token punctuation">.</span>Nodes<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 将硬盘上的所有的驱动器都列举出来</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">char</span></span> c <span class="token keyword">in</span> driveLetters<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sCurPath <span class="token operator">=</span> c <span class="token operator">+</span> <span class="token string">&quot;:\\\\&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 获得该路径的目录信息</span>
            directory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryInfo</span><span class="token punctuation">(</span>sCurPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 如果获得的目录信息正确，则将它添加到目录树视中</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>directory<span class="token punctuation">.</span>Exists <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">TreeNode</span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TreeNode</span><span class="token punctuation">(</span>directory<span class="token punctuation">.</span>FullName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                treeView1<span class="token punctuation">.</span>Nodes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加新的节点到根节点</span>
                <span class="token function">getSubDirs</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 调用getSubDirs（）函数，检查该驱动器上的任何存在子目录</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> doh<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>doh<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">getSubDirs</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> parent<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DirectoryInfo</span> directory<span class="token punctuation">;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 如果还没有检查过这个文件夹，则检查之</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>Nodes<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            directory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryInfo</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>FullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DirectoryInfo</span> dir <span class="token keyword">in</span> directory<span class="token punctuation">.</span><span class="token function">GetDirectories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// 新建一个数节点，并添加到目录树视</span>
                <span class="token class-name">TreeNode</span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TreeNode</span><span class="token punctuation">(</span>dir<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                parent<span class="token punctuation">.</span>Nodes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">TreeNode</span> node <span class="token keyword">in</span> parent<span class="token punctuation">.</span>Nodes<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 如果还没有检查过这个文件夹，则检查</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>Nodes<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                directory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryInfo</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>FullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 检查该目录上的任何子目录</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DirectoryInfo</span> dir <span class="token keyword">in</span> directory<span class="token punctuation">.</span><span class="token function">GetDirectories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// 新建一个数节点，并添加到目录树视</span>
                    <span class="token class-name">TreeNode</span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TreeNode</span><span class="token punctuation">(</span>dir<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    node<span class="token punctuation">.</span>Nodes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> doh<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>doh<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">fixPath</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> node<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> sRet <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        sRet <span class="token operator">=</span> node<span class="token punctuation">.</span>FullPath<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> index <span class="token operator">=</span> sRet<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\\\\\&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            sRet <span class="token operator">=</span> node<span class="token punctuation">.</span>FullPath<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> doh<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>doh<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> sRet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接着，给该类添加以下几个属性，这几个属性都是反映所选择的目录的相关信息的，它们将被主窗体的类调用：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">string</span> name<span class="token comment">// 返回所选择的目录的名称</span>
<span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>folder <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> folder<span class="token punctuation">.</span>Exists<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> folder<span class="token punctuation">.</span>Name <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">string</span> fullPath<span class="token comment">// 返回所选择的目录的完整路径</span>
<span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>folder <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> folder<span class="token punctuation">.</span>Exists <span class="token operator">&amp;&amp;</span> treeView1<span class="token punctuation">.</span>SelectedNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token function">fixPath</span><span class="token punctuation">(</span>treeView1<span class="token punctuation">.</span>SelectedNode<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> DirectoryInfo info<span class="token comment">// 返回所选择的目录的信息</span>
<span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>folder <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> folder<span class="token punctuation">.</span>Exists<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> folder <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后，还要添加目录树控件的<code>BeforeSelect()</code>和<code>BeforeExpand()</code>事件函数以及两个按钮的OnClick事件函数。<code>BeforeSelect()</code>事件函数是用户选定目录前的一个事件函数，它完成了子目录取得、设置文本框内容、获取该目录信息等功能。同样，<code>BeforeExpand()</code>事件函数完成相似的功能，只不过它是在目录节点被展开前发生的。具体的函数实现如下：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">treeView1_BeforeSelect</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>TreeViewCancelEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">getSubDirs</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取得选择节点的子文件夹</span>
    textBox1<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token function">fixPath</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新文本框内容</span>
    folder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Node<span class="token punctuation">.</span>FullPath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得它的目录信息</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">treeView1_BeforeExpand</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>TreeViewCancelEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">getSubDirs</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取得选择节点的子文件夹</span>
    textBox1<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token function">fixPath</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新文本框内容</span>
    folder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DirectoryInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Node<span class="token punctuation">.</span>FullPath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得它的目录信息</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token comment">// &quot;选择&quot;按钮的消息处理函数</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>DialogResult <span class="token operator">=</span> DialogResult<span class="token punctuation">.</span>OK<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button2_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token comment">// &quot;取消&quot;按钮的消息处理函数</span>
<span class="token punctuation">{</span>
    folder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>4．到此为止，我们已经完成了所有的代码编写工作。现在可以按Ctrl＋F5试试运行效果了。首先会出现下面的主窗体：</p><p><img src="`+k+'" alt="diag5_7"><br> 按下&quot;浏览目录选择对话框&quot;按钮后就出现下面的目录选择对话框了：</p><p><img src="'+i+'" alt="diag5_8"><br></p><p>在目录选择对话框上选定一个目录后，我们按&quot;选择&quot;按钮。这样我们又回到了程序的主界面。因为该主界面是用来显示所选择的目录的一些相关信息的，其中包括了：完整路径、路径信息中的创建时间、全名、上次访问时间、上次改写时间等。图示如下：</p><p><img src="'+r+'" alt="diag5_9"><br></p><p>这样，我们就完成了程序的测试工作了。当然这样的范例是还没有实用功能的，不过你可以试着用同样的方法开发出一个合适的目录选择对话框运用到自己的应用程序中，甚至是一个目录选择对话框组件以供后来者使用，让更多的人受益于你的成果。这样其效用就完全不同了，作为作者的我也会感到相当欣慰的。</p><h2 id="三、总结" tabindex="-1"><a class="header-anchor" href="#三、总结" aria-hidden="true">#</a> 三、总结</h2><p>现在这个程序虽然只具有一般的目录选择功能，不过做完这个程序，我们不难发现用C#完成一些应用程序是非常方便的。相比以前我们在SDK、MFC下完成这些还要写很多东西，工作量是非常大而且复杂的。现在微软为我们做好了许多此类工作，我们何不乐意接受呢？所以，快加入C#的行列吧。</p><blockquote><p>（责任编辑 尤北）</p></blockquote>',45),g=[m];function w(y,A){return s(),a("div",null,g)}const h=n(d,[["render",w],["__file","diag5.html.vue"]]);export{h as default};
