import{_ as n,o as s,c as a,a as t}from"./app-d9da1b6d.js";const p={},o=t(`<h1 id="datagrid使用技巧" tabindex="-1"><a class="header-anchor" href="#datagrid使用技巧" aria-hidden="true">#</a> DataGrid使用技巧</h1><p>有时候听有些朋友抱怨.NET的DataGrid不是很好用。就我个人的体会，DataGrid的功能非常强大，可以使我们随心所欲的完成各种各样的工作，可惜就是实现起来不够简单明了。我对平时经常碰到的一些问题积累了一些解决的方法，现在把它们总结一下供大家参考。</p><p>比较经常碰到的一个问题是：我们希望DataGrid的某一列只能输入特定的文本，比如：不能输入数字。下面的例子说明如何实现这种功能。</p><p>新建一个Window应用程序，加入一个DataGrid和SqlConnection，连接SQL数据库NorthWind。</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">namespace</span> <span class="token namespace">WindowsApplication1</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Form1</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Form</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">myDataGrid</span> dataGrid1<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>SqlClient<span class="token punctuation">.</span>SqlConnection</span> sqlConnection1<span class="token punctuation">;</span>
        <span class="token comment">//加入全局变量oldvalue，用它表示单元格原来的文本。</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> oldvalue<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Form1_Load</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            oldvalue<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token class-name">SqlDataAdapter</span> sda<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token string">&quot;select LastName,FirstName from employees&quot;</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>sqlConnection1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DataSet</span> ds<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sda<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">,</span><span class="token string">&quot;employees&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DataGridTableStyle</span> ats<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTableStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ats<span class="token punctuation">.</span>MappingName<span class="token operator">=</span><span class="token string">&quot;employees&quot;</span><span class="token punctuation">;</span>
            <span class="token class-name">DataGridColorColumn</span> dcs1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridColorColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dcs1<span class="token punctuation">.</span>HeaderText<span class="token operator">=</span><span class="token string">&quot;lastname&quot;</span><span class="token punctuation">;</span>
            ats<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dcs1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DataGridTextBoxColumn</span> dcs2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTextBoxColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dcs2<span class="token punctuation">.</span>HeaderText<span class="token operator">=</span><span class="token string">&quot;firstname&quot;</span><span class="token punctuation">;</span>
            dcs2<span class="token punctuation">.</span>MappingName<span class="token operator">=</span><span class="token string">&quot;FirstName&quot;</span><span class="token punctuation">;</span>
            dcs2<span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>TextChanged<span class="token operator">+=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventHandler</span><span class="token punctuation">(</span>DataGridTextChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>
            dcs2<span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>Enter<span class="token operator">+=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventHandler</span><span class="token punctuation">(</span>DataGridTextBox_Enter<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ats<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dcs2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ats<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token operator">=</span>ds<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataMember<span class="token operator">=</span><span class="token string">&quot;employees&quot;</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DataGridTextBox_Enter</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span><span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//当某一单元格获得焦点时，记录单元格的文本</span>
            oldvalue<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DataGridTextBoxColumn<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DataGridTextChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span><span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> str<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DataGridTextBoxColumn<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
            <span class="token comment">//当单元格的文本改变时，检验是否有非法字符</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>index<span class="token operator">&lt;</span>str<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//如果发现数字，显示错误信息并将单元格还原为原内容</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>Char<span class="token punctuation">.</span><span class="token function">IsDigit</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">&quot;不能输入数字，请重新输入&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>DataGridTextBoxColumn<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>Text<span class="token operator">=</span>oldvalue<span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                index<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>`,5),e=[o];function c(u,l){return s(),a("div",null,e)}const i=n(p,[["render",c],["__file","dg19.html.vue"]]);export{i as default};
