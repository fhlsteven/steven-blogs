import{_ as n,o as s,c as a,a as t}from"./app-f0851ed3.js";const p={},o=t(`<h1 id="用-net中的socket实现文件传输" tabindex="-1"><a class="header-anchor" href="#用-net中的socket实现文件传输" aria-hidden="true">#</a> 用.net中的socket实现文件传输</h1><p>socket是网络套接字，使用它我们可以很方便的实现网络的数据传输。在.net中提供了socket类来帮助开发者调用socket的使用，从而避免了调用socket的动态库来实现socket的麻烦。下面我们就来看一个简单的例子，从这个简单的例子来看看.net中的socket类实现socket是多么的方便。</p><p>编程思路：在这个简单的例子中我们将通过socket来实现文件的网络传输和接收功能。要实现这两个功能我们需要通过vs.net建立两个实例来完成。一个发送端，一个接收端。由于文中已经给出了详细的注释这里就不罗嗦了。</p><p>发送端</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Class</span> Form1
    <span class="token keyword">Inherits</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Form
    <span class="token keyword">Private</span> <span class="token keyword">Sub</span> Button1_Click<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> System<span class="token punctuation">.</span><span class="token keyword">Object</span><span class="token punctuation">,</span>
    　　<span class="token keyword">ByVal</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>EventArgs<span class="token punctuation">)</span> <span class="token keyword">Handles</span> Button1<span class="token punctuation">.</span>Click
        <span class="token keyword">Dim</span> sendsocket <span class="token keyword">As</span> <span class="token keyword">New</span> Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>Socket
　　<span class="token punctuation">(</span>Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>AddressFamily<span class="token punctuation">.</span>InterNetwork<span class="token punctuation">,</span>
　　Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>SocketType<span class="token punctuation">.</span>Stream<span class="token punctuation">,</span> Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>ProtocolType<span class="token punctuation">.</span>Tcp<span class="token punctuation">)</span>
　　<span class="token comment">&#39;实例化socket</span>
        <span class="token keyword">Dim</span> ipendpiont <span class="token keyword">As</span> <span class="token keyword">New</span> Net<span class="token punctuation">.</span>IPEndPoint
　　<span class="token punctuation">(</span>Net<span class="token punctuation">.</span>IPAddress<span class="token punctuation">.</span>Parse<span class="token punctuation">(</span><span class="token string">&quot;192.168.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token comment">&#39;建立终结点</span>
        <span class="token comment">&#39;OpenFileDialog1.ShowDialog()</span>
        <span class="token keyword">Dim</span> fs <span class="token keyword">As</span> <span class="token keyword">New</span> IO<span class="token punctuation">.</span>FileStream<span class="token punctuation">(</span><span class="token string">&quot;c:\\p.doc&quot;</span><span class="token punctuation">,</span>
　　IO<span class="token punctuation">.</span>FileMode<span class="token punctuation">.</span>OpenOrCreate<span class="token punctuation">,</span> IO<span class="token punctuation">.</span>FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token comment">&#39;要传输的文件</span>
        <span class="token keyword">Dim</span> fssize<span class="token punctuation">(</span>fs<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
        <span class="token keyword">Dim</span> strread <span class="token keyword">As</span> <span class="token keyword">New</span> IO<span class="token punctuation">.</span>BinaryReader<span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token comment">&#39;流处理要传输的文件</span>
        <span class="token comment">&#39;fs.Read(fssize, 0, fssize.Length - 1)</span>
        strread<span class="token punctuation">.</span>Read<span class="token punctuation">(</span>fssize<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> fssize<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        sendsocket<span class="token punctuation">.</span>Connect<span class="token punctuation">(</span>ipendpiont<span class="token punctuation">)</span><span class="token comment">&#39;连接远程计算机</span>
        sendsocket<span class="token punctuation">.</span>Send<span class="token punctuation">(</span>fssize<span class="token punctuation">)</span><span class="token comment">&#39;发送文件</span>
        Label1<span class="token punctuation">.</span>Text <span class="token operator">=</span> fs<span class="token punctuation">.</span>Length<span class="token punctuation">(</span><span class="token punctuation">)</span>
        fs<span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sendsocket<span class="token punctuation">.</span>Shutdown<span class="token punctuation">(</span>Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>SocketShutdown<span class="token punctuation">.</span>Send<span class="token punctuation">)</span>
　　<span class="token comment">&#39;关闭发送连接</span>
        sendsocket<span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">&#39;关闭本机socket</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">End</span> <span class="token keyword">Class</span>
</code></pre></div><p>接收端</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Class</span> Form1
    <span class="token keyword">Inherits</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Form
    <span class="token keyword">Dim</span> receivesocket <span class="token keyword">As</span> <span class="token keyword">New</span> Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>Socket
    　　<span class="token punctuation">(</span>Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>AddressFamily<span class="token punctuation">.</span>InterNetwork<span class="token punctuation">,</span>
    　　Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>SocketType<span class="token punctuation">.</span>Stream<span class="token punctuation">,</span>
    　　Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>ProtocolType<span class="token punctuation">.</span>Tcp<span class="token punctuation">)</span>
    <span class="token keyword">Private</span> <span class="token keyword">Sub</span> Form1_Load<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> System<span class="token punctuation">.</span><span class="token keyword">Object</span><span class="token punctuation">,</span>
    　　　　<span class="token keyword">ByVal</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>EventArgs<span class="token punctuation">)</span> <span class="token keyword">Handles</span> <span class="token keyword">MyBase</span><span class="token punctuation">.</span>Load
        <span class="token keyword">Dim</span> hostipendpiont <span class="token keyword">As</span> <span class="token keyword">New</span> Net<span class="token punctuation">.</span>IPEndPoint
　　<span class="token punctuation">(</span>Net<span class="token punctuation">.</span>IPAddress<span class="token punctuation">.</span>Parse<span class="token punctuation">(</span><span class="token string">&quot;192.168.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span>
        receivesocket<span class="token punctuation">.</span>Bind<span class="token punctuation">(</span>hostipendpiont<span class="token punctuation">)</span>
　　<span class="token comment">&#39;建立远程计算机的的socket</span>
        receivesocket<span class="token punctuation">.</span>Listen<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">&#39;监听socket</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span>

    <span class="token keyword">Private</span> <span class="token keyword">Sub</span> Button1_Click<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span>
    　　<span class="token keyword">ByVal</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>EventArgs<span class="token punctuation">)</span> <span class="token keyword">Handles</span> Button1<span class="token punctuation">.</span>Click
        <span class="token keyword">Dim</span> recfs <span class="token keyword">As</span> <span class="token keyword">New</span> IO<span class="token punctuation">.</span>FileStream<span class="token punctuation">(</span><span class="token string">&quot;p.doc&quot;</span><span class="token punctuation">,</span>
　　IO<span class="token punctuation">.</span>FileMode<span class="token punctuation">.</span>OpenOrCreate<span class="token punctuation">)</span>
　　<span class="token comment">&#39;接收数据并将其保存到一个新的文件中</span>
        <span class="token keyword">Dim</span> recbyte<span class="token punctuation">(</span><span class="token number">229888</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Byte</span>
        <span class="token keyword">Dim</span> hostsocket <span class="token keyword">As</span> Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>Socket <span class="token operator">=</span>
　　receivesocket<span class="token punctuation">.</span>Accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
　　<span class="token comment">&#39;同意和发送端计算机建立连接</span>
        <span class="token keyword">Dim</span> newfilestr <span class="token keyword">As</span> <span class="token keyword">New</span> IO<span class="token punctuation">.</span>BinaryWriter<span class="token punctuation">(</span>recfs<span class="token punctuation">)</span><span class="token comment">&#39;流写</span>
        hostsocket<span class="token punctuation">.</span>Receive<span class="token punctuation">(</span>recbyte<span class="token punctuation">)</span>
        <span class="token comment">&#39;recfs.Write(recbyte, 0, recbyte.Length - 1)</span>
        newfilestr<span class="token punctuation">.</span>Write<span class="token punctuation">(</span>recbyte<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> recbyte<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        recfs<span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        hostsocket<span class="token punctuation">.</span>Shutdown<span class="token punctuation">(</span>Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>SocketShutdown<span class="token punctuation">.</span>Receive<span class="token punctuation">)</span>
        hostsocket<span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">End</span> <span class="token keyword">Class</span> 
</code></pre></div><p>通过上面的简单语句我们就完成网络文件的发送和接收，但是这里有一点要注意，此代码只可以接受文本文件和图片文件，对于其他文件的发送和接收将导致编码错误，如果你不相信你可以传输一个mp3文件，再在播放器中打开接收到的mp3文件，你会听到只有开头不到2秒的音乐可以播放。如果想解决这个问题你需要使用，net中的tcp/ip类或udp类来实现，当然调用底层的socket动态库也可以解决这个问题。</p>`,8),e=[o];function c(k,u){return s(),a("div",null,e)}const i=n(p,[["render",c],["__file","netsoc5.html.vue"]]);export{i as default};
