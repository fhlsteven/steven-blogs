import{_ as e,r as p,o as c,c as l,b as n,d as a,e as t,a as o}from"./app-d9da1b6d.js";const u="/steven-blogs/assets/dg39_1-751774a5.png",i="/steven-blogs/assets/dg39_2-2dfcea79.png",r={},k=o(`<h1 id="windows-forms-datagrid" tabindex="-1"><a class="header-anchor" href="#windows-forms-datagrid" aria-hidden="true">#</a> Windows Forms Datagrid</h1><blockquote><p>George Shepherd&#39;s Windows Forms FAQ</p></blockquote><h2 id="_5-windows-forms-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-windows-forms-datagrid" aria-hidden="true">#</a> 5. Windows Forms Datagrid</h2><p>5.1 How can I translate a point to a cell in the datagrid?</p><p>5.2 I lost the settings in my DataGrid set during design-time?</p><p>5.3 How do I prevent a click into the grid highlighting a cell?</p><p>5.4 How do I prevent the datagrid from displaying its append row (the row at the end with an asterisk)?</p><p>5.5 How can I put a combobox in a column of a datagrid?</p><p>5.6 How can I catch a double-click into a column header cell?</p><p>5.7 How can I select the entire row when the user clicks on a cell in the row?</p><p>5.8 How can I get text from a column header in a MouseUp event?</p><p>5.9 How do I hide a column?</p><p>5.10 How do I color a individual cell depending upon its value or some external method?</p><p>5.11 How can I put a checkbox in a column of my DataGrid?</p><p>5.12 How can I restrict the keystrokes that will be accepted in a column of my datagrid?</p><p>5.13 How do I make a field auto increment as new rows are added to my datagrid?</p><p>5.14 How can I prevent a particular cell from being editable?</p><p>5.15 How do I move columns in a datagrid?</p><p>5.16 How can I do cell by cell validation in a datagrid?</p><p>5.17 How do I programmatically determine the selected rows in a datagrid?</p><p>5.18 How can I move rows by dragging the row header cell?</p><p>5.19 I want to do custom handling of special keys such as the Tab key or F2 in the TextBox of a column in the DataGrid. How do I subclass this TextBox to get at it virtual members?</p><p>5.20 How can I have a column of icons in my datagrid?</p><p>5.21 How can I tell if the current row has changed and whether I am on the AddNew row or not?</p><p>5.22 How do I hide the gridlines or set them to a particular color?</p><p>5.23 How can I get the selected text in an active gridcell?</p><p>5.24 How do I determine whether a checkbox in my datagrid is checked or not?</p><p>5.25 How can I bind the datagrid to a datasource without using any wizards?</p><p>5.26 How can I bind two datagrids in a Master-Detail relationship?</p><p>5.27 How do I get the row or column that has been clicked on?</p><p>5.28 How do I add an unbound column to my bound datagrid?</p><p>5.29 How do I get the row and column of the current cell in my datagrid?</p><p>5.30 How can I prevent the Enter key from moving to the next cell when the user is actively editing the cell and presses Enter?</p><p>5.31 How do I set the width of a column in my DataGrid?</p><p>5.32 How can I implement OLE Drag &amp; Drop between a DataGrid and another OLE DnD object that supports the Text format?</p><p>5.33 How can I make my DataGrid support a single select mode, and not the default multiselect mode?</p><p>5.34 How can I get celltips or tooltips to vary from cell to cell in my DataGrid?</p><p>5.35 How can I get notification of the changing of a value in a column of comboboxes within my datagrid?</p><p>5.36 How can I make the datagrid have no currentcell?</p><p>5.37 How can I make my grid never have an active edit cell and always select whole rows (as in a browser-type grid)?</p><p>5.38 I have hidden (column width = 0) columns on the right side of my datagrid, but tabbing does not work properly. How can I get tabbing to work?</p><p>5.39 How can I get the number of rows in my DataGrid?</p><p>5.40 How do I format a date column in a datagrid?</p><p>5.41 How can I change the width of the row headers or hide them?</p><p>5.42 How do I catch a doubleclick in my datagrid?</p><p>5.43 How can I make my last column wide enough to exactly occupy all the client area of the datagrid?</p><p>5.44 How can I prevent my user from sizing columns in my datagrid?</p><p>5.45 How can I catch the bool values changing in a DataGridBoolColumn?</p><p>5.46 When I click on a row header, the row is selected and no cell is active. How can I do this programmatically?</p><p>5.47 How can I force the vertical scrollbar in my DataGrid to always be visible?</p><p>5.48 How can I autosize a column in my datagrid?</p><p>5.49 How can I get rid of the error icon that appears when there is an editing error?</p><p>5.50 How do I find the top-left visible cell in a datagrid?</p><p>5.51 I want to display negative values with a CR suffix, instead of a minus sign. How can I perform custom formatting on the cells in my datagrid?</p><p>5.52 I want to do sort of a database join of two tables. How can I use data from two DataTables in a single DataGrid?</p><p>5.53 How do I display a column of buttons such as pushbuttons or combobox buttons?</p><p>5.54 How can I put up a confirmation question when the user tries to delete a row in the datagrid by clicking on the row header and pressing the Delete key?</p><p>5.55 How can I enable column selections in my datagrid?</p><p>5.56 How do I programmatically scroll the datagrid to a particular row?</p><p>5.57 How can I place text in the rowheader column of my datagrid?</p><p>5.58 How do I set default values for new rows in my datagrid?</p><p>5.59 How do I iterate through all the rows and columns in my datagrid?</p><p>5.60 How can I specially color only the currentcell of my readonly datagrid?</p><p>5.61 How can I make the Enter Key behave like the Tab Key and move to the next cell?</p><p>5.62 How do I use the DataColumn.Expression property to add a computed/combined column to my datagrid?</p><p>5.63 How can I change the font used in a grid cell on a cell by cell or row by row basis?</p><p>5.64 How can I use a mouse to select cell ranges in my datagrid?</p><p>5.65 How do I determine the DataGridTableStyle MappingName that should used for a DataGrid to make sure the grid uses my tablestyle?</p><p>5.66 I have a derived DataGridColumnStyle. From within my Paint override, how can I get at other values in the DataGrid?</p><p>5.67 How do I retrieve the current row from a DataTable bound to a DataGrid after the grid has been sorted?</p><p>5.68 How can I catch when the user clicks off the grid, say to close the form?</p><p>5.69 How can I get a CheckBox column in a DataGrid to react to the first click?</p><p>5.70 How can I use events to restrict key input to grid cells?</p><p>5.71 How can I format columns in my DataGrid without explicilty adding DataGridColumnStyles?</p><p>5.72 How can I auto-adjust keyboard input? For example, make typing 12312002 be taken as a valid date, 12/31/2002.</p><p>5.73 Can I display the rows in my datagrid in a free-form layout using textboxes on a panel?</p><p>5.74 How can I tell whether a scrollbar is visible in my DataGrid is visible?</p><p>5.75 How do I autosize the columns in my DataGrid so they always fill the the grid&#39;s client area?</p><p>5.76 How can I prevent all the cells in my DataGrid from being edited without deriving GridColumnStyle?</p><p>5.77 How can I prevent the plus-minus icon that appears next to the row header when I have a datagrid displayed bound to a datasource that has a relation defined?</p><p>5.78 How can I display master-details-details in three separate grids?</p><p>5.79 In my datagrid, if I press tab to enter a column using a derived columnstyle, the column does not receive focus. Why?</p><p>5.80 How can I detect when a cell starts being edited, not when it becomes current?</p><p>5.81 How can I have a column of bitmaps in a DataGrid?</p><p>5.82 How can I add my custom columnstyles to the designer so I can use them in my DataGrid at design time?</p><h3 id="_5-1-how-can-i-translate-a-point-to-a-cell-in-the-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-1-how-can-i-translate-a-point-to-a-cell-in-the-datagrid" aria-hidden="true">#</a> 5.1 How can I translate a point to a cell in the datagrid?</h3><p>If the point, say pt, is in screen coordinates, you can use code such as</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">Point</span> p1 <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span><span class="token function">PointToClient</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span>
MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you are using context menus for catching right-clicks in the grid, you have to do a little work to remember where the original right-click point was as the point passed in through the menu event arguments may not reflect this original click. One solution is to remember the click in the grid MouseDown event, and then use the code above to retrieve the grid cell from within the menu handler.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">Point</span> rightMouseDownPoint<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dataGrid1_MouseDown</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Button <span class="token operator">==</span> MouseButtons<span class="token punctuation">.</span>Right<span class="token punctuation">)</span>
        rightMouseDownPoint <span class="token operator">=</span> Cursor<span class="token punctuation">.</span>Position<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">menuItem4_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Point</span> pt <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span><span class="token function">PointToClient</span><span class="token punctuation">(</span>rightMouseDownPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-2-i-lost-the-settings-in-my-datagrid-set-during-design-time" tabindex="-1"><a class="header-anchor" href="#_5-2-i-lost-the-settings-in-my-datagrid-set-during-design-time" aria-hidden="true">#</a> 5.2 I lost the settings in my DataGrid set during design-time?</h3><p>This is possible if you assign a custom DataGridTableStyle to the DataGrid. The properties in the DataGridTableStyle will then replace certain properties in the DataGrid. Take a look at DataGrid class reference for a list of these properties.</p><h3 id="_5-3-how-do-i-prevent-a-click-into-the-grid-highlighting-a-cell" tabindex="-1"><a class="header-anchor" href="#_5-3-how-do-i-prevent-a-click-into-the-grid-highlighting-a-cell" aria-hidden="true">#</a> 5.3 How do I prevent a click into the grid highlighting a cell?</h3><p>Set the grid&#39;s Enabled property to false.</p><p><code>dataGrid1.Enabled = false;</code></p><h3 id="_5-4-how-do-i-prevent-the-datagrid-from-displaying-its-append-row-the-row-at-the-end-with-an-asterisk" tabindex="-1"><a class="header-anchor" href="#_5-4-how-do-i-prevent-the-datagrid-from-displaying-its-append-row-the-row-at-the-end-with-an-asterisk" aria-hidden="true">#</a> 5.4 How do I prevent the datagrid from displaying its append row (the row at the end with an asterisk)?</h3><p>The DataGrid class does not have a property that controls whether a new row can be added. But the DataView class does have such a property (along with some others such as AllowEdit and AllowDelete). Here is code that will turn off the append row by getting at the dataview associated with the datagrid.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">string</span></span> connString <span class="token operator">=</span> <span class="token string">@&quot;Provider=Microsoft.JET.OLEDB.4.0;data source=C:\\northwind.mdb&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> sqlString <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM customers&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Connection object</span>
<span class="token class-name">OleDbConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>connString<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create data adapter object</span>
<span class="token class-name">OleDbDataAdapter</span> dataAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbDataAdapter</span><span class="token punctuation">(</span>sqlString<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a dataset object and fill with data using data adapter&#39;s Fill method</span>
<span class="token class-name">DataSet</span> dataSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dataAdapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>dataSet<span class="token punctuation">,</span> <span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Attach dataset&#39;s DefaultView to the datagrid control</span>
dataGrid1<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//no adding of new rows thru dataview...</span>
<span class="token class-name">CurrencyManager</span> cm <span class="token operator">=</span> <span class="token punctuation">(</span>CurrencyManager<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>BindingContext<span class="token punctuation">[</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> dataGrid1<span class="token punctuation">.</span>DataMember<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span>DataView<span class="token punctuation">)</span>cm<span class="token punctuation">.</span>List<span class="token punctuation">)</span><span class="token punctuation">.</span>AllowNew <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre></div><p>If your datagrid contains links, then Matthew Miller suggest adding Navigate handler such as the one below to disallow the AddNew.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DataGrid1_Navigate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>NavigateEventArgs</span> ne<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ne<span class="token punctuation">.</span>Forward<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">CurrencyManager</span> cm <span class="token operator">=</span> <span class="token punctuation">(</span>CurrencyManager<span class="token punctuation">)</span>BindingContext<span class="token punctuation">[</span>DataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span>DataGrid1<span class="token punctuation">.</span>DataMember<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">DataView</span> dv <span class="token operator">=</span> <span class="token punctuation">(</span>DataView<span class="token punctuation">)</span> cm<span class="token punctuation">.</span>List<span class="token punctuation">;</span>
        dv<span class="token punctuation">.</span>AllowNew <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-5-how-can-i-put-a-combobox-in-a-column-of-a-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-5-how-can-i-put-a-combobox-in-a-column-of-a-datagrid" aria-hidden="true">#</a> 5.5 How can I put a combobox in a column of a datagrid?</h3><p>There are several ways to go about this task. The simplest way involves adding a single combobox to the DataGrid.Controls, and then selectively displaying it as needed when a combobox cell becomes the currentcell. All the work is done in a few event handlers and no overrides or derived classes are necessary. This technique is discussed in Microsoft KB article Q323167.</p><p>The other techniques require you to derive a columnstyle. Attached is a dropdown combobox sample (C#, VB) that shows how you can use a combobox in a datagrid. This implementation differs from other available columnstyle samples (gotdotnet.com and C# Corner ) in that it derives from DataGridTextBoxColumn. These other samples derive directly from DataGridColumnStyle, and thus have to add functionality that already exists in DataGridTextBoxColumn.</p><p>This derived DataGridTextBoxColumn does not implement a databound combobox where you can set its DataSource, DisplayMember, and ValueMember to bind the combobox to a foreign table. If you need such a combobox, there is another sample link referenced at the end of this FAQ that does implement such a databound combobox.</p><p>This sample just attempts to replace the TextBox member of DataGridTextBoxColumn with a standard ComboBox member. Only two overrides need to be handled along with 2 events to get a functional implementation.</p><p>Here are the notes from the code that list the 3 steps to add a combobox to your datagrid.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// Step 1. Derive a custom column style from DataGridTextBoxColumn</span>
<span class="token comment">//     a) add a ComboBox member</span>
<span class="token comment">// b) track when the combobox has focus in Enter and Leave events</span>
<span class="token comment">// c) override Edit to allow the ComboBox to replace the TextBox</span>
<span class="token comment">// d) override Commit to save the changed data</span>

<span class="token comment">// Step 2 - Use the combo column style</span>
<span class="token comment">// Add 1 col with combo style</span>
<span class="token class-name">DataGridComboBoxColumn</span> ComboTextCol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridComboBoxColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ComboTextCol<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token string">&quot;custCity&quot;</span><span class="token punctuation">;</span>
ComboTextCol<span class="token punctuation">.</span>HeaderText <span class="token operator">=</span> <span class="token string">&quot;Customer Address&quot;</span><span class="token punctuation">;</span>
ComboTextCol<span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

ts1<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ComboTextCol<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Step 3 - Additional setup for Combo style</span>
<span class="token comment">// a) make the row height a little larger to handle minimum combo height</span>
ts1<span class="token punctuation">.</span>PreferredRowHeight <span class="token operator">=</span> ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>Height <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">// b) Populate the combobox somehow. It is a normal combobox, so whatever...</span>
ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Chicago&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Corvallis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Denver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Great Falls&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Kansas City&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Los Angeles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Raleigh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Washington&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// c) set the dropdown style of the combo...</span>
ComboTextCol<span class="token punctuation">.</span>ColumnComboBox<span class="token punctuation">.</span>DropDownStyle <span class="token operator">=</span> ComboBoxStyle<span class="token punctuation">.</span>DropDownList<span class="token punctuation">;</span>
</code></pre></div><h4 id="databound-combobox-sample" tabindex="-1"><a class="header-anchor" href="#databound-combobox-sample" aria-hidden="true">#</a> Databound ComboBox Sample</h4><p>To use a databound combobox, you have to add overrides for SetColumnValueAtRow and GetColumnValueAtRow to switch the DisplayMember and ValueMember as you get and set the data from the underlying table. Also, you cannot have the ComboBox bound with the same BindingContext to the same datasource as the datagrid. You can download a working project (C#, VB) that implements a databound combobox in a datagrid.</p><p>Thanks to Gerald Walsh for his suggestion to use the ComboBox.SelectionChangeCommitted event to set the editing flag within our derived columnstyle class.</p><h3 id="_5-6-how-can-i-catch-a-double-click-into-a-column-header-cell" tabindex="-1"><a class="header-anchor" href="#_5-6-how-can-i-catch-a-double-click-into-a-column-header-cell" aria-hidden="true">#</a> 5.6 How can I catch a double-click into a column header cell?</h3><p>You can use the DataGrid&#39;s double-click event and its HitTest method to catch a double click on a header.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dataGrid1_DoubleClick</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Point</span> pt <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span><span class="token function">PointToClient</span><span class="token punctuation">(</span>Cursor<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DataGrid<span class="token punctuation">.</span>HitTestInfo</span> hti <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>ColumnHeader<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">&quot;double clicked clicked column header &quot;</span> <span class="token operator">+</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-7-how-can-i-select-the-entire-row-when-the-user-clicks-on-a-cell-in-the-row" tabindex="-1"><a class="header-anchor" href="#_5-7-how-can-i-select-the-entire-row-when-the-user-clicks-on-a-cell-in-the-row" aria-hidden="true">#</a> 5.7 How can I select the entire row when the user clicks on a cell in the row?</h3><p>Call the DataGrid.Select method from within its mouseup event.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dataGrid1_MouseUp</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Point</span> pt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DataGrid<span class="token punctuation">.</span>HitTestInfo</span> hti <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>Cell<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        dataGrid1<span class="token punctuation">.</span>CurrentCell <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridCell</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataGrid1<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB/NET]</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> dataGrid1_MouseUp<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs<span class="token punctuation">)</span> <span class="token keyword">Handles</span> dataGrid1<span class="token punctuation">.</span>MouseUp
     <span class="token keyword">Dim</span> pt <span class="token operator">=</span> <span class="token keyword">New</span> Point<span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>
     <span class="token keyword">Dim</span> hti <span class="token keyword">As</span> DataGrid<span class="token punctuation">.</span>HitTestInfo <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>HitTest<span class="token punctuation">(</span>pt<span class="token punctuation">)</span>

     <span class="token keyword">If</span> hti<span class="token punctuation">.</span><span class="token keyword">Type</span> <span class="token operator">=</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>Cell <span class="token keyword">Then</span>
          dataGrid1<span class="token punctuation">.</span>CurrentCell <span class="token operator">=</span> <span class="token keyword">New</span> DataGridCell<span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">)</span>
          dataGrid1<span class="token punctuation">.</span><span class="token keyword">Select</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">)</span>
     <span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre></div><h3 id="_5-8-how-can-i-get-text-from-a-column-header-in-a-mouseup-event" tabindex="-1"><a class="header-anchor" href="#_5-8-how-can-i-get-text-from-a-column-header-in-a-mouseup-event" aria-hidden="true">#</a> 5.8 How can I get text from a column header in a MouseUp event?</h3><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dataGrid1_MouseUp</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs</span> e<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Point</span> pt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DataGrid<span class="token punctuation">.</span>HitTestInfo</span> hti <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>Cell<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">[</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>ColumnHeader<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DataView<span class="token punctuation">)</span> DataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">)</span><span class="token punctuation">.</span>Table<span class="token punctuation">.</span>Columns<span class="token punctuation">[</span>hti<span class="token punctuation">.</span>Column<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-9-how-do-i-hide-a-column" tabindex="-1"><a class="header-anchor" href="#_5-9-how-do-i-hide-a-column" aria-hidden="true">#</a> 5.9 How do I hide a column?</h3><p>There are several ways to hide a column:</p><ol><li><p>You can use your DataSet&#39;s ColumnMapping property to hide a column.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// Creating connection and command sting</span>
<span class="token class-name"><span class="token keyword">string</span></span> conStr <span class="token operator">=</span> <span class="token string">@&quot;Provider=Microsoft.JET.OLEDB.4.0;data source=C:\\northwind.mdb&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> sqlStr <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM Employees&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Create connection object</span>
<span class="token class-name">OleDbConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>conStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create data adapter object</span>
<span class="token class-name">OleDbDataAdapter</span> da <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbDataAdapter</span><span class="token punctuation">(</span>sqlStr<span class="token punctuation">,</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a dataset object and fill with data using data adapter&#39;s Fill method</span>

<span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
da<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">,</span> <span class="token string">&quot;Employees&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Hide the column and attach dataset&#39;s DefaultView to the datagrid control</span>
ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;Employees&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Columns<span class="token punctuation">[</span><span class="token string">&quot;LastName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ColumnMapping <span class="token operator">=</span> MappingType<span class="token punctuation">.</span>Hidden<span class="token punctuation">;</span>
dataGrid1<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;Employees&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>Another way to hide a column is to set its width to zero. Check out the FAQ How do I set the width of a column in my DataGrid?.</p></li><li><p>Another way to hide a column is to create a custom table style, and as you add columnstyles to your tablestyle, omit the column you want hidden. Check out the FAQ How do I add an unbound column in my bound DataGrid? to see how to create a custom table style.</p></li></ol><h3 id="_5-10-how-do-i-color-a-individual-cell-depending-upon-its-value-or-some-external-method" tabindex="-1"><a class="header-anchor" href="#_5-10-how-do-i-color-a-individual-cell-depending-upon-its-value-or-some-external-method" aria-hidden="true">#</a> 5.10 How do I color a individual cell depending upon its value or some external method?</h3><p>We give three different methods for doing this.</p><ul><li>The first one overrides Paint in a derived columnstyle and sets the backcolor there.</li><li>The second uses a delegate to set the color in the Paint override.</li><li>The third method adds an event to the derived column style to allow you to set the color in an event handler.</li></ul><h4 id="method-1" tabindex="-1"><a class="header-anchor" href="#method-1" aria-hidden="true">#</a> Method 1</h4><p>You can do this by deriving from DataGridTextBoxColumn and overriding the Paint method to conditionally set the backColor and foreColor. The sample code below colors any cell that starts with a letter higher than &#39;F&#39;. You can download a project (C#, VB) using this class.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataGridColoredTextBoxColumn</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGridTextBoxColumn</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Paint</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Graphics</span> g<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Rectangle</span> bounds<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>CurrencyManager</span>
        source<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> rowNum<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Brush</span> backBrush<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Brush</span> foreBrush<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> alignToRight<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// the idea is to conditionally set the foreBrush and/or backbrush</span>
        <span class="token comment">// depending upon some crireria on the cell value</span>
        <span class="token comment">// Here, we color anything that begins with a letter higher than &#39;F&#39;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">object</span></span> o <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetColumnValueAtRow</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> rowNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> o<span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">char</span></span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>o<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span> c <span class="token operator">&gt;</span> <span class="token char">&#39;F&#39;</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                <span class="token comment">// could be as simple as</span>
                <span class="token comment">// backBrush = new SolidBrush(Color.Pink);</span>
                <span class="token comment">// or something fancier...</span>
                    backBrush <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LinearGradientBrush</span><span class="token punctuation">(</span>bounds<span class="token punctuation">,</span> Color<span class="token punctuation">.</span><span class="token function">FromArgb</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        Color<span class="token punctuation">.</span><span class="token function">FromArgb</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> LinearGradientMode<span class="token punctuation">.</span>BackwardDiagonal<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    foreBrush <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SolidBrush</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/* empty catch */</span> <span class="token punctuation">}</span>
        <span class="token keyword">finally</span><span class="token punctuation">{</span>
            <span class="token comment">// make sure the base class gets called to do the drawing with</span>
            <span class="token comment">// the possibly changed brushes</span>
            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Paint</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> bounds<span class="token punctuation">,</span> source<span class="token punctuation">,</span> rowNum<span class="token punctuation">,</span> backBrush<span class="token punctuation">,</span> foreBrush<span class="token punctuation">,</span> alignToRight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET}</span>
<span class="token keyword">Public</span> <span class="token keyword">Class</span> DataGridColoredTextBoxColumn
    <span class="token keyword">Inherits</span> DataGridTextBoxColumn
    <span class="token keyword">Public</span> <span class="token keyword">Sub</span> <span class="token keyword">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span>

    <span class="token keyword">Protected</span> <span class="token keyword">Overloads</span> <span class="token keyword">Overrides</span> <span class="token keyword">Sub</span> Paint<span class="token punctuation">(</span><span class="token keyword">ByVal</span> g <span class="token keyword">As</span> Graphics<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> bounds <span class="token keyword">As</span> Rectangle<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> source <span class="token keyword">As</span> CurrencyManager<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> rowNum <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> backBrush <span class="token keyword">As</span> Brush<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> foreBrush <span class="token keyword">As</span> Brush<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> alignToRight <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">)</span>

    <span class="token comment">&#39; the idea is to conditionally set the foreBrush and/or backbrush</span>
    <span class="token comment">&#39; depending upon some crireria on the cell value</span>
    <span class="token comment">&#39; Here, we color anything that begins with a letter higher than &#39;F&#39;</span>

    <span class="token keyword">Try</span>
        <span class="token keyword">Dim</span> o <span class="token keyword">As</span> <span class="token keyword">Object</span>
        o <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>GetColumnValueAtRow<span class="token punctuation">(</span>source<span class="token punctuation">,</span> rowNum<span class="token punctuation">)</span>

        <span class="token keyword">If</span> <span class="token punctuation">(</span><span class="token keyword">Not</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token keyword">Is</span> <span class="token boolean">Nothing</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
            <span class="token keyword">Dim</span> c <span class="token keyword">As</span> <span class="token keyword">Char</span>
            c <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token keyword">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Substring<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

            <span class="token keyword">If</span> <span class="token punctuation">(</span>c <span class="token operator">&gt;</span> <span class="token string">&quot;F&quot;</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                <span class="token comment">&#39; could be as simple as</span>
                <span class="token comment">&#39; backBrush = new SolidBrush(Color.Pink);</span>
                <span class="token comment">&#39; or something fancier... </span>

                backBrush <span class="token operator">=</span> <span class="token keyword">New</span> LinearGradientBrush<span class="token punctuation">(</span>bounds<span class="token punctuation">,</span> Color<span class="token punctuation">.</span>FromArgb<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Color<span class="token punctuation">.</span>FromArgb<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> LinearGradientMode<span class="token punctuation">.</span>BackwardDiagonal<span class="token punctuation">)</span>
                foreBrush <span class="token operator">=</span> <span class="token keyword">New</span> SolidBrush<span class="token punctuation">(</span>Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Catch</span> ex <span class="token keyword">As</span> Exception
        <span class="token comment">&#39; empty catch</span>
        <span class="token keyword">Finally</span>
        <span class="token comment">&#39; make sure the base class gets called to do the drawing with</span>
        <span class="token comment">&#39; the possibly changed brushes</span>
        <span class="token keyword">MyBase</span><span class="token punctuation">.</span>Paint<span class="token punctuation">(</span>g<span class="token punctuation">,</span> bounds<span class="token punctuation">,</span> source<span class="token punctuation">,</span> rowNum<span class="token punctuation">,</span> backBrush<span class="token punctuation">,</span> foreBrush<span class="token punctuation">,</span> alignToRight<span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">Try</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">End</span> <span class="token keyword">Class</span> 
</code></pre></div><h4 id="method-2" tabindex="-1"><a class="header-anchor" href="#method-2" aria-hidden="true">#</a> Method 2</h4><p>To use some method to provide the cell color, you can use a similar technique as discussed above. But instead of setting the color based on cell value, call a delegate method instead. This delegate can be passed in using the constructor for the custom column style. You can download a sample that shows how this can be done.</p><h4 id="method-3" tabindex="-1"><a class="header-anchor" href="#method-3" aria-hidden="true">#</a> Method 3</h4><p>If you want a more flexible solution, you could expose an event as part of your derived columnstyle that fires in the Paint override. This would allow the handler of the event to set the color value depending upon the row and column parameters that are passed as part of the event args. You can download a sample (C#, VB) that implements this technique. The sample actually handles allowing a cell to be editable on a cell by cell basis through an event. This sample colors the back ground of the disabled cell gray. You could modify the eventargs to include a backcolor, and use this event to color cells based on row and column values removing the event call in the Edit override.</p><h3 id="_5-11-how-can-i-put-a-checkbox-in-a-column-of-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-11-how-can-i-put-a-checkbox-in-a-column-of-my-datagrid" aria-hidden="true">#</a> 5.11 How can I put a checkbox in a column of my DataGrid?</h3><p>You create a custom DataTableStyle that contains column styles for each column you want to display. You add the column styles in the order you want them to appear. Here are the steps to add an string column, an int column and a bool check column to a DataGrid. You can also download a working project.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// code assumes you have a DataSet named myDataSet, a table named &quot;EastCoastSales&quot; and a DataGrid myDataGrid</span>
<span class="token comment">//STEP 1: Create a DataTable style object and set properties if required.</span>
    <span class="token class-name">DataGridTableStyle</span> ts1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTableStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//specify the table from dataset (required step)</span>
    ts1<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token string">&quot;EastCoastSales&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// Set other properties (optional step)</span>
    ts1<span class="token punctuation">.</span>AlternatingBackColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>LightBlue<span class="token punctuation">;</span>

<span class="token comment">//STEP 2: Create a string column and add it to the tablestyle</span>
    <span class="token class-name">DataGridColumnStyle</span> TextCol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTextBoxColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    TextCol<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token string">&quot;custName&quot;</span><span class="token punctuation">;</span> <span class="token comment">//from dataset table</span>
    TextCol<span class="token punctuation">.</span>HeaderText <span class="token operator">=</span> <span class="token string">&quot;Customer Name&quot;</span><span class="token punctuation">;</span>
    TextCol<span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token number">250</span><span class="token punctuation">;</span>
    ts1<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>TextCol<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//STEP 3: Create an int column style and add it to the tablestyle</span>
    <span class="token comment">//this requires setting the format for the column through its property descriptor</span>
    <span class="token class-name">PropertyDescriptorCollection</span> pdc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>BindingContext<span class="token punctuation">[</span>myDataSet<span class="token punctuation">,</span> <span class="token string">&quot;EastCoastSales&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GetItemProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//now created a formated column using the pdc</span>

    <span class="token class-name">DataGridDigitsTextBoxColumn</span> csIDInt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridDigitsTextBoxColumn</span><span class="token punctuation">(</span>pdc<span class="token punctuation">[</span><span class="token string">&quot;CustID&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    csIDInt<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token string">&quot;CustID&quot;</span><span class="token punctuation">;</span>
    csIDInt<span class="token punctuation">.</span>HeaderText <span class="token operator">=</span> <span class="token string">&quot;CustID&quot;</span><span class="token punctuation">;</span>
    csIDInt<span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    ts1<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>csIDInt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//STEP 4: Add the checkbox</span>
    <span class="token class-name">DataGridColumnStyle</span> boolCol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridBoolColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    boolCol<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token string">&quot;Current&quot;</span><span class="token punctuation">;</span>
    boolCol<span class="token punctuation">.</span>HeaderText <span class="token operator">=</span> <span class="token string">&quot;Info Current&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//uncomment this line to get a two-state checkbox</span>
    <span class="token comment">//((DataGridBoolColumn)boolCol).AllowNull = false;</span>
    boolCol<span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>
    ts1<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>boolCol<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//STEP 5: Add the tablestyle to your datagrid&#39;s tablestlye collection</span>
    myDataGrid<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ts1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-12-how-can-i-restrict-the-keystrokes-that-will-be-accepted-in-a-column-of-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-12-how-can-i-restrict-the-keystrokes-that-will-be-accepted-in-a-column-of-my-datagrid" aria-hidden="true">#</a> 5.12 How can I restrict the keystrokes that will be accepted in a column of my datagrid?</h3><p>You can create a custom column style and handle the KeyPress event of its TextBox member. Below is the code showing how this might be done. You can also download a sample project (C#, VB) that shows an implementation of this idea.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataGridDigitsTextBoxColumn</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGridTextBoxColumn</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">DataGridDigitsTextBoxColumn</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>PropertyDescriptor</span> pd<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> format<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> b<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>pd<span class="token punctuation">,</span> format<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>KeyPress <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>KeyPressEventHandler</span><span class="token punctuation">(</span>HandleKeyPress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">HandleKeyPress</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>KeyPressEventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> 
        <span class="token comment">//ignore if not digit or control key</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">char</span><span class="token punctuation">.</span><span class="token function">IsDigit</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>KeyChar<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">char</span><span class="token punctuation">.</span><span class="token function">IsControl</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>KeyChar<span class="token punctuation">)</span><span class="token punctuation">)</span>
            e<span class="token punctuation">.</span>Handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token comment">//ignore if more than 3 digits</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Length <span class="token operator">&gt;=</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">char</span><span class="token punctuation">.</span><span class="token function">IsControl</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>KeyChar<span class="token punctuation">)</span><span class="token punctuation">)</span>
            e<span class="token punctuation">.</span>Handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> disposing<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>disposing<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>KeyPress <span class="token operator">-=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>KeyPressEventHandler</span><span class="token punctuation">(</span>HandleKeyPress<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span>disposing<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-13-how-do-i-make-a-field-auto-increment-as-new-rows-are-added-to-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-13-how-do-i-make-a-field-auto-increment-as-new-rows-are-added-to-my-datagrid" aria-hidden="true">#</a> 5.13 How do I make a field auto increment as new rows are added to my datagrid?</h3><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">DataTable</span> myTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataTable</span><span class="token punctuation">(</span><span class="token string">&quot;Customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token range operator">..</span><span class="token punctuation">.</span>

<span class="token class-name">DataColumn</span> cCustID <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataColumn</span><span class="token punctuation">(</span><span class="token string">&quot;CustID&quot;</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cCustID<span class="token punctuation">.</span>AutoIncrement <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
cCustID<span class="token punctuation">.</span>AutoIncrementSeed <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
cCustID<span class="token punctuation">.</span>AutoIncrementStep <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
myTable<span class="token punctuation">.</span>Columns<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>cCustID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-14-how-can-i-prevent-a-particular-cell-from-being-editable" tabindex="-1"><a class="header-anchor" href="#_5-14-how-can-i-prevent-a-particular-cell-from-being-editable" aria-hidden="true">#</a> 5.14 How can I prevent a particular cell from being editable?</h3><p>You can do this by deriving a custom column style and overriding its virtual Edit member. Below is an override that will prevent the cell in row 1 of the column from getting the edit focus. You can paste this code in the DataGridDigitsTextBoxColumn sample to see it work.</p><p>If you want a more flexible solution, you could expose an event as part of your derived columnstyle that fires right before the call to the baseclass in the Edit override. This would allow the handler of the event to set the enable value depending upon the row and column parameters that are passed as part of the event args. You can download a sample (C#, VB) that implements this technique. The sample also fires the event right before painting the cell to decide whether to paint a gray background for the disabled cell. You could modify the eventargs to include a backcolor, and use this event to color cells based on row and column values.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">//this override will prevent the cell in row 1 from getting the edit focus</span>
<span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Edit</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>CurrencyManager</span> source<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> rowNum<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Rectangle</span> bounds<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> readOnly<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> instantText<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> cellIsVisible<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>rowNum <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Edit</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> rowNum<span class="token punctuation">,</span> bounds<span class="token punctuation">,</span> readOnly<span class="token punctuation">,</span> instantText<span class="token punctuation">,</span> cellIsVisible<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-15-how-do-i-move-columns-in-a-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-15-how-do-i-move-columns-in-a-datagrid" aria-hidden="true">#</a> 5.15 How do I move columns in a datagrid?</h3><p>The columns appear in the order that their column styles were added to the tablestyle being used by the grid. If you want to change this order, you would need to create a new table style, and add the columnstyles in the order you want thiings to appear. Here is some code snippets that suggest how to do this.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MoveColumn</span><span class="token punctuation">(</span><span class="token class-name">DataGrid</span> _dataGrid<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> _mappingName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> fromCol<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> toCol<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fromCol <span class="token operator">==</span> toCol<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token class-name">DataGridTableStyle</span> oldTS <span class="token operator">=</span> _dataGrid<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span>_mappingName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">DataGridTableStyle</span> newTS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTableStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newTS<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> _mappingName<span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> oldTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">!=</span> fromCol <span class="token operator">&amp;&amp;</span> fromCol <span class="token operator">&lt;</span> toCol<span class="token punctuation">)</span>
            newTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>oldTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> toCol<span class="token punctuation">)</span>
            newTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>oldTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span>fromCol<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">!=</span> fromCol <span class="token operator">&amp;&amp;</span> fromCol <span class="token operator">&gt;</span> toCol<span class="token punctuation">)</span>
            newTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>oldTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    _dataGrid<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>oldTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _dataGrid<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>newTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//sample usage</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">MoveColumn</span><span class="token punctuation">(</span>myDataGrid<span class="token punctuation">,</span> <span class="token string">&quot;Customers&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code>[VB<span class="token punctuation">.</span>NET]
<span class="token keyword">Public</span> <span class="token keyword">Sub</span> MoveColumn<span class="token punctuation">(</span>_dataGrid <span class="token keyword">As</span> DataGrid<span class="token punctuation">,</span> _mappingName <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">,</span> fromCol <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">,</span> toCol <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">)</span>
    <span class="token keyword">If</span> fromCol <span class="token operator">=</span> toCol <span class="token keyword">Then</span>
        <span class="token keyword">Return</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>

    <span class="token keyword">Dim</span> oldTS <span class="token keyword">As</span> DataGridTableStyle <span class="token operator">=</span> _dataGrid<span class="token punctuation">.</span>TableStyles<span class="token punctuation">(</span>_mappingName<span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> newTS <span class="token keyword">As</span> <span class="token keyword">New</span> DataGridTableStyle<span class="token punctuation">(</span><span class="token punctuation">)</span>
    newTS<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> _mappingName

    <span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
    i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">While</span> i <span class="token operator">&lt;</span> oldTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span>Count
        <span class="token keyword">If</span> i <span class="token operator">&lt;</span><span class="token operator">&gt;</span> fromCol <span class="token keyword">And</span> fromCol <span class="token operator">&lt;</span> toCol <span class="token keyword">Then</span>
            newTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>oldTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">If</span> i <span class="token operator">=</span> toCol <span class="token keyword">Then</span>
            newTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>oldTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">(</span>fromCol<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>

        <span class="token keyword">If</span> i <span class="token operator">&lt;</span><span class="token operator">&gt;</span> fromCol <span class="token keyword">And</span> fromCol <span class="token operator">&gt;</span> toCol <span class="token keyword">Then</span>
            newTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>oldTS<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>

        i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">End</span> <span class="token keyword">While</span>

    _dataGrid<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span>Remove<span class="token punctuation">(</span>oldTS<span class="token punctuation">)</span>
    _dataGrid<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>newTS<span class="token punctuation">)</span>

<span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;MoveColumn</span>

<span class="token comment">&#39;sample usage</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> button1_Click<span class="token punctuation">(</span>sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>EventArgs<span class="token punctuation">)</span>
     MoveColumn<span class="token punctuation">(</span>myDataGrid<span class="token punctuation">,</span> <span class="token string">&quot;Customers&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;button1_Click</span>
</code></pre></div><h3 id="_5-16-how-can-i-do-cell-by-cell-validation-in-a-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-16-how-can-i-do-cell-by-cell-validation-in-a-datagrid" aria-hidden="true">#</a> 5.16 How can I do cell by cell validation in a datagrid?</h3><p>There are problems trying to implement cell by cell validation using the grid&#39;s Validating event architecture. The problem is that the grid is not the object handling the data. Instead, a TextBox or some other control is the control managing the changing of the cell contents. One way to implement the validation at the grid level is to handle the CurrentCellChanged event, and if the previous cell&#39;s value is not proper, then return to that cell. You can download a sample that implements this process. The sample only handles the validation from cell to cell movement. If you want to handle the validation when the user clicks on the forms Close button, then you would have to add a special event handler for this and do one last validation at this point.</p><h3 id="_5-17-how-do-i-programmatically-determine-the-selected-rows-in-a-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-17-how-do-i-programmatically-determine-the-selected-rows-in-a-datagrid" aria-hidden="true">#</a> 5.17 How do I programmatically determine the selected rows in a datagrid?</h3><p>The method DataGrid.IsSelected can tell you if a particular row is selected. So, you could use IsSelected in a loop through all your rows to finds if multiple rows have been selected. Depending upon the size of your datagrid, this may be a viable solution. If not, you could track the selections yourself by monitoring the key actions and the mouse actions. This would be more work. Thanks to John Hughes to the suggestion to use the dataview.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">ArrayList</span> <span class="token function">GetSelectedRows</span><span class="token punctuation">(</span><span class="token class-name">DataGrid</span> dg<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">ArrayList</span> al <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CurrencyManager</span> cm <span class="token operator">=</span> <span class="token punctuation">(</span>CurrencyManager<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>BindingContext<span class="token punctuation">[</span>dg<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> dg<span class="token punctuation">.</span>DataMember<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token class-name">DataView</span> dv <span class="token operator">=</span> <span class="token punctuation">(</span>DataView<span class="token punctuation">)</span>cm<span class="token punctuation">.</span>List<span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dv<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dg<span class="token punctuation">.</span><span class="token function">IsSelected</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            al<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> al<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token string">&quot;Selected rows:&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> o <span class="token keyword">in</span> <span class="token function">GetSelectedRows</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        s<span class="token operator">+=</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>o<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Public</span> <span class="token keyword">Function</span> GetSelectedRows<span class="token punctuation">(</span><span class="token keyword">ByVal</span> dg <span class="token keyword">As</span> DataGrid<span class="token punctuation">)</span> <span class="token keyword">As</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>ArrayList
    <span class="token keyword">Dim</span> al <span class="token keyword">As</span> <span class="token keyword">New</span> ArrayList<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> cm <span class="token keyword">As</span> CurrencyManager <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>BindingContext<span class="token punctuation">(</span>dg<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> dg<span class="token punctuation">.</span>DataMember<span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> dv <span class="token keyword">As</span> DataView <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>cm<span class="token punctuation">.</span>List<span class="token punctuation">,</span> DataView<span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>

    <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">to</span> dv<span class="token punctuation">.</span>Count <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token keyword">If</span> dg<span class="token punctuation">.</span>IsSelected<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">Then</span>
            al<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">End</span> <span class="token keyword">Next</span>
    <span class="token keyword">Return</span> al
<span class="token keyword">End</span> <span class="token keyword">Function</span> <span class="token comment">&#39;GetSelectedRows</span>

<span class="token keyword">Private</span> <span class="token keyword">Sub</span> button1_Click<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>EventArgs<span class="token punctuation">)</span> <span class="token keyword">Handles</span> Button1<span class="token punctuation">.</span>Click
    <span class="token keyword">Dim</span> s <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> <span class="token string">&quot;Selected rows:&quot;</span>
    <span class="token keyword">Dim</span> o <span class="token keyword">As</span> <span class="token keyword">Object</span>
    <span class="token keyword">For</span> <span class="token keyword">Each</span> o <span class="token keyword">In</span> GetSelectedRows<span class="token punctuation">(</span>dataGrid1<span class="token punctuation">)</span>
        s <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> o<span class="token punctuation">.</span>ToString<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Next</span> o
    MessageBox<span class="token punctuation">.</span>Show<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;button1_Click</span>
</code></pre></div><h3 id="_5-18-how-can-i-move-rows-by-dragging-the-row-header-cell" tabindex="-1"><a class="header-anchor" href="#_5-18-how-can-i-move-rows-by-dragging-the-row-header-cell" aria-hidden="true">#</a> 5.18 How can I move rows by dragging the row header cell?</h3><p>One way to implement this is to derive a DataGrid and override the virtual OnMouseDown, OnMouseMove and OnMouseUp methods. In your overrides, if the mousedown is on a row header, track the initial mousedown row, and as it moves, draw a line to indicate a target position. Then on the mouseup, handle moving the row.</p><p>You can download a sample (C#, VB) that illustrates how this might be done.</p><h3 id="_5-19-i-want-to-do-custom-handling-of-special-keys-such-as-the-tab-key-or-f2-in-the-textbox-of-a-column-in-the-datagrid-how-do-i-subclass-this-textbox-to-get-at-it-virtual-members" tabindex="-1"><a class="header-anchor" href="#_5-19-i-want-to-do-custom-handling-of-special-keys-such-as-the-tab-key-or-f2-in-the-textbox-of-a-column-in-the-datagrid-how-do-i-subclass-this-textbox-to-get-at-it-virtual-members" aria-hidden="true">#</a> 5.19 I want to do custom handling of special keys such as the Tab key or F2 in the TextBox of a column in the DataGrid. How do I subclass this TextBox to get at it virtual members?</h3><p>The TextBox property of the DataGridTextBoxColumn is ReadOnly, so you just cannot set a new derived TextBox into it. One solution is to derive a TextBox, and then have it use the derived TextBox in the DataGridTextBoxColumn instead of the &#39;generic&#39; TextBox that is there. This is the same technique used in our combobox in a column sample. In that sample, the generic textbox was &#39;replaced&#39; with a combobox. Here, we replace it with a derived TextBox where we can easily override virtual members.</p><p>A reasonable question is why not just use the event mechanism of the existing TextBox to modify behavior. Events like KeyPress would allow us to do some things PROVIDED they get hit. Due to the key processing architecture of the FrameWork, for some special keys, these key events are not always fired. And if they are fired, sometimes it is impossible to avoid the default processing if this is the intent you have. Overriding a virtual function, doing something special, and then NOT calling the baseclass is a standard way of avoiding default processing.</p><p>In this sample (both VB and CS), we override PreProcessMessage and avoid processing the Keys.Tab key. You can modify the code to not process Keys.F2 as well. DataGridTextBoxColumn is subclassed so it can use our derived TextBox.</p><h3 id="_5-20-how-can-i-have-a-column-of-icons-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-20-how-can-i-have-a-column-of-icons-in-my-datagrid" aria-hidden="true">#</a> 5.20 How can I have a column of icons in my datagrid?</h3><p>You need to derive a custom column style, override its Paint method and draw the image. In the attached samples, (VB and C#), there are two custom column styles. One style is a stand-alone unbound column that just displays an image. The second custom column style adds the image to the left side of a bound column. In both cases, the actual image that is displayed is from an imagelist passed into the column in its constructor. The index of the image to be drawn on a particular row is determined by a delegate passed into the column style through its constructor.</p><h3 id="_5-21-how-can-i-tell-if-the-current-row-has-changed-and-whether-i-am-on-the-addnew-row-or-not" tabindex="-1"><a class="header-anchor" href="#_5-21-how-can-i-tell-if-the-current-row-has-changed-and-whether-i-am-on-the-addnew-row-or-not" aria-hidden="true">#</a> 5.21 How can I tell if the current row has changed and whether I am on the AddNew row or not?</h3><p>The DataGrid&#39;s CurrentCellChanged event is hit even if you just change cells in the current row. If you want an event that is only hit when you change rows, then you have to look at the binding manager. This object has both a CurrentChanged event and a PositionChanged event which are hit when you change rows.</p><p>To decide whether you are on the AddNew row or not, you can again use the binding manager and compare the number of rows it returns with the number of rows in your data table. Below is some code snippets showing how you might get at this information.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>DataGrid</span> dataGrid1<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">BindingManagerBase</span> bindingManager<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Form1_Load</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Creating connection and command sting</span>
    <span class="token class-name"><span class="token keyword">string</span></span> conStr <span class="token operator">=</span> <span class="token string">@&quot;Provider=Microsoft.JET.OLEDB.4.0;data source=C:\\northwind.mdb&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> sqlStr <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM Employees&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// Create connection object</span>
    <span class="token class-name">OleDbConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>conStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create data adapter object</span>
    <span class="token class-name">OleDbDataAdapter</span> da <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbDataAdapter</span><span class="token punctuation">(</span>sqlStr<span class="token punctuation">,</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create a dataset object and fill with data using data adapter&#39;s Fill method</span>
    <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    da<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">,</span> <span class="token string">&quot;Employees&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataGrid1<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;Employees&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    bindingManager <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>BindingContext<span class="token punctuation">[</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">]</span><span class="token punctuation">;</span>
    bindingManager<span class="token punctuation">.</span>PositionChanged <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>EventHandler</span><span class="token punctuation">(</span>RowChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RowChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;RowChanged &quot;</span> <span class="token operator">+</span> bindingManager<span class="token punctuation">.</span>Position<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> lastRow <span class="token operator">=</span> bindingManager<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DataTable<span class="token punctuation">)</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">)</span><span class="token punctuation">.</span>Rows<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>lastRow<span class="token punctuation">)</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;lastRow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-22-how-do-i-hide-the-gridlines-or-set-them-to-a-particular-color" tabindex="-1"><a class="header-anchor" href="#_5-22-how-do-i-hide-the-gridlines-or-set-them-to-a-particular-color" aria-hidden="true">#</a> 5.22 How do I hide the gridlines or set them to a particular color?</h3><p>If your datagrid does not have a custom TableStyle associated with it, then there are two DataGrid properties that control the color and visibility of the gridlines.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code>DataGrid<span class="token range operator">..</span>GridLineColor
DataGrid<span class="token punctuation">.</span>GridLineStyle
</code></pre></div><p>If you have a custom TableStyle. you need to set the color within the TableStyle. Here is code that makes the line color the same as the background color, and hence hides the gridlines. You can download a sample.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Form1_Load</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Set the connection and sql strings</span>
    <span class="token comment">// assumes your mdb file is in your root</span>
    <span class="token class-name"><span class="token keyword">string</span></span> connString <span class="token operator">=</span> <span class="token string">@&quot;Provider=Microsoft.JET.OLEDB.4.0;data source=C:\\northwind.mdb&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> sqlString <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM customers&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">OleDbDataAdapter</span> dataAdapter <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">DataSet</span> _dataSet <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Connection object</span>
        <span class="token class-name">OleDbConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>connString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create data adapter object</span>
        dataAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbDataAdapter</span><span class="token punctuation">(</span>sqlString<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create a dataset object and fill with data using data adapter&#39;s Fill method</span>
        _dataSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        dataAdapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>_dataSet<span class="token punctuation">,</span> <span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">&quot;Problem with DB access-\\n\\n connection: &quot;</span>
            <span class="token operator">+</span> connString <span class="token operator">+</span> <span class="token string">&quot;\\r\\n\\r\\n query: &quot;</span> <span class="token operator">+</span> sqlString
            <span class="token operator">+</span> <span class="token string">&quot;\\r\\n\\r\\n\\r\\n&quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Create a table style that will hold the new column style</span>
    <span class="token comment">// that we set and also tie it to our customer&#39;s table from our DB</span>
    <span class="token class-name">DataGridTableStyle</span> tableStyle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTableStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    tableStyle<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token string">&quot;customers&quot;</span><span class="token punctuation">;</span>
    tableStyle<span class="token punctuation">.</span>GridLineColor <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>BackColor<span class="token punctuation">;</span>
    dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>tableStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataGrid1<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> _dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-23-how-can-i-get-the-selected-text-in-an-active-gridcell" tabindex="-1"><a class="header-anchor" href="#_5-23-how-can-i-get-the-selected-text-in-an-active-gridcell" aria-hidden="true">#</a> 5.23 How can I get the selected text in an active gridcell?</h3><p>You need to get the DataGridTextBoxColumn.TextBox member, and retrieve the SelectedText from it for the active cell. The sample shows how you can do this as part of handling this TextBox&#39;s rightClick. This code assumes you have specifically added DataGridTextBoxColumn for each column style. You can also download a VB sample.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">HandleMouseDown</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Button <span class="token operator">==</span> MouseButtons<span class="token punctuation">.</span>Right<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">DataGridTableStyle</span> ts <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">DataGridTextBoxColumn</span> cs <span class="token operator">=</span> <span class="token punctuation">(</span>DataGridTextBoxColumn<span class="token punctuation">)</span>ts<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span>dataGrid1<span class="token punctuation">.</span>CurrentCell<span class="token punctuation">.</span>ColumnNumber<span class="token punctuation">]</span><span class="token punctuation">;</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">&quot;Selected: &quot;</span> <span class="token operator">+</span> cs<span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>SelectedText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-24-how-do-i-determine-whether-a-checkbox-in-my-datagrid-is-checked-or-not" tabindex="-1"><a class="header-anchor" href="#_5-24-how-do-i-determine-whether-a-checkbox-in-my-datagrid-is-checked-or-not" aria-hidden="true">#</a> 5.24 How do I determine whether a checkbox in my datagrid is checked or not?</h3><p>If the column is a boolean column, you can just cast the object returned by the indexer to a bool and use it.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span>dataGridTopics<span class="token punctuation">[</span>row<span class="token punctuation">,</span> column<span class="token punctuation">]</span><span class="token punctuation">)</span>
    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">&quot;I am true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">&quot;I am false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-25-how-can-i-bind-the-datagrid-to-a-datasource-without-using-any-wizards" tabindex="-1"><a class="header-anchor" href="#_5-25-how-can-i-bind-the-datagrid-to-a-datasource-without-using-any-wizards" aria-hidden="true">#</a> 5.25 How can I bind the datagrid to a datasource without using any wizards?</h3><p>Here is a really simple data binding sample. Just drag and drop a datagrid onto a default Windows Forms application. Follow the steps below to bind this grid to the NorthWind db in SQL server.</p>`,181),d={href:"http://www.syncfusion.com/faq/winforms/Files/simpledata.zip",target:"_blank",rel:"noopener noreferrer"},h=o(`<div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// Create a connection</span>
<span class="token class-name">SqlConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a data adapter. Think of the data adapter as an object that knows how to get the data from the</span>
<span class="token comment">// data source into a dataset</span>
<span class="token class-name">SqlDataAdapter</span> dataAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetCommandText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fill the dataset using the data adapter</span>
<span class="token class-name">DataSet</span> dataSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token string">&quot;Customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataAdapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataSet<span class="token punctuation">,</span> <span class="token string">&quot;Customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// bind to the grid</span>
grid<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSet<span class="token punctuation">;</span> <span class="token comment">// the big picture</span>
grid<span class="token punctuation">.</span>DataMember <span class="token operator">=</span> <span class="token string">&quot;Customers&quot;</span><span class="token punctuation">;</span> <span class="token comment">// the specific table that we want to bind to</span>

<span class="token comment">// The connection text looks like this</span>
<span class="token comment">// If your SQL server is running on the default port, you can remove the port attribute.</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> server <span class="token operator">=</span> <span class="token string">&quot;your_server_name&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> serverPort <span class="token operator">=</span> <span class="token string">&quot;port_address&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> catalog <span class="token operator">=</span> <span class="token string">&quot;NorthWind&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> password <span class="token operator">=</span> <span class="token string">&quot;user_pass&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> userId <span class="token operator">=</span> <span class="token string">&quot;user_name&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> <span class="token string">&quot;data source={0},{1};initial catalog={2};&quot;</span> <span class="token operator">+</span>
                                        <span class="token string">&quot;password={3}; user id={4}; packet size=4096&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">,</span> server<span class="token punctuation">,</span> serverPort<span class="token punctuation">,</span> catalog<span class="token punctuation">,</span> password<span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// The command text looks like this</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetCommandText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> commandText <span class="token operator">=</span> <span class="token string">&quot;Select * from customers&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> commandText<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-26-how-can-i-bind-two-datagrids-in-a-master-detail-relationship" tabindex="-1"><a class="header-anchor" href="#_5-26-how-can-i-bind-two-datagrids-in-a-master-detail-relationship" aria-hidden="true">#</a> 5.26 How can I bind two datagrids in a Master-Detail relationship?</h3><p>Please download this sample before reading the rest of this FAQ. Looking through the sample will help follow the description.</p>`,3),m={href:"http://www.syncfusion.com/faq/winforms/Files/simpledata2.zip",target:"_blank",rel:"noopener noreferrer"},y=o(`<p>What this boils down to is this:</p><ol><li><p>Load both Master and Details queries in a dataset.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// I am using the SQL server NorthWind database</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>dataAdapterMaster<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataSet<span class="token punctuation">,</span> <span class="token string">&quot;Customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>dataAdapterDetails<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataSet<span class="token punctuation">,</span> <span class="token string">&quot;Orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>Bind the master data grid to the Master dataset table.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// The master view</span>
grid<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSet<span class="token punctuation">;</span>
grid<span class="token punctuation">.</span>DataMember <span class="token operator">=</span> <span class="token string">&quot;Customers&quot;</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>Create a relationship that describes how the two tables relate to each other. A primary key foriegn key relationship is defined by two attributes.</p><p>The primary key column in the master table<br> The foreign key coumn in the details table<br> The created relationship is added to the dataset.</p><p><code>this.dataSet.Relations.Add(&quot;CustomersToOrders&quot;, dataSet.Tables[&quot;Customers&quot;].Columns[&quot;CustomerID&quot;], dataSet.Tables[&quot;Orders&quot;].Columns[&quot;CustomerID&quot;]);</code></p></li><li><p>Set the data member for the details table to be the name of relationship that was added to the dataset.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// The name of the relation is to be used as the DataMember for the</span>
<span class="token comment">// details view</span>
details<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSet<span class="token punctuation">;</span>

<span class="token comment">// use the relationship called &quot;CustomersToOrders in the Customers table.</span>
<span class="token comment">// Remember that we called the relationship &quot;CustomersToOrders&quot;.</span>
details<span class="token punctuation">.</span>DataMember <span class="token operator">=</span> <span class="token string">&quot;Customers.CustomersToOrders&quot;</span><span class="token punctuation">;</span>
</code></pre></div></li></ol><h3 id="_5-27-how-do-i-get-the-row-or-column-that-has-been-clicked-on" tabindex="-1"><a class="header-anchor" href="#_5-27-how-do-i-get-the-row-or-column-that-has-been-clicked-on" aria-hidden="true">#</a> 5.27 How do I get the row or column that has been clicked on?</h3><p>You can use the DataGrid&#39;s HitTest method, passing it a point in the grid&#39;s client coordinate system, and returning a HitTestInfo object that holds all the row and column information that you want.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token punctuation">[</span>C#<span class="token punctuation">]</span>
<span class="token comment">// X &amp; Y are in the grid&#39; coordinates. If they are in screen coordinates, call dataGrid1.PointToClient method</span>
<span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Point</span> pt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DataGrid<span class="token punctuation">.</span>HitTestInfo</span> hti <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>Cell<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">[</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>ColumnHeader<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DataView<span class="token punctuation">)</span> DataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">)</span><span class="token punctuation">.</span>Table<span class="token punctuation">.</span>Columns<span class="token punctuation">[</span>hti<span class="token punctuation">.</span>Column<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token comment">&#39; X &amp; Y are in the grid&#39; coordinates. If they are in screen coordinates, call dataGrid1.PointToClient method</span>
<span class="token keyword">Dim</span> pt <span class="token operator">=</span> <span class="token keyword">New</span> Point<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span>
<span class="token keyword">Dim</span> hti <span class="token keyword">As</span> DataGrid<span class="token punctuation">.</span>HitTestInfo <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>HitTest<span class="token punctuation">(</span>pt<span class="token punctuation">)</span>

<span class="token keyword">If</span> hti<span class="token punctuation">.</span><span class="token keyword">Type</span> <span class="token operator">=</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>Cell <span class="token keyword">Then</span>
     MessageBox<span class="token punctuation">.</span>Show<span class="token punctuation">(</span>dataGrid1<span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">)</span><span class="token punctuation">.</span>ToString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">Else</span>
     <span class="token keyword">If</span> hti<span class="token punctuation">.</span><span class="token keyword">Type</span> <span class="token operator">=</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>ColumnHeader <span class="token keyword">Then</span> <span class="token comment">&#39;assumes datasource is a dataview</span>
          MessageBox<span class="token punctuation">.</span>Show<span class="token punctuation">(</span><span class="token keyword">CType</span><span class="token punctuation">(</span>DataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> DataView<span class="token punctuation">)</span><span class="token punctuation">.</span>Table<span class="token punctuation">.</span>Columns<span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Column<span class="token punctuation">)</span><span class="token punctuation">.</span>ToString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">If</span>
</code></pre></div><h3 id="_5-28-how-do-i-add-an-unbound-column-to-my-bound-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-28-how-do-i-add-an-unbound-column-to-my-bound-datagrid" aria-hidden="true">#</a> 5.28 How do I add an unbound column to my bound datagrid?</h3><p>The idea is to create the &#39;bound&#39; table in your dataset, and then add an extra &#39;unbound&#39; column. The steps are to derive a custom columnstyle that overrides Paint where you calculate and draw the unbound value. You can also override Edit to prevent the user from selecting your unbound column. Then to get your datagrid to use this special column style, you create a tablestyle and add the column styles to it in the order you want the columns to appear in the datagrid. Here are code snippets that derive the column and use the derived column. You can download a working sample.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// custom column style that is an unbound column</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataGridUnboundColumn</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGridTextBoxColumn</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Edit</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>CurrencyManager</span> source<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> rowNum<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Rectangle</span> bounds<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> readOnly<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> instantText<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> cellIsVisible<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//do not allow the unbound cell to become active</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>MappingName <span class="token operator">==</span> <span class="token string">&quot;UnBound&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Edit</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> rowNum<span class="token punctuation">,</span> bounds<span class="token punctuation">,</span> readOnly<span class="token punctuation">,</span> instantText<span class="token punctuation">,</span> cellIsVisible<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Paint</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Graphics</span> g<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Rectangle</span> bounds<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>CurrencyManager</span> source<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> rowNum<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Brush</span> backBrush<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Brush</span> foreBrush<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> alignToRight<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//clear the cell</span>
        g<span class="token punctuation">.</span><span class="token function">FillRectangle</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SolidBrush</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span><span class="token punctuation">,</span> bounds<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//compute &amp; draw the value</span>
        <span class="token comment">//string s = string.Format(&quot;{0} row&quot;, rowNum);</span>
        <span class="token comment">// col 0 + 2 chars from col 1</span>
        <span class="token class-name">DataGrid</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DataGridTableStyle<span class="token punctuation">.</span>DataGrid<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> parent<span class="token punctuation">[</span>rowNum<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>parent<span class="token punctuation">[</span>rowNum<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Font</span> font <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Font</span><span class="token punctuation">(</span><span class="token string">&quot;Arial&quot;</span><span class="token punctuation">,</span> <span class="token number">8.25f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        g<span class="token punctuation">.</span><span class="token function">DrawString</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> font<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SolidBrush</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>Black<span class="token punctuation">)</span><span class="token punctuation">,</span> bounds<span class="token punctuation">.</span>X<span class="token punctuation">,</span> bounds<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        font<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 

<span class="token comment">//code that uses this unbound column</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Form1_Load</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Set the connection and sql strings</span>
    <span class="token comment">// assumes your mdb file is in your root</span>
    <span class="token class-name"><span class="token keyword">string</span></span> connString <span class="token operator">=</span> <span class="token string">@&quot;Provider=Microsoft.JET.OLEDB.4.0;data source=C:\\northwind.mdb&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> sqlString <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM customers&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">OleDbDataAdapter</span> dataAdapter <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">DataSet</span> _dataSet <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Connection object</span>
        <span class="token class-name">OleDbConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>connString<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Create data adapter object</span>
        dataAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbDataAdapter</span><span class="token punctuation">(</span>sqlString<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Create a dataset object and fill with data using data adapter&#39;s Fill method</span>
        _dataSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        dataAdapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>_dataSet<span class="token punctuation">,</span> <span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">&quot;Problem with DB access-\\n\\n connection: &quot;</span>
            <span class="token operator">+</span> connString <span class="token operator">+</span> <span class="token string">&quot;\\r\\n\\r\\n query: &quot;</span> <span class="token operator">+</span> sqlString
            <span class="token operator">+</span> <span class="token string">&quot;\\r\\n\\r\\n\\r\\n&quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Create a table style that will hold the new column style</span>
    <span class="token comment">// that we set and also tie it to our customer&#39;s table from our DB</span>
    <span class="token class-name">DataGridTableStyle</span> tableStyle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTableStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableStyle<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token string">&quot;customers&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// since the dataset has things like field name and number of columns,</span>
    <span class="token comment">// we will use those to create new columnstyles for the columns in our DB table</span>
    <span class="token class-name"><span class="token keyword">int</span></span> numCols <span class="token operator">=</span> _dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Columns<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>

    <span class="token comment">//add an extra column at the end of our customers table</span>
    _dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Columns<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Unbound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DataGridTextBoxColumn</span> aColumnTextColumn<span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numCols<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        aColumnTextColumn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTextBoxColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aColumnTextColumn<span class="token punctuation">.</span>HeaderText <span class="token operator">=</span> _dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Columns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>ColumnName<span class="token punctuation">;</span>
        aColumnTextColumn<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> _dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Columns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>ColumnName<span class="token punctuation">;</span>

        tableStyle<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>aColumnTextColumn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//display the extra column after column 1.</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">DataGridUnboundColumn</span> unboundColStyle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridUnboundColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            unboundColStyle<span class="token punctuation">.</span>HeaderText <span class="token operator">=</span> <span class="token string">&quot;UnBound&quot;</span><span class="token punctuation">;</span>
            unboundColStyle<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token string">&quot;UnBound&quot;</span><span class="token punctuation">;</span>
            tableStyle<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>unboundColStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// make the dataGrid use our new tablestyle and bind it to our table</span>
    dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>tableStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataGrid1<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> _dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-29-how-do-i-get-the-row-and-column-of-the-current-cell-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-29-how-do-i-get-the-row-and-column-of-the-current-cell-in-my-datagrid" aria-hidden="true">#</a> 5.29 How do I get the row and column of the current cell in my datagrid?</h3><p>You can use the CurrentCell property of the DataGrid.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    intcolNum <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>CurrentCell<span class="token punctuation">.</span>ColumnNumber<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> rowNum <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>CurrentCell<span class="token punctuation">.</span>RowNumber<span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">object</span></span> cellValue <span class="token operator">=</span> dataGrid1<span class="token punctuation">[</span>rowNum<span class="token punctuation">,</span> colNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">&quot;row={0} col={1} value={2}&quot;</span><span class="token punctuation">,</span> rowNum<span class="token punctuation">,</span> colNum<span class="token punctuation">,</span> cellValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-30-how-can-i-prevent-the-enter-key-from-moving-to-the-next-cell-when-the-user-is-actively-editing-the-cell-and-presses-enter" tabindex="-1"><a class="header-anchor" href="#_5-30-how-can-i-prevent-the-enter-key-from-moving-to-the-next-cell-when-the-user-is-actively-editing-the-cell-and-presses-enter" aria-hidden="true">#</a> 5.30 How can I prevent the Enter key from moving to the next cell when the user is actively editing the cell and presses Enter?</h3><p>Override the method ProcessKeyPreview in your DataGrid.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ProcessKeyPreview</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Message</span> m<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Keys</span> keyCode <span class="token operator">=</span> <span class="token punctuation">(</span>Keys<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>m<span class="token punctuation">.</span>WParam <span class="token operator">&amp;</span> Keys<span class="token punctuation">.</span>KeyCode<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>Msg <span class="token operator">==</span> WM_KEYDOWN <span class="token operator">||</span> m<span class="token punctuation">.</span>Msg <span class="token operator">==</span> WM_KEYUP<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> keyCode <span class="token operator">==</span> Keys<span class="token punctuation">.</span>Enter<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-31-how-do-i-set-the-width-of-a-column-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-31-how-do-i-set-the-width-of-a-column-in-my-datagrid" aria-hidden="true">#</a> 5.31 How do I set the width of a column in my DataGrid?</h3><p>To set a column width, your datagrid must be using a non-null DataGridTableStyle. Once this is in place, you can set the column width by first getting the tablestyle and then using that object to obtain a column style with which you can set the width. Here are some code snippets showing how you might do this.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">//.... make sure your DataGrid is using a tablestyle</span>
dataGrid1<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> _dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name">DataGridTableStyle</span> dgts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTableStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dgts<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token string">&quot;customers&quot;</span><span class="token punctuation">;</span>
dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dgts<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//......</span>
<span class="token comment">//method to set a column with by colnumber</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetColWidth</span><span class="token punctuation">(</span><span class="token class-name">DataGridTableStyle</span> tableStyle<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> colNum<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> width<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        tableStyle<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span>colNum<span class="token punctuation">]</span><span class="token punctuation">.</span>Width <span class="token operator">=</span> width<span class="token punctuation">;</span>
        tableStyle<span class="token punctuation">.</span>DataGrid<span class="token punctuation">.</span><span class="token function">Refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">//empty catch .. do nothing</span>
<span class="token punctuation">}</span>

<span class="token comment">//....</span>

<span class="token comment">// here is how you might call this method</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DataGridTableStyle</span> tableStyle <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">SetColWidth</span><span class="token punctuation">(</span>tableStyle<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-32-how-can-i-implement-ole-drag-drop-between-a-datagrid-and-another-ole-dnd-object-that-supports-the-text-format" tabindex="-1"><a class="header-anchor" href="#_5-32-how-can-i-implement-ole-drag-drop-between-a-datagrid-and-another-ole-dnd-object-that-supports-the-text-format" aria-hidden="true">#</a> 5.32 How can I implement OLE Drag &amp; Drop between a DataGrid and another OLE DnD object that supports the Text format?</h3><p>The attached samples (C#, VB) have a derived datagrid that supports OLE D&amp;D with any OLE D&amp;D provider that handles a Text formatted data object. The derived grid handles six events to allow it to be both a drop source and a drop target. The sample project has two datagrids where you can drag cell text back and forth. You can also open Excel, and drag text between Excel and either datagrid.</p><p>Here are the events that are handled in this sample.</p><ul><li>MouseDown - Used to save the row and column of a mousedown, &#39;mousedowncell&#39;.</li><li>MouseMove - Checks to see if you drag off the mousedowncell, and if so, starts a the DoDragDrop.</li><li>MouseUp - Used to reset the mousedowncell.</li><li>DragEnter - Checks to see if the data object has text, and if so, allows a Copy operation. (This could be changed to support Move/Copy.)</li><li>DragOver - Used to set a NoDrop cursor if you move over the mousedowncell (if mousedowncell has been set).</li><li>DragDrop - Used to drop the text into the datagrid.</li></ul><h3 id="_5-33-how-can-i-make-my-datagrid-support-a-single-select-mode-and-not-the-default-multiselect-mode" tabindex="-1"><a class="header-anchor" href="#_5-33-how-can-i-make-my-datagrid-support-a-single-select-mode-and-not-the-default-multiselect-mode" aria-hidden="true">#</a> 5.33 How can I make my DataGrid support a single select mode, and not the default multiselect mode?</h3><p>One way to do this is to derive a DataGrid, override its OnMouseDown and OnMouseMove methods. In the OnMouseDown, handle selecting and unselecting in your code without calling the base class if the click is on the header. In the OnMouseMove, don&#39;t call the baseclass to avoid dragging selections. Below is a code snippet for a sample derived DataGrid. You can download a full project (C#, VB).</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDataGrid</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGrid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> oldSelectedRow <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnMouseMove</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//don&#39;t call the base class if left mouse down</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Button <span class="token operator">!=</span> MouseButtons<span class="token punctuation">.</span>Left<span class="token punctuation">)</span>
            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnMouseMove</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnMouseDown</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//don&#39;t call the base class if in header</span>
        <span class="token class-name">DataGrid<span class="token punctuation">.</span>HitTestInfo</span> hti <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>Cell<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>oldSelectedRow <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">UnSelect</span><span class="token punctuation">(</span>oldSelectedRow<span class="token punctuation">)</span><span class="token punctuation">;</span>

            oldSelectedRow <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnMouseDown</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>RowHeader<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>oldSelectedRow <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">UnSelect</span><span class="token punctuation">(</span>oldSelectedRow<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Control<span class="token punctuation">.</span>ModifierKeys <span class="token operator">&amp;</span> Keys<span class="token punctuation">.</span>Shift<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnMouseDown</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>CurrentCell <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridCell</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">)</span><span class="token punctuation">;</span>
            oldSelectedRow <span class="token operator">=</span> hti<span class="token punctuation">.</span>Row<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-34-how-can-i-get-celltips-or-tooltips-to-vary-from-cell-to-cell-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-34-how-can-i-get-celltips-or-tooltips-to-vary-from-cell-to-cell-in-my-datagrid" aria-hidden="true">#</a> 5.34 How can I get celltips or tooltips to vary from cell to cell in my DataGrid?</h3><p>One way to do this is to use a ToolTip control and reset the control text as the mouse moves from cell to cell. Below is a derived DataGrid class that implements this idea. The main points are:</p><ul><li>Have members that track the current hitRow and hitCol where the mouse is.</li><li>In a MouseMove handler, do a HitTest on the mouse location to see if there is a new hit cell. If so, set the hitRow &amp; hitCol, and hook the tooltip to hold your text according to the cell. In our sample, we just display the string value of the grid cell.</li><li>Finally, in the MouseMove handler, after setting a new text in the tooltip, set the tooltip active so it can show itself in due time.</li></ul><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataGridCellTips</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGrid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> hitRow<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> hitCol<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>ToolTip</span> toolTip1<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">DataGridCellTips</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        hitRow <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        hitCol <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>toolTip1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>ToolTip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>toolTip1<span class="token punctuation">.</span>InitialDelay <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>MouseMove <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MouseEventHandler</span><span class="token punctuation">(</span>HandleMouseMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">HandleMouseMove</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">MouseEventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">DataGrid<span class="token punctuation">.</span>HitTestInfo</span> hti <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>Cell
             <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row <span class="token operator">!=</span> hitRow <span class="token operator">||</span> hti<span class="token punctuation">.</span>Column <span class="token operator">!=</span> hitCol<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>     <span class="token comment">//new hit row</span>
            hitRow <span class="token operator">=</span> hti<span class="token punctuation">.</span>Row<span class="token punctuation">;</span>
            hitCol <span class="token operator">=</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>toolTip1 <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>toolTip1<span class="token punctuation">.</span>Active<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>toolTip1<span class="token punctuation">.</span>Active <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//turn it off</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>toolTip1<span class="token punctuation">.</span><span class="token function">SetToolTip</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">[</span>hitRow<span class="token punctuation">,</span> hitCol<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>toolTip1<span class="token punctuation">.</span>Active <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//make it active so it can show itself</span>
            <span class="token comment">//Console.WriteLine(&quot;MouseMove &quot;+ hitRow.ToString() + &quot; &quot; + hitCol.ToString());</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-35-how-can-i-get-notification-of-the-changing-of-a-value-in-a-column-of-comboboxes-within-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-35-how-can-i-get-notification-of-the-changing-of-a-value-in-a-column-of-comboboxes-within-my-datagrid" aria-hidden="true">#</a> 5.35 How can I get notification of the changing of a value in a column of comboboxes within my datagrid?</h3><p>This solution is based off the combobox for datagrid columns found in this FAQ. That solution replaces the standard textbox with a combobox. To get notifications of the changes, a delegate is passed into the constructor for the custom column style. This delegate is called anytime the combobox value changes. It passes the row number and value as arguments. You can download sample code (C#, VB) that shows the implementation.</p><h3 id="_5-36-how-can-i-make-the-datagrid-have-no-currentcell" tabindex="-1"><a class="header-anchor" href="#_5-36-how-can-i-make-the-datagrid-have-no-currentcell" aria-hidden="true">#</a> 5.36 How can I make the datagrid have no currentcell?</h3><p>There appears to be no method to turn off a currentcell. When a cell is being edited, it is the TextBox embedded in the columnstyle that has the focus, and is displaying the highlighted text. You will notice in this situation, if you click the grid&#39;s title bar above the column headers, this TextEdit control loses focus, and the datagrid appears to have no current cell.</p><p>We can simulate this click from code, and use it to expose a method in our datagrid to SetNoCurrentCell. Below is some code to illustrate this idea.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDataGrid</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGrid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> WM_LBUTTONDOWN <span class="token operator">=</span> <span class="token number">513</span><span class="token punctuation">;</span> <span class="token comment">// 0x0201</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> WM_LBUTTONUP <span class="token operator">=</span> <span class="token number">514</span><span class="token punctuation">;</span> <span class="token comment">// 0x0202</span>

    <span class="token punctuation">[</span>System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices<span class="token punctuation">.</span><span class="token function">DllImport</span><span class="token punctuation">(</span><span class="token string">&quot;user32.dll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">SendMessage</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> hWnd<span class="token punctuation">,</span> <span class="token class-name">Int32</span> msg<span class="token punctuation">,</span> <span class="token class-name">Int32</span> wParam<span class="token punctuation">,</span> <span class="token class-name">Int32</span> lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetNoCurrentCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//click on top left corner of the grid </span>
        <span class="token function">SendMessage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Handle<span class="token punctuation">,</span> WM_LBUTTONDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">SendMessage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Handle<span class="token punctuation">,</span> WM_LBUTTONUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Here is some VB code.</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Class</span> MyDataGrid
    <span class="token keyword">Inherits</span> DataGrid
    
    <span class="token keyword">Public</span> WM_LBUTTONDOWN <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token operator">=</span> <span class="token number">513</span>
    <span class="token keyword">Public</span> WM_LBUTTONUP <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token operator">=</span> <span class="token number">514</span>

    <span class="token keyword">Shared</span> <span class="token operator">_</span> 
    <span class="token keyword">Function</span> SendMessage<span class="token punctuation">(</span>hWnd <span class="token keyword">As</span> IntPtr<span class="token punctuation">,</span> msg <span class="token keyword">As</span> Int32<span class="token punctuation">,</span> wParam <span class="token keyword">As</span> Int32<span class="token punctuation">,</span> lParam <span class="token keyword">As</span> Int32<span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Boolean</span>

    <span class="token keyword">Public</span> <span class="token keyword">Sub</span> SetNoCurrentCell<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">&#39;click on top left corner of the grid</span>
        SendMessage<span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">.</span>Handle<span class="token punctuation">,</span> WM_LBUTTONDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        SendMessage<span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">.</span>Handle<span class="token punctuation">,</span> WM_LBUTTONUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;SetNoCurrentCell</span>
<span class="token keyword">End</span> <span class="token keyword">Class</span> <span class="token comment">&#39;MyDataGrid</span>
</code></pre></div><h3 id="_5-37-how-can-i-make-my-grid-never-have-an-active-edit-cell-and-always-select-whole-rows-as-in-a-browser-type-grid" tabindex="-1"><a class="header-anchor" href="#_5-37-how-can-i-make-my-grid-never-have-an-active-edit-cell-and-always-select-whole-rows-as-in-a-browser-type-grid" aria-hidden="true">#</a> 5.37 How can I make my grid never have an active edit cell and always select whole rows (as in a browser-type grid)?</h3><p>For a single row select datagrid, you can get both these behaviors by using a custom column style and overriding its Edit method. In your override, handle unselecting and selecting the current row, and DO NOT call the base class. Not calling the base class keeps the cell from becoming active. Here is a code snippet suggesting how this might be done. You can download a full working project (CS, VB).</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataGridNoActiveCellColumn</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGridTextBoxColumn</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> SelectedRow <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Edit</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>CurrencyManager</span> source<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> rowNum<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Rectangle</span> bounds<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> readOnly<span class="token punctuation">,</span> <span class="token class-name">stringi</span> nstantText<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> cellIsVisible<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//make sure previous selection is valid </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>SelectedRow <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> SelectedRow <span class="token operator">&lt;</span> source<span class="token punctuation">.</span>List<span class="token punctuation">.</span>Count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>DataGridTableStyle<span class="token punctuation">.</span>DataGrid<span class="token punctuation">.</span><span class="token function">UnSelect</span><span class="token punctuation">(</span>SelectedRow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        SelectedRow <span class="token operator">=</span> rowNum<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>DataGridTableStyle<span class="token punctuation">.</span>DataGrid<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>SelectedRow<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you want to handle multi-selections, then there is more work to be done. One solution is to still override Edit as above, but have an empty implementation. Do not have the code the handles the selected row and do not call the baseclass. To handle the selections in this case, subclass the datagrid and override its OnMouseDown virtual method to change all cell clicks into row header clicks. Also override OnCurrentCellChanged to handle moving the current cell with the keyboard. You can download a sample (C#, VB) that implements this functionality.</p><h3 id="_5-38-i-have-hidden-column-width-0-columns-on-the-right-side-of-my-datagrid-but-tabbing-does-not-work-properly-how-can-i-get-tabbing-to-work" tabindex="-1"><a class="header-anchor" href="#_5-38-i-have-hidden-column-width-0-columns-on-the-right-side-of-my-datagrid-but-tabbing-does-not-work-properly-how-can-i-get-tabbing-to-work" aria-hidden="true">#</a> 5.38 I have hidden (column width = 0) columns on the right side of my datagrid, but tabbing does not work properly. How can I get tabbing to work?</h3><p>As you tabbed to the right side of your grid, you have to tabbed through these zero width column and that is causing the tab key to appear not to work properly. One solution is to handle the grid&#39;s CurrentCellChanged event, and if you are on a border cell (among the hidden columns), then explicitly set the proper currentcell.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">//columns 3-6 are hidden with 0-column width...</span>
<span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> LEFTHIDDENCOLUMN <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> RIGHTHIDDENCOLUMN <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dataGrid1_CurrentCellChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dataGrid1<span class="token punctuation">.</span>CurrentCell<span class="token punctuation">.</span>ColumnNumber <span class="token operator">==</span> LEFTHIDDENCOLUMN<span class="token punctuation">)</span>
        dataGrid1<span class="token punctuation">.</span>CurrentCell <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridCell</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">.</span>CurrentCell<span class="token punctuation">.</span>RowNumber <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>dataGrid1<span class="token punctuation">.</span>CurrentCell<span class="token punctuation">.</span>ColumnNumber <span class="token operator">==</span> RIGHTHIDDENCOLUMN<span class="token punctuation">)</span>
        dataGrid1<span class="token punctuation">.</span>CurrentCell <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridCell</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">.</span>CurrentCell<span class="token punctuation">.</span>RowNumber<span class="token punctuation">,</span> LEFTHIDDENCOLUMN <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-39-how-can-i-get-the-number-of-rows-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-39-how-can-i-get-the-number-of-rows-in-my-datagrid" aria-hidden="true">#</a> 5.39 How can I get the number of rows in my DataGrid?</h3><p>One way you can do this is through the BindingManager.Count property.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token class-name"><span class="token keyword">int</span></span> numRows <span class="token operator">=</span> dataGridDetails<span class="token punctuation">.</span>BindingContext<span class="token punctuation">[</span>dataGridDetails<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> dataGridDetails<span class="token punctuation">.</span>DataMember<span class="token punctuation">]</span><span class="token punctuation">.</span>Count<span class="token punctuation">;</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Dim</span> numRows <span class="token keyword">as</span> <span class="token keyword">Integer</span> <span class="token operator">=</span> i dataGridDetails<span class="token punctuation">.</span>BindingContext<span class="token punctuation">(</span>dataGridDetails<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> dataGridDetails<span class="token punctuation">.</span>DataMember<span class="token punctuation">)</span><span class="token punctuation">.</span>Count;
</code></pre></div><h3 id="_5-40-how-do-i-format-a-date-column-in-a-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-40-how-do-i-format-a-date-column-in-a-datagrid" aria-hidden="true">#</a> 5.40 How do I format a date column in a datagrid?</h3><p>If you have added a table style to your datagrid (so individual column styles have been generated), then you can use code such as this to set the Format property of the particular column style.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token comment">//add format col 3 columnstyle where column 3 holds a date...</span>
<span class="token class-name">DataGridTextBoxColumn</span> dgtbc<span class="token punctuation">;</span>
dgtbc <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">DataGridTextBoxColumn</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>dgtbc <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    dgtbc<span class="token punctuation">.</span>Format <span class="token operator">=</span> <span class="token string">&quot;g&quot;</span><span class="token punctuation">;</span> <span class="token comment">// or &quot;u&quot; or whatever format you want to see</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token comment">&#39;add format col 3 columnstyle where column 3 holds a date...</span>
<span class="token keyword">Dim</span> dgtbc <span class="token keyword">as</span> DataGridTextBoxColumn
dgtbc <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DataGridTextBoxColumn<span class="token punctuation">)</span>

<span class="token keyword">If</span> <span class="token keyword">Not</span> dgtbc <span class="token keyword">is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
    dgtbc<span class="token punctuation">.</span>Format <span class="token operator">=</span> <span class="token string">&quot;g&quot;</span> <span class="token comment">&#39; or &quot;u&quot; or whatever format you want to see</span>
<span class="token keyword">End</span> <span class="token keyword">If</span>
</code></pre></div><h3 id="_5-41-how-can-i-change-the-width-of-the-row-headers-or-hide-them" tabindex="-1"><a class="header-anchor" href="#_5-41-how-can-i-change-the-width-of-the-row-headers-or-hide-them" aria-hidden="true">#</a> 5.41 How can I change the width of the row headers or hide them?</h3><p>You can get at the width and visibility of the header row/column through a DataGridTableStyle. DataGridTableStyle has properties such as RowHeadersVisible and RowHeadersWidth. DataGridTableStyle also controls things like selections colors and GridLine styles.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// Create a table style that will hold the new column style </span>
<span class="token comment">// that we set and also tie it to our customer&#39;s table from our DB </span>
<span class="token class-name">DataGridTableStyle</span> tableStyle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTableStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tableStyle<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token string">&quot;customers&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//hide the column headers </span>
tableStyle<span class="token punctuation">.</span>ColumnHeadersVisible <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">//change width of the row headers </span>
tableStyle<span class="token punctuation">.</span>RowHeadersWidth <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token comment">// make the dataGrid use our new tablestyle and bind it to our table </span>
dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>tableStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-42-how-do-i-catch-a-doubleclick-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-42-how-do-i-catch-a-doubleclick-in-my-datagrid" aria-hidden="true">#</a> 5.42 How do I catch a doubleclick in my datagrid?</h3><p>The problem is that the first click of a double click may be caught by the datagrid (and used to activate the cell) while the second click goes to the TextBox for the columnstyle object. This means the TextBox thinks this is a singleclick, and does not fire its doubleclick event. One solution is to mark the time of the click caught by the datagrid. Then look at this time in the TextBox&#39;s mousedown handler to see if in fact the single click being looked at by the TextBox is part of a double click. You can download a sample (C#, VB) that illustrates how this might be done.</p><h3 id="_5-43-how-can-i-make-my-last-column-wide-enough-to-exactly-occupy-all-the-client-area-of-the-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-43-how-can-i-make-my-last-column-wide-enough-to-exactly-occupy-all-the-client-area-of-the-datagrid" aria-hidden="true">#</a> 5.43 How can I make my last column wide enough to exactly occupy all the client area of the datagrid?</h3><p>If you have added a TableStyle for your grid, then the code below should set the right column width to be the empty space from a button click. If you need to dynamically do this in response to the user sizing other columns, then there may be more work. But if you only need to do it at the end of your Form_Load, then this code might be sufficient. It assumes your datasource is a datatable. You can download a sample project (C#, VB).</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">int</span></span> numCols <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DataTable<span class="token punctuation">)</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Columns<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>

    <span class="token comment">//the fudge -4 is for the grid borders </span>
    <span class="token class-name"><span class="token keyword">int</span></span> targetWidth <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>ClientSize<span class="token punctuation">.</span>Width <span class="token operator">-</span> SystemInformation<span class="token punctuation">.</span>VerticalScrollBarWidth <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">int</span></span> runningWidthUsed <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>RowHeaderWidth<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numCols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        runningWidthUsed <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Width<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>runningWidthUsed <span class="token operator">&lt;</span> targetWidth<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span>numCols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Width <span class="token operator">=</span> targetWidth <span class="token operator">-</span> runningWidthUsed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-44-how-can-i-prevent-my-user-from-sizing-columns-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-44-how-can-i-prevent-my-user-from-sizing-columns-in-my-datagrid" aria-hidden="true">#</a> 5.44 How can I prevent my user from sizing columns in my datagrid?</h3><p>You can do this by subclassing your grid and overriding OnMouseMove, and not calling the baseclass if the point is on the columnsizing border.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDataGrid</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGrid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnMouseMove</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">DataGrid<span class="token punctuation">.</span>HitTestInfo</span> hti <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>ColumnResize<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//no baseclass call </span>
        <span class="token punctuation">}</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnMouseMove</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Public</span> <span class="token keyword">Class</span> MyDataGrid
    <span class="token keyword">Inherits</span> DataGrid
    <span class="token keyword">Protected</span> <span class="token keyword">Overrides</span> <span class="token keyword">Sub</span> OnMouseMove<span class="token punctuation">(</span><span class="token keyword">ByVal</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs<span class="token punctuation">)</span>
        <span class="token keyword">Dim</span> hti <span class="token keyword">As</span> DataGrid<span class="token punctuation">.</span>HitTestInfo <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>HitTest<span class="token punctuation">(</span><span class="token keyword">New</span> Point<span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">If</span> hti<span class="token punctuation">.</span><span class="token keyword">Type</span> <span class="token operator">=</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>ColumnResize <span class="token keyword">Then</span>
            <span class="token keyword">Return</span> <span class="token comment">&#39;no baseclass call</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">MyBase</span><span class="token punctuation">.</span>OnMouseMove<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">End</span> <span class="token keyword">Class</span>
</code></pre></div><p>The above code prevents the sizing cursor from appearing, but as Stephen Muecke pointed out to us, if the user just clicks on the border, he can still size the column. Stephen&#39;s solution to this problem is to add similar code in an override of OnMouseDown.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnMouseDown</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DataGrid<span class="token punctuation">.</span>HitTestInfo</span> hti <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>ColumnResize<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//no baseclass call</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnMouseDown</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code>[VB<span class="token punctuation">.</span>NET]
<span class="token keyword">Protected</span> <span class="token keyword">Overrides</span> <span class="token keyword">Sub</span> OnMouseDown<span class="token punctuation">(</span><span class="token keyword">ByVal</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs<span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> hti <span class="token keyword">As</span> DataGrid<span class="token punctuation">.</span>HitTestInfo <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>HitTest<span class="token punctuation">(</span><span class="token keyword">New</span> Point<span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span>e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">If</span> hti<span class="token punctuation">.</span><span class="token keyword">Type</span> <span class="token operator">=</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>ColumnResize <span class="token keyword">Then</span>
        <span class="token keyword">Return</span> <span class="token comment">&#39;no baseclass call</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">MyBase</span><span class="token punctuation">.</span>OnMouseDown<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre></div><h3 id="_5-45-how-can-i-catch-the-bool-values-changing-in-a-datagridboolcolumn" tabindex="-1"><a class="header-anchor" href="#_5-45-how-can-i-catch-the-bool-values-changing-in-a-datagridboolcolumn" aria-hidden="true">#</a> 5.45 How can I catch the bool values changing in a DataGridBoolColumn?</h3><p>There is no event fired when the boolean value changes. In the attached sample (C#, VB), a BoolValueChanged event has been added to a columnstyle derived from DataGridBoolColumn. Catching the changes requires some effort. The strategy is to save the current value when the cell begins being edited. This is done in an override of Edit. Then in a Paint override, checks are done to see if there is a click in the checkbox cell or if the space bar is hit. If either of these situations happen when the cell is actively being edited, the bool value is changed and the event fired.</p><h3 id="_5-46-when-i-click-on-a-row-header-the-row-is-selected-and-no-cell-is-active-how-can-i-do-this-programmatically" tabindex="-1"><a class="header-anchor" href="#_5-46-when-i-click-on-a-row-header-the-row-is-selected-and-no-cell-is-active-how-can-i-do-this-programmatically" aria-hidden="true">#</a> 5.46 When I click on a row header, the row is selected and no cell is active. How can I do this programmatically?</h3><p>This code adds a method to a derived grid that simulates a mouseclick on the rowheader of the row passed into the method.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDataGrid</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGrid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> WM_LBUTTONDOWN <span class="token operator">=</span> <span class="token number">513</span><span class="token punctuation">;</span> <span class="token comment">// 0x0201</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> WM_LBUTTONUP <span class="token operator">=</span> <span class="token number">514</span><span class="token punctuation">;</span> <span class="token comment">// 0x0202</span>

    <span class="token punctuation">[</span>System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices<span class="token punctuation">.</span><span class="token function">DllImport</span><span class="token punctuation">(</span><span class="token string">&quot;user32.dll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">SendMessage</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> hWnd<span class="token punctuation">,</span> <span class="token class-name">Int32</span> msg<span class="token punctuation">,</span> <span class="token class-name">Int32</span> wParam<span class="token punctuation">,</span> <span class="token class-name">Int32</span> lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ClickRowHeader</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> row<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//get a point to click </span>
        <span class="token class-name">Rectangle</span> rect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetCellBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Int32</span> lparam <span class="token operator">=</span> <span class="token function">MakeLong</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>Left <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">,</span> rect<span class="token punctuation">.</span>Top <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//clickit </span>
        <span class="token function">SendMessage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Handle<span class="token punctuation">,</span> WM_LBUTTONDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> lparam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">SendMessage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Handle<span class="token punctuation">,</span> WM_LBUTTONUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> lparam<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MakeLong</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> LoWord<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> HiWord<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>HiWord <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>LoWord <span class="token operator">&amp;</span> <span class="token number">0xffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token range operator">..</span><span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token range operator">..</span><span class="token range operator">..</span><span class="token punctuation">.</span>

<span class="token comment">//usage - myDataGrid is of type MyDataGrid. </span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button2_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    myDataGrid<span class="token punctuation">.</span><span class="token function">ClickRowHeader</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-47-how-can-i-force-the-vertical-scrollbar-in-my-datagrid-to-always-be-visible" tabindex="-1"><a class="header-anchor" href="#_5-47-how-can-i-force-the-vertical-scrollbar-in-my-datagrid-to-always-be-visible" aria-hidden="true">#</a> 5.47 How can I force the vertical scrollbar in my DataGrid to always be visible?</h3><p>Derive a DataGrid. In your derived grid, add a handler for the VertScrollBar.VisibleChanged event. In your handler, if the scrollbar is not visible, size it and position it, and then show it. The code below assumes no horizontal scrollbar is necessary. If it is present, you would have to adjust the sizing code.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// C#</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDataGrid</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGrid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MyDataGrid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//make scrollbar visible &amp; hook up handler </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>VisibleChanged <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventHandler</span><span class="token punctuation">(</span>ShowScrollBars<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> CAPTIONHEIGHT <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> BORDERWIDTH <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowScrollBars</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Visible<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Width<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Location <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ClientRectangle<span class="token punctuation">.</span>Width <span class="token operator">-</span> width <span class="token operator">-</span> BORDERWIDTH<span class="token punctuation">,</span> CAPTIONHEIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ClientRectangle<span class="token punctuation">.</span>Height <span class="token operator">-</span> CAPTIONHEIGHT <span class="token operator">-</span> BORDERWIDTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; VB.NET</span>
<span class="token keyword">Public</span> <span class="token keyword">Class</span> MyDataGrid
    <span class="token keyword">Inherits</span> DataGrid

    <span class="token keyword">Public</span> <span class="token keyword">Sub</span> <span class="token keyword">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">&#39;make scrollbar visible &amp; hook up handler</span>
        <span class="token keyword">Me</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">AddHandler</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>VisibleChanged<span class="token punctuation">,</span> <span class="token keyword">AddressOf</span> ShowScrollBars
    <span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;New</span>

    <span class="token keyword">Private</span> CAPTIONHEIGHT <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token operator">=</span> <span class="token number">21</span>
    <span class="token keyword">Private</span> BORDERWIDTH <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token operator">=</span> <span class="token number">2</span>

    <span class="token keyword">Private</span> <span class="token keyword">Sub</span> ShowScrollBars<span class="token punctuation">(</span>sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> e <span class="token keyword">As</span> EventArgs<span class="token punctuation">)</span> 
        <span class="token keyword">If</span> <span class="token keyword">Not</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Visible <span class="token keyword">Then</span> 
            <span class="token keyword">Dim</span> width <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Width 
            <span class="token keyword">Me</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Location <span class="token operator">=</span> <span class="token keyword">New</span> Point<span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">.</span>ClientRectangle<span class="token punctuation">.</span>Width <span class="token operator">-</span> width <span class="token operator">-</span> BORDERWIDTH<span class="token punctuation">,</span> CAPTIONHEIGHT<span class="token punctuation">)</span> 
            <span class="token keyword">Me</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Size <span class="token operator">=</span> <span class="token keyword">New</span> Size<span class="token punctuation">(</span>width<span class="token punctuation">,</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>ClientRectangle<span class="token punctuation">.</span>Height <span class="token operator">-</span> CAPTIONHEIGHT <span class="token operator">-</span> BORDERWIDTH<span class="token punctuation">)</span>
            <span class="token keyword">Me</span><span class="token punctuation">.</span>VertScrollBar<span class="token punctuation">.</span>Show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span> 
    <span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;ShowScrollBars </span>
<span class="token keyword">End</span> <span class="token keyword">Class</span> <span class="token comment">&#39;MyDataGrid</span>
</code></pre></div><h3 id="_5-48-how-can-i-autosize-a-column-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-48-how-can-i-autosize-a-column-in-my-datagrid" aria-hidden="true">#</a> 5.48 How can I autosize a column in my datagrid?</h3><p>One way to do this is to use MeasureString to compute the size of the text in each cell, and then take the maximum value. Below is a code snippet that does this. It assumes your datagrid is bound to a datatable. You can download a full working sample. (C#,VB).</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AutoSizeCol</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> col<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">float</span></span> width <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> numRows <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DataTable<span class="token punctuation">)</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">)</span><span class="token punctuation">.</span>Rows<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>

    <span class="token class-name">Graphics</span> g <span class="token operator">=</span> Graphics<span class="token punctuation">.</span><span class="token function">FromHwnd</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">.</span>Handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StringFormat</span> sf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringFormat</span><span class="token punctuation">(</span>StringFormat<span class="token punctuation">.</span>GenericTypographic<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SizeF</span> size<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numRows<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        size <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">MeasureString</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">[</span>i<span class="token punctuation">,</span> col<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataGrid1<span class="token punctuation">.</span>Font<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> sf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token punctuation">.</span>Width <span class="token operator">&gt;</span> width<span class="token punctuation">)</span>
            width <span class="token operator">=</span> size<span class="token punctuation">.</span>Width<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    g<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>width <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">// 8 is for leading and trailing padding </span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-49-how-can-i-get-rid-of-the-error-icon-that-appears-when-there-is-an-editing-error" tabindex="-1"><a class="header-anchor" href="#_5-49-how-can-i-get-rid-of-the-error-icon-that-appears-when-there-is-an-editing-error" aria-hidden="true">#</a> 5.49 How can I get rid of the error icon that appears when there is an editing error?</h3><p>Adam Chester gives this solution in a posting on the microsoft.public.dotnet.framework.windowsforms newgroup.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">DataTable</span> dt <span class="token operator">=</span> <span class="token punctuation">(</span>DataTable<span class="token punctuation">)</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DataRow</span> row <span class="token keyword">in</span> dt<span class="token punctuation">.</span><span class="token function">GetErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    row<span class="token punctuation">.</span>RowError <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DataColumn</span> col <span class="token keyword">in</span> dt<span class="token punctuation">.</span>Columns<span class="token punctuation">)</span>
        row<span class="token punctuation">.</span><span class="token function">SetColumnError</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-50-how-do-i-find-the-top-left-visible-cell-in-a-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-50-how-do-i-find-the-top-left-visible-cell-in-a-datagrid" aria-hidden="true">#</a> 5.50 How do I find the top-left visible cell in a datagrid?</h3><p>In a Windows Forms DataGrid, there is no property exposed that gives you this information. But here is little trick that will allow you to get the top-left visible cell.</p><ol><li><p>Add a private member Point pointInCell00 to the form containing the datagrid.</p></li><li><p>After the datagrid has been initialized, but before your user has been able to scroll it (say at the end of the Form_Load event), use code such as this to initialize pointInCell00 to be a point in cell 0,0.</p><p><code>pointInCell00 = new Point(dataGrid1.GetCellBounds(0,0).X + 4, dataGrid1.GetCellBounds(0,0).Y + 4);</code></p></li><li><p>Then add this method to return DataGridCell that is the top-left cell.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">DataGridCell</span> <span class="token function">TopLeftVisibleCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DataGrid<span class="token punctuation">.</span>HitTestInfo</span> hti <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pointInCell00<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridCell</span><span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//sample usage...</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DataGridCell</span> dgc <span class="token operator">=</span> <span class="token function">TopLeftVisibleCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>dgc<span class="token punctuation">.</span>RowNumber<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> dgc<span class="token punctuation">.</span>ColumnNumber<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol><h3 id="_5-51-i-want-to-display-negative-values-with-a-cr-suffix-instead-of-a-minus-sign-how-can-i-perform-custom-formatting-on-the-cells-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-51-i-want-to-display-negative-values-with-a-cr-suffix-instead-of-a-minus-sign-how-can-i-perform-custom-formatting-on-the-cells-in-my-datagrid" aria-hidden="true">#</a> 5.51 I want to display negative values with a CR suffix, instead of a minus sign. How can I perform custom formatting on the cells in my datagrid?</h3>`,86),w={href:"http://support.microsoft.com/default.aspx?scid=kb;en-us;Q318581",target:"_blank",rel:"noopener noreferrer"},g=o(`<h3 id="_5-52-i-want-to-do-sort-of-a-database-join-of-two-tables-how-can-i-use-data-from-two-datatables-in-a-single-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-52-i-want-to-do-sort-of-a-database-join-of-two-tables-how-can-i-use-data-from-two-datatables-in-a-single-datagrid" aria-hidden="true">#</a> 5.52 I want to do sort of a database join of two tables. How can I use data from two DataTables in a single DataGrid?</h3><p>Take a look at this Microsoft KB article, HOW TO: Extend the Windows Form DataGridTextBoxColumn to Display Data From Other Tables (C#,VB). It subclasses a DataGridColumnStyle and overrides GetColumnValueAtRow, Commit and ReadOnly to implement this behavior.</p><h3 id="_5-53-how-do-i-display-a-column-of-buttons-such-as-pushbuttons-or-combobox-buttons" tabindex="-1"><a class="header-anchor" href="#_5-53-how-do-i-display-a-column-of-buttons-such-as-pushbuttons-or-combobox-buttons" aria-hidden="true">#</a> 5.53 How do I display a column of buttons such as pushbuttons or combobox buttons?</h3><p>This sample (download C#, download VB) derives two custom columnstyles that display buttons. One displays a pushbutton with the cell text used as the button label. The second columnstyle displays text plus a dropdown button similar to a combobox button. Both columnstyles have an event that your form can handle to respond to clicks on the buttons. The row and column of the click are passed as part of the event arguments.</p><p>Both columnstyles derive from DataGridTextBoxColumn, and override Paint and Edit. The Edit override does not call the baseclass to avoid allowing the cell going into the edit mode. In the Paint override, the text is drawn, and a bitmap showing the button face is drawn.</p><p>There is no mouse handling within a columnstyle. To catch the click action, the columnstyle must handle the datagrid&#39;s MouseDown and MouseUp events. In the columnstyle handlers for these events, the handler draws the depressed button as well as firing the columnstyle&#39;s ColumnButtonClick event.</p><p>Your handler for this ColumnButtonClick event should take whatever action as a result of the buttonclick. In the sample projects, the handler just displays a messagebox.</p><h3 id="_5-54-how-can-i-put-up-a-confirmation-question-when-the-user-tries-to-delete-a-row-in-the-datagrid-by-clicking-on-the-row-header-and-pressing-the-delete-key" tabindex="-1"><a class="header-anchor" href="#_5-54-how-can-i-put-up-a-confirmation-question-when-the-user-tries-to-delete-a-row-in-the-datagrid-by-clicking-on-the-row-header-and-pressing-the-delete-key" aria-hidden="true">#</a> 5.54 How can I put up a confirmation question when the user tries to delete a row in the datagrid by clicking on the row header and pressing the Delete key?</h3><p>You can handle this by subclassing your grid and overriding either PreProcessMessage or ProcessDialogKey. The code below assumes your datasource is a dataview. If it is not, you could just remove that check</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">PreProcessMessage</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name">Message</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Keys</span> keyCode <span class="token operator">=</span> <span class="token punctuation">(</span>Keys<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>msg<span class="token punctuation">.</span>WParam <span class="token operator">&amp;</span> Keys<span class="token punctuation">.</span>KeyCode<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Msg <span class="token operator">==</span> WM_KEYDOWN
         <span class="token operator">&amp;&amp;</span> keyCode <span class="token operator">==</span> Keys<span class="token punctuation">.</span>Delete
         <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DataView<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>DataSource<span class="token punctuation">)</span><span class="token punctuation">.</span>AllowDelete<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">&quot;Delete this row?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> MessageBoxButtons<span class="token punctuation">.</span>YesNo<span class="token punctuation">)</span> <span class="token operator">==</span> DialogResult<span class="token punctuation">.</span>No<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">PreProcessMessage</span><span class="token punctuation">(</span><span class="token keyword">ref</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET] (courtesy of Erik Johansen)</span>
<span class="token keyword">Public</span> <span class="token keyword">Class</span> DataGrid_Custom
    <span class="token keyword">Inherits</span> DataGrid

    <span class="token keyword">Private</span> <span class="token keyword">Const</span> WM_KEYDOWN <span class="token operator">=</span> <span class="token number">&amp;H100</span>

    <span class="token keyword">Public</span> <span class="token keyword">Overrides</span> <span class="token keyword">Function</span> PreProcessMessage<span class="token punctuation">(</span><span class="token keyword">ByRef</span> msg <span class="token keyword">As</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Message<span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Boolean</span>

        <span class="token keyword">Dim</span> keyCode <span class="token keyword">As</span> Keys <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>WParam<span class="token punctuation">.</span>ToInt32 <span class="token keyword">And</span> Keys<span class="token punctuation">.</span>KeyCode<span class="token punctuation">)</span><span class="token punctuation">,</span> Keys<span class="token punctuation">)</span>
        <span class="token keyword">If</span> msg<span class="token punctuation">.</span>Msg <span class="token operator">=</span> WM_KEYDOWN <span class="token keyword">And</span> keyCode <span class="token operator">=</span> Keys<span class="token punctuation">.</span>Delete <span class="token keyword">Then</span>
            <span class="token keyword">If</span> MessageBox<span class="token punctuation">.</span>Show<span class="token punctuation">(</span><span class="token string">&quot;Delete This Row?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Confirm Delete&quot;</span><span class="token punctuation">,</span> MessageBoxButtons<span class="token punctuation">.</span>YesNo<span class="token punctuation">)</span> <span class="token operator">=</span> DialogResult<span class="token punctuation">.</span>No <span class="token keyword">Then</span>
                <span class="token keyword">Return</span> <span class="token boolean">True</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Return</span> <span class="token keyword">MyBase</span><span class="token punctuation">.</span>PreProcessMessage<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>

    <span class="token keyword">End</span> <span class="token keyword">Function</span> 
<span class="token keyword">End</span> <span class="token keyword">Class</span>
</code></pre></div><h3 id="_5-55-how-can-i-enable-column-selections-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-55-how-can-i-enable-column-selections-in-my-datagrid" aria-hidden="true">#</a> 5.55 How can I enable column selections in my datagrid?</h3><p>Here is a sample (C#, VB) that has column selections implemented. It derives a datagrid, adds a columns selection array list, and maintains this list in an override of OnMouseDown. Then to handle actually drawing the selected columns, it uses a derived column style, and sets the backBrush color and foreBrush color to the selection values in the override of the Paint method when it needs to draw a selected cell.</p><p>As an alternative to drawing the selection in a derived column style, you could just draw the selection in your derived grid by overriding OnPaint, calling the base class and then looping through the columns selections, filling a rectangle over the selected columns. The problem with this technique is that you would either have to redraw text in column with the correct forecolor, or you would have to use an alphablended color to let the text show through the selection rectangle. Using an alphablended color would eliminate the need to a column style override, but would give a different appearance than the &#39;standard&#39; selections that you see in a datagrid. The sample allows the row selections to continue to work so the column style override makes sense here.</p><h3 id="_5-56-how-do-i-programmatically-scroll-the-datagrid-to-a-particular-row" tabindex="-1"><a class="header-anchor" href="#_5-56-how-do-i-programmatically-scroll-the-datagrid-to-a-particular-row" aria-hidden="true">#</a> 5.56 How do I programmatically scroll the datagrid to a particular row?</h3><p>The DataGrid has a protected GridVScrolled member that can be used to scroll the grid. To use it, you can derive from DataGrid and add a ScrollToRow method. Here is a code snippet.</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Class</span> MyDataGrid 
<span class="token keyword">Inherits</span> DataGrid 
    <span class="token keyword">Sub</span> ScrollToRow<span class="token punctuation">(</span><span class="token keyword">ByVal</span> row <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">)</span> 
        <span class="token keyword">If</span> <span class="token keyword">Not</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>DataSource <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span> 
            <span class="token keyword">Me</span><span class="token punctuation">.</span>GridVScrolled<span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">,</span> <span class="token keyword">New</span> ScrollEventArgs<span class="token punctuation">(</span>ScrollEventType<span class="token punctuation">.</span>LargeIncrement<span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token keyword">End</span> <span class="token keyword">If</span> 
    <span class="token keyword">End</span> <span class="token keyword">Sub</span> 
<span class="token keyword">End</span> <span class="token keyword">Class</span>
</code></pre></div><p>This solution uses information provided by Daniel Herling (MS) in the microsoft.public.dotnet.framework.windowsforms.databinding newsgroup.</p><h3 id="_5-57-how-can-i-place-text-in-the-rowheader-column-of-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-57-how-can-i-place-text-in-the-rowheader-column-of-my-datagrid" aria-hidden="true">#</a> 5.57 How can I place text in the rowheader column of my datagrid?</h3><p>There is no text property exposed for a rowheader cell. But you can handle the Paint event and draw header text yourself. You can download sample projects (C#, VB) that illustrate one technique for doing so.</p><p>The sample loads the datagrid in the form&#39;s Load event. In addition, this event is used to set the rowheaderwidth of the datagrid, and to remember the point where cell 0,0 is located. This point will allow us to find the toprow number when we need it to start drawing the header text. A handler for the datagrid&#39;s Paint event is used to draw the text. It finds the toprow using the point from the original cell 0,0, and using the toprow determines the correct text for each rowheader. Finally, to avoid the complication of the user changing rowheights, we derive a new grid to prevent this.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dataGrid1_Paint</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>PaintEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">int</span></span> row <span class="token operator">=</span> <span class="token function">TopRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> yDelta <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span><span class="token function">GetCellBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Height <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> y <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span><span class="token function">GetCellBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Top <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token class-name">CurrencyManager</span> cm <span class="token operator">=</span> <span class="token punctuation">(</span>CurrencyManager<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>BindingContext<span class="token punctuation">[</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> dataGrid1<span class="token punctuation">.</span>DataMember<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>y <span class="token operator">&lt;</span> dataGrid1<span class="token punctuation">.</span>Height <span class="token operator">-</span> yDelta <span class="token operator">&amp;&amp;</span> row <span class="token operator">&lt;</span> cm<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//get &amp; draw the header text...</span>
        <span class="token class-name"><span class="token keyword">string</span></span> text <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">&quot;row{0}&quot;</span><span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span>Graphics<span class="token punctuation">.</span><span class="token function">DrawString</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> dataGrid1<span class="token punctuation">.</span>Font<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SolidBrush</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>Black<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">+=</span> yDelta<span class="token punctuation">;</span>
        row<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Here is a datagrid with red row headers containing text.</p><p><img src="`+u+`" alt="dg39_1"></p><h3 id="_5-58-how-do-i-set-default-values-for-new-rows-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-58-how-do-i-set-default-values-for-new-rows-in-my-datagrid" aria-hidden="true">#</a> 5.58 How do I set default values for new rows in my datagrid?</h3><p>You use the DataColumn.DefaultValue property to provide default values for new rows. You access this property through the DataTable associated with the DataGrid,</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token range operator">..</span><span class="token range operator">..</span>

<span class="token range operator">..</span><span class="token range operator">..</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>_dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;Orders&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Columns<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>DefaultValue <span class="token operator">=</span> <span class="token string">&quot;CustID&quot;</span><span class="token punctuation">;</span> <span class="token comment">// default value for column 1</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;Orders&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Columns<span class="token punctuation">[</span><span class="token string">&quot;OrderDate&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>DefaultValue <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span> <span class="token comment">// default value for OrderDate column</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>_dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">(</span><span class="token string">&quot;Orders&quot;</span><span class="token punctuation">)</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">Me</span><span class="token punctuation">.</span>_dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">(</span><span class="token string">&quot;Orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Columns<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>DefaultValue <span class="token operator">=</span> <span class="token string">&quot;CustID&quot;</span> <span class="token comment">&#39; default value for column 1</span>
<span class="token keyword">Me</span><span class="token punctuation">.</span>_dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">(</span><span class="token string">&quot;Orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Columns<span class="token punctuation">(</span><span class="token string">&quot;OrderDate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>DefaultValue <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now <span class="token comment">&#39; default value for OrderDate column</span>
</code></pre></div><h3 id="_5-59-how-do-i-iterate-through-all-the-rows-and-columns-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-59-how-do-i-iterate-through-all-the-rows-and-columns-in-my-datagrid" aria-hidden="true">#</a> 5.59 How do I iterate through all the rows and columns in my datagrid?</h3><p>You use the row index and column index as indexers on the DataGrid object.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">CurrencyManager</span> cm <span class="token operator">=</span> <span class="token punctuation">(</span>CurrencyManager<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>BindingContext<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">int</span></span> rowCount <span class="token operator">=</span> cm<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>
    <span class="token comment">//assumes datasource is a datatable... </span>
    <span class="token class-name"><span class="token keyword">int</span></span> colCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DataTable<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">)</span><span class="token punctuation">.</span>Columns<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> row<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> col <span class="token operator">&lt;</span> colCount<span class="token punctuation">;</span> col<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">object</span></span> cellValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">[</span>row<span class="token punctuation">,</span> col<span class="token punctuation">]</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>cellValue<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> button1_Click<span class="token punctuation">(</span>sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>EventArgs<span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> cm <span class="token keyword">As</span> CurrencyManager <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">.</span>BindingContext<span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">)</span><span class="token punctuation">,</span> CurrencyManager<span class="token punctuation">)</span>

    <span class="token keyword">Dim</span> rowCount <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token operator">=</span> cm<span class="token punctuation">.</span>Count
    <span class="token comment">&#39;assumes datasource is a datatable...</span>
    <span class="token keyword">Dim</span> colCount <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> DataTable<span class="token punctuation">)</span><span class="token punctuation">.</span>Columns<span class="token punctuation">.</span>Count

    <span class="token keyword">Dim</span> row <span class="token keyword">As</span> <span class="token keyword">Integer</span>
    <span class="token keyword">For</span> row <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> rowCount <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token keyword">Dim</span> col <span class="token keyword">As</span> <span class="token keyword">Integer</span>
        <span class="token keyword">For</span> col <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> colCount <span class="token operator">-</span> <span class="token number">1</span>
            <span class="token keyword">Dim</span> cellValue <span class="token keyword">As</span> <span class="token keyword">Object</span> <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">)</span>
            Console<span class="token punctuation">.</span>Write<span class="token punctuation">(</span><span class="token punctuation">(</span>cellValue<span class="token punctuation">.</span>ToString<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">Next</span> col 
        Console<span class="token punctuation">.</span>WriteLine<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> 
    <span class="token keyword">Next</span> row 
<span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;button1_Click</span>
</code></pre></div><h3 id="_5-60-how-can-i-specially-color-only-the-currentcell-of-my-readonly-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-60-how-can-i-specially-color-only-the-currentcell-of-my-readonly-datagrid" aria-hidden="true">#</a> 5.60 How can I specially color only the currentcell of my readonly datagrid?</h3><p>You can use the first technique listed in this FAQ: How do I color an individual cell depending upon its value or some external method?</p><p>The idea is to derive a custom columnstyle. override its Paint method to specially color the background of the currentcell. Also, override the Edit to avoid the current cell becoming active. Below is a code snippet showing how you can do this. You can also download samples(C#, VB).</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Class</span> DataGridColoredTextBoxColumn
    <span class="token keyword">Inherits</span> DataGridTextBoxColumn

    <span class="token keyword">Private</span> column <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token comment">&#39; column where this columnstyle is located...</span>
    <span class="token keyword">Public</span> <span class="token keyword">Sub</span> <span class="token keyword">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        column <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span>

    <span class="token keyword">Protected</span> <span class="token keyword">Overloads</span> <span class="token keyword">Overrides</span> <span class="token keyword">Sub</span> Paint<span class="token punctuation">(</span><span class="token keyword">ByVal</span> g <span class="token keyword">As</span> Graphics<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> bounds <span class="token keyword">As</span> Rectangle<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> source <span class="token keyword">As</span> CurrencyManager<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> rowNum <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> backBrush <span class="token keyword">As</span> Brush<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> foreBrush <span class="token keyword">As</span> Brush<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> alignToRight <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">)</span>
        <span class="token keyword">Try</span>
            <span class="token keyword">Dim</span> grid <span class="token keyword">As</span> DataGrid <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>DataGridTableStyle<span class="token punctuation">.</span>DataGrid

            <span class="token comment">&#39;first time set the column properly </span>
            <span class="token keyword">If</span> column <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token keyword">Then</span>
                <span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
                i <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>DataGridTableStyle<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">.</span>IndexOf<span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">)</span>
                <span class="token keyword">If</span> i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">Then</span>
                        column <span class="token operator">=</span> i
                <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>

            <span class="token keyword">If</span> grid<span class="token punctuation">.</span>CurrentRowIndex <span class="token operator">=</span> rowNum <span class="token keyword">And</span> grid<span class="token punctuation">.</span>CurrentCell<span class="token punctuation">.</span>ColumnNumber <span class="token operator">=</span> column <span class="token keyword">Then</span>
                backBrush <span class="token operator">=</span> <span class="token keyword">New</span> LinearGradientBrush<span class="token punctuation">(</span>bounds<span class="token punctuation">,</span> Color<span class="token punctuation">.</span>FromArgb<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Color<span class="token punctuation">.</span>FromArgb<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> LinearGradientMode<span class="token punctuation">.</span>BackwardDiagonal<span class="token punctuation">)</span>
                foreBrush <span class="token operator">=</span> <span class="token keyword">New</span> SolidBrush<span class="token punctuation">(</span>Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Catch</span> ex <span class="token keyword">As</span> Exception
            <span class="token comment">&#39; empty catch</span>
        <span class="token keyword">Finally</span>
            <span class="token comment">&#39; make sure the base class gets called to do the drawing with</span>
            <span class="token comment">&#39; the possibly changed brushes</span>
            <span class="token keyword">MyBase</span><span class="token punctuation">.</span>Paint<span class="token punctuation">(</span>g<span class="token punctuation">,</span> bounds<span class="token punctuation">,</span> source<span class="token punctuation">,</span> rowNum<span class="token punctuation">,</span> backBrush<span class="token punctuation">,</span> foreBrush<span class="token punctuation">,</span> alignToRight<span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">Try</span>

    <span class="token keyword">End</span> <span class="token keyword">Sub</span>

    <span class="token keyword">Protected</span> <span class="token keyword">Overloads</span> <span class="token keyword">Overrides</span> <span class="token keyword">Sub</span> Edit<span class="token punctuation">(</span><span class="token keyword">ByVal</span> source <span class="token keyword">As</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>CurrencyManager<span class="token punctuation">,</span> <span class="token keyword">ByVal</span> rowNum <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> bounds <span class="token keyword">As</span> System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Rectangle<span class="token punctuation">,</span> <span class="token keyword">ByVal</span>[<span class="token keyword">readOnly</span>] <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> instantText <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> cellIsVisible <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">)</span>
        <span class="token comment">&#39;do nothiing... don&#39;t call the basecalss</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">End</span> <span class="token keyword">Class</span>
</code></pre></div><h3 id="_5-61-how-can-i-make-the-enter-key-behave-like-the-tab-key-and-move-to-the-next-cell" tabindex="-1"><a class="header-anchor" href="#_5-61-how-can-i-make-the-enter-key-behave-like-the-tab-key-and-move-to-the-next-cell" aria-hidden="true">#</a> 5.61 How can I make the Enter Key behave like the Tab Key and move to the next cell?</h3><p>You can override ProcessCmdKey, catch the Enter Key, and swap it for a Tab key by sending a Tab, and not processing the Enter Key.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDataGrid</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGrid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ProcessCmdKey</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Keys</span> keyData<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>WParam<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>Keys<span class="token punctuation">.</span>Enter<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            SendKeys<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">&quot;{Tab}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">ProcessCmdKey</span><span class="token punctuation">(</span><span class="token keyword">ref</span> msg<span class="token punctuation">,</span> keyData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Public</span> <span class="token keyword">Class</span> MyDataGrid
    <span class="token keyword">Inherits</span> DataGrid

    <span class="token keyword">Protected</span> <span class="token keyword">Overrides</span> <span class="token keyword">Function</span> ProcessCmdKey<span class="token punctuation">(</span><span class="token keyword">ByRef</span> msg <span class="token keyword">As</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> keyData <span class="token keyword">As</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Keys<span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Boolean</span>
        <span class="token keyword">If</span> msg<span class="token punctuation">.</span>WParam<span class="token punctuation">.</span>ToInt32<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">CInt</span><span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>Enter<span class="token punctuation">)</span> <span class="token keyword">Then</span>
            SendKeys<span class="token punctuation">.</span>Send<span class="token punctuation">(</span><span class="token string">&quot;{Tab}&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">Return</span> <span class="token boolean">True</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Return</span> <span class="token keyword">MyBase</span><span class="token punctuation">.</span>ProcessCmdKey<span class="token punctuation">(</span>msg<span class="token punctuation">,</span> keyData<span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">Function</span> <span class="token comment">&#39;ProcessCmdKey</span>

<span class="token keyword">End</span> <span class="token keyword">Class</span> <span class="token comment">&#39;MyDataGrid</span>
</code></pre></div><h3 id="_5-62-how-do-i-use-the-datacolumn-expression-property-to-add-a-computed-combined-column-to-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-62-how-do-i-use-the-datacolumn-expression-property-to-add-a-computed-combined-column-to-my-datagrid" aria-hidden="true">#</a> 5.62 How do I use the DataColumn.Expression property to add a computed/combined column to my datagrid?</h3><p>The idea is to load your datatable in a normal fashion. Once the datatable is loaded, you can add an additional column that is computed from the other columns in your datatable. In the sample(CS, VB), we load the CustomerID, CompanyName, ContactName and ContactTitle from the Customers table in the NorthWind database. We then add an additional column that concatenates the ContactName and ContactTitle into one column.</p><p>To add the additional column, we create a DataColumn, set a mapping name, and then use the Expression property to define how the column is to be computed.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token class-name">DataColumn</span> dc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Contact&quot;</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">string</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dc<span class="token punctuation">.</span>Expression <span class="token operator">=</span> <span class="token string">&quot;ContactName + &#39;:&#39; +ContactTitle&quot;</span><span class="token punctuation">;</span>
_dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Columns<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Dim</span> dc <span class="token keyword">As</span> DataColumn
dc <span class="token operator">=</span> <span class="token keyword">New</span> DataColumn<span class="token punctuation">(</span><span class="token string">&quot;Contact&quot;</span><span class="token punctuation">,</span> <span class="token keyword">GetType</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token keyword">String</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
dc<span class="token punctuation">.</span>Expression <span class="token operator">=</span> <span class="token string">&quot;ContactName + &#39;:&#39; +ContactTitle&quot;</span>
_dataSet<span class="token punctuation">.</span>Tables<span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Columns<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>dc<span class="token punctuation">)</span>
</code></pre></div><p>The sample actually shows two datagrids. The first one uses the default binding to display the entire table including our added column. In the second datagrid, we add a custom DataGridTableStyle to only display the CustomerID, CompanyName and our added column.</p><h3 id="_5-63-how-can-i-change-the-font-used-in-a-grid-cell-on-a-cell-by-cell-or-row-by-row-basis" tabindex="-1"><a class="header-anchor" href="#_5-63-how-can-i-change-the-font-used-in-a-grid-cell-on-a-cell-by-cell-or-row-by-row-basis" aria-hidden="true">#</a> 5.63 How can I change the font used in a grid cell on a cell by cell or row by row basis?</h3><p>One way to do this is to use a derived columnstyle, override the Paint method and do the text drawing yourself, using whatever font or colors you like. If you add an event to your derived column style that is fired immediately before the text is drawn, and use the event args to get the font and color information, you can let the event handler completely determine the look of any cell.</p><p>The attached samples (C#, VB) use this technique to create a grid that looks like the grid in the picture. Both color and font varies on a cell basis or row basis in this picture.</p><p><img src="`+i+`" alt="dg39_2"></p><h3 id="_5-64-how-can-i-use-a-mouse-to-select-cell-ranges-in-my-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-64-how-can-i-use-a-mouse-to-select-cell-ranges-in-my-datagrid" aria-hidden="true">#</a> 5.64 How can I use a mouse to select cell ranges in my datagrid?</h3><p>The Windows Forms DataGrid does not support the selection of a range of cells other than a group of rows. To select a row, you can click on its row header. But if you want to select a rectangular group of cells, you cannot.</p><p>To add this support, you can catch the mousedown on a cell, and in mousemove, track whether the mouse is dragged with the button down to other cells. If so, draw a selection rectangle over this group of cells. The attached samples (C#, VB) show how this might be done. The drawing of the selection rectangle is done in an OnPaint override. The samples also try to handle autoscrolling as you hit a grid border so the selection process can continue for cells that are not currently visible. To make the selection rectangle look nicer, the code also hides the current cell when it draws a selection rectangle.</p><p>The samples have a derived DataGrid that has a public member, SelectedRange, that holds the TopLeft and BottomRight coordinates of the selected range. The derived grid also has a public event, SelectionChanging, that fires prior to the selection changing as you drag your mouse. The event passes both the old selection and the new selection, and allows you to cancel the action if you choose.</p><h3 id="_5-65-how-do-i-determine-the-datagridtablestyle-mappingname-that-should-used-for-a-datagrid-to-make-sure-the-grid-uses-my-tablestyle" tabindex="-1"><a class="header-anchor" href="#_5-65-how-do-i-determine-the-datagridtablestyle-mappingname-that-should-used-for-a-datagrid-to-make-sure-the-grid-uses-my-tablestyle" aria-hidden="true">#</a> 5.65 How do I determine the DataGridTableStyle MappingName that should used for a DataGrid to make sure the grid uses my tablestyle?</h3><p>The DataGrid looks for a DataGridTableStyle.MappingName that is the type name of its datasource. So, depending upon what datasource you are using, this may be &quot;ArrayList&quot; for a ArrayList, &quot;MyCollection[]&quot; for an array of MyCollection objects, or &quot;MyTableName&quot; for a datatable, or whatever.</p><p>Here is a code snippet provide by NoiseEHC on the microsoft.public.dotnet.framework.windowsforms.controls newsgroup that you can use to see exactly what mappingname is required for your datasource.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token comment">//usage </span>
<span class="token function">ShowMappingName</span><span class="token punctuation">(</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//implementation </span>
<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowMappingName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> src<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">IList</span> list <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Type</span> type <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>src <span class="token keyword">is</span> <span class="token class-name">Array</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        type <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list <span class="token operator">=</span> src <span class="token keyword">as</span> <span class="token class-name">IList</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>src <span class="token keyword">is</span> <span class="token class-name">IListSource</span><span class="token punctuation">)</span>
            src <span class="token operator">=</span> <span class="token punctuation">(</span>src <span class="token keyword">as</span> <span class="token class-name">IListSource</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>src <span class="token keyword">is</span> <span class="token class-name">IList</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            type <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list <span class="token operator">=</span> src <span class="token keyword">as</span> <span class="token class-name">IList</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token keyword">is</span> <span class="token class-name">ITypedList</span><span class="token punctuation">)</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">(</span>list <span class="token keyword">as</span> <span class="token class-name">ITypedList</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetListName</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> ShowMappingName<span class="token punctuation">(</span><span class="token keyword">ByVal</span> src <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> list <span class="token keyword">As</span> IList <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token keyword">Dim</span> t <span class="token keyword">As</span> <span class="token keyword">Type</span> <span class="token operator">=</span> <span class="token boolean">Nothing</span>

    <span class="token keyword">If</span> <span class="token keyword">TypeOf</span> <span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token keyword">Is</span> Array <span class="token keyword">Then</span>
        t <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token keyword">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        list <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> IList<span class="token punctuation">)</span>
    <span class="token keyword">Else</span>
        <span class="token keyword">If</span> <span class="token keyword">TypeOf</span> src <span class="token keyword">Is</span> IListSource <span class="token keyword">Then</span>
            src <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> IListSource<span class="token punctuation">)</span><span class="token punctuation">.</span>GetList<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">If</span> <span class="token keyword">TypeOf</span> src <span class="token keyword">Is</span> IList <span class="token keyword">Then</span>
            t <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token keyword">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            list <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> IList<span class="token punctuation">)</span>
        <span class="token keyword">Else</span>
            MessageBox<span class="token punctuation">.</span>Show<span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">Return</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>

    <span class="token keyword">If</span> <span class="token keyword">TypeOf</span> list <span class="token keyword">Is</span> ITypedList <span class="token keyword">Then</span>
        MessageBox<span class="token punctuation">.</span>Show<span class="token punctuation">(</span><span class="token keyword">CType</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> ITypedList<span class="token punctuation">)</span><span class="token punctuation">.</span>GetListName<span class="token punctuation">(</span><span class="token boolean">Nothing</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">Else</span>
        MessageBox<span class="token punctuation">.</span>Show<span class="token punctuation">(</span>t<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre></div><h3 id="_5-66-i-have-a-derived-datagridcolumnstyle-from-within-my-paint-override-how-can-i-get-at-other-values-in-the-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-66-i-have-a-derived-datagridcolumnstyle-from-within-my-paint-override-how-can-i-get-at-other-values-in-the-datagrid" aria-hidden="true">#</a> 5.66 I have a derived DataGridColumnStyle. From within my Paint override, how can I get at other values in the DataGrid?</h3><p>You can get a referernce to the DataGrid with code such as:</p><p><code>Dim grid As DataGrid = Me.DataGridTableStyle.DataGrid</code></p><p>Once you have the grid, you can use an indexer to get the value of any particular column on the same row.</p><p><code>Dim someValue as Object = grid(rowNum, 5) &#39; value in column 5....</code></p><h3 id="_5-67-how-do-i-retrieve-the-current-row-from-a-datatable-bound-to-a-datagrid-after-the-grid-has-been-sorted" tabindex="-1"><a class="header-anchor" href="#_5-67-how-do-i-retrieve-the-current-row-from-a-datatable-bound-to-a-datagrid-after-the-grid-has-been-sorted" aria-hidden="true">#</a> 5.67 How do I retrieve the current row from a DataTable bound to a DataGrid after the grid has been sorted?</h3><p>In an unsorted DataGrid bound to a DataTable, you can get a reference to a row in the DataTable through the DataGrid.CurrentRowIndex.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token class-name">DataTable</span> dt <span class="token operator">=</span> <span class="token punctuation">(</span>DataTable<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">;</span>
<span class="token class-name">DataRow</span> dr <span class="token operator">=</span> dt<span class="token punctuation">.</span>Rows<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>CurrentRowIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Dim</span> dt <span class="token keyword">As</span> DataTable <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>DataGrid1<span class="token punctuation">.</span>DataSource
<span class="token keyword">Dim</span> dr <span class="token keyword">as</span> DataRow <span class="token operator">=</span> dt<span class="token punctuation">.</span>Rows<span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">.</span>DataGrid1<span class="token punctuation">.</span>CurrentRowIndex<span class="token punctuation">)</span>
</code></pre></div><p>But if the grid has been sorted, you can no longer get at the current row in the table through the grid&#39;s CurrentRowIndex. But for both unsorted and sorted grids, you can get at the current row through the BindingContext and the Current property of the BindingManagerBase.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token class-name">BindingManagerBase</span> bm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>BindingContextr<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataMember<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name">DataRow</span> dr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DataRowView<span class="token punctuation">)</span>bm<span class="token punctuation">.</span>Current<span class="token punctuation">)</span><span class="token punctuation">.</span>Row<span class="token punctuation">;</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Dim</span> bm <span class="token keyword">As</span> BindingManagerBase <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>DataGrid1<span class="token punctuation">.</span>BindingContext<span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">.</span>DataGrid1<span class="token punctuation">.</span>DataSource<span class="token punctuation">,</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>DataGrid1<span class="token punctuation">.</span>DataMember<span class="token punctuation">)</span>
<span class="token keyword">Dim</span> dr <span class="token keyword">As</span> DataRow <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>bm<span class="token punctuation">.</span>Current<span class="token punctuation">,</span> DataRowView<span class="token punctuation">)</span><span class="token punctuation">.</span>Row
</code></pre></div><h3 id="_5-68-how-can-i-catch-when-the-user-clicks-off-the-grid-say-to-close-the-form" tabindex="-1"><a class="header-anchor" href="#_5-68-how-can-i-catch-when-the-user-clicks-off-the-grid-say-to-close-the-form" aria-hidden="true">#</a> 5.68 How can I catch when the user clicks off the grid, say to close the form?</h3><p>You can catch clicking off a DataGrid in the DataGrid.Validated event. But this event is also hit when you use the Tab key to move around the grid. So, if you want to catch it exclusively for clicking off the grid, you have to ignore the event due to the tab. One way to do this is to derive DataGrid and override ProcessDialogKey, noting whether the key is a tab before processing it. Then in your Validated event handler, you can check for this tab. Here are some snippets.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token comment">//the handler that checks the derived grid&#39;s field inTabKey </span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dataGrid1_Validated</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>inTabKey<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Clicked off grid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>inTabKey <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//derived class </span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDataGrid</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DataGrid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> inTabKey <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ProcessDialogKey</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Keys</span> keyData<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        inTabKey <span class="token operator">=</span> keyData <span class="token operator">==</span> Keys<span class="token punctuation">.</span>Tab<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">ProcessDialogKey</span><span class="token punctuation">(</span>keyData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token comment">&#39;the handler that checks the derived grid&#39;s field inTabKey</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> dataGrid1_Validated<span class="token punctuation">(</span>sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> e <span class="token keyword">As</span> System<span class="token punctuation">.</span>EventArgs<span class="token punctuation">)</span>
    <span class="token keyword">If</span> <span class="token keyword">Not</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>inTabKey <span class="token keyword">Then</span>
        Console<span class="token punctuation">.</span>WriteLine<span class="token punctuation">(</span><span class="token string">&quot;Clicked off grid&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">Else</span>
        <span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>inTabKey <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;dataGrid1_Validated</span>

<span class="token comment">&#39;derived class</span>
<span class="token keyword">Public</span> <span class="token keyword">Class</span> MyDataGrid
    <span class="token keyword">Inherits</span> DataGrid

    <span class="token keyword">Public</span> inTabKey <span class="token keyword">As</span> <span class="token keyword">Boolean</span> <span class="token operator">=</span> <span class="token boolean">False</span>

    <span class="token keyword">Protected</span> <span class="token keyword">Overrides</span> <span class="token keyword">Function</span> ProcessDialogKey<span class="token punctuation">(</span>keyData <span class="token keyword">As</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Keys<span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Boolean</span>
        nTabKey <span class="token operator">=</span> keyData <span class="token operator">=</span> Keys<span class="token punctuation">.</span>Tab
        <span class="token keyword">Return</span> <span class="token keyword">MyBase</span><span class="token punctuation">.</span>ProcessDialogKey<span class="token punctuation">(</span>keyData<span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">Function</span> <span class="token comment">&#39;ProcessDialogKey</span>
<span class="token keyword">End</span> <span class="token keyword">Class</span> <span class="token comment">&#39;MyDataGrid</span>
</code></pre></div><h3 id="_5-69-how-can-i-get-a-checkbox-column-in-a-datagrid-to-react-to-the-first-click" tabindex="-1"><a class="header-anchor" href="#_5-69-how-can-i-get-a-checkbox-column-in-a-datagrid-to-react-to-the-first-click" aria-hidden="true">#</a> 5.69 How can I get a CheckBox column in a DataGrid to react to the first click?</h3><p>When you first click into a checkbox column, the checked state of the cell does not change. One way you can make the checked state change on the first click is to handle the grid&#39;s MouseUp event, and change the check value there.</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.Net]</span>
<span class="token keyword">Private</span> myCheckBoxCol <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token operator">=</span> <span class="token number">9</span> <span class="token comment">&#39;my checkbox column</span>
    <span class="token keyword">Private</span> <span class="token keyword">Sub</span> DataGrid2_MouseUp<span class="token punctuation">(</span><span class="token keyword">ByVal</span> sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> e <span class="token keyword">As</span> MouseEventArgs<span class="token punctuation">)</span> <span class="token keyword">Handles</span> DataGrid2<span class="token punctuation">.</span>MouseUp
        <span class="token keyword">Dim</span> hti <span class="token keyword">As</span> DataGrid<span class="token punctuation">.</span>HitTestInfo <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">.</span>HitTest<span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>
        <span class="token keyword">Try</span>
            <span class="token keyword">If</span> hti<span class="token punctuation">.</span><span class="token keyword">Type</span> <span class="token operator">=</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>Cell <span class="token keyword">AndAlso</span> hti<span class="token punctuation">.</span>Column <span class="token operator">=</span> myCheckBoxCol <span class="token keyword">Then</span>
                <span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">Not</span> <span class="token keyword">CBool</span><span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Catch</span> ex <span class="token keyword">As</span> Exception
            MessageBox<span class="token punctuation">.</span>Show<span class="token punctuation">(</span>ex<span class="token punctuation">.</span>ToString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">Try</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;dataGrid2_MouseUp</span>
</code></pre></div><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> myCheckBoxCol <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token comment">//my checkbox column</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dataGrid2_MouseUp</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>MouseEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DataGrid<span class="token punctuation">.</span>HitTestInfo</span> hti <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">.</span><span class="token function">HitTest</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>X<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hti<span class="token punctuation">.</span>Type <span class="token operator">==</span> DataGrid<span class="token punctuation">.</span>HitTestType<span class="token punctuation">.</span>Cell <span class="token operator">&amp;&amp;</span> hti<span class="token punctuation">.</span>Column <span class="token operator">==</span> myCheckBoxCol<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">[</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">[</span>hti<span class="token punctuation">.</span>Row<span class="token punctuation">,</span> hti<span class="token punctuation">.</span>Column<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-70-how-can-i-use-events-to-restrict-key-input-to-grid-cells" tabindex="-1"><a class="header-anchor" href="#_5-70-how-can-i-use-events-to-restrict-key-input-to-grid-cells" aria-hidden="true">#</a> 5.70 How can I use events to restrict key input to grid cells?</h3><p>If you make sure your DataGrid is using a DataGridTableStyle, then you can access the TextBox through the GridColumnStyles collection and hook the event there. Here is some code....</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token comment">//in formload </span>
<span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSet11<span class="token punctuation">.</span>Customers<span class="token punctuation">;</span> <span class="token comment">// set the data source</span>

<span class="token comment">//make sure grid has a tablestyle</span>
<span class="token class-name">DataGridTableStyle</span> ts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGridTableStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ts<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataSet11<span class="token punctuation">.</span>Customers<span class="token punctuation">.</span>TableName<span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ts<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//now we can wire up wire up events for columns 1 and 4 .... </span>
<span class="token class-name">DataGridTextBoxColumn</span> tbc <span class="token operator">=</span> <span class="token punctuation">(</span>DataGridTextBoxColumn<span class="token punctuation">)</span>ts<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
tbc<span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>KeyPress <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">KeyPressEventHandler</span><span class="token punctuation">(</span>CellKeyPress<span class="token punctuation">)</span><span class="token punctuation">;</span>

tbc <span class="token operator">=</span> <span class="token punctuation">(</span>DataGridTextBoxColumn<span class="token punctuation">)</span>ts<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
tbc<span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>KeyPress <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">KeyPressEventHandler</span><span class="token punctuation">(</span>CellKeyPress<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token range operator">..</span><span class="token range operator">..</span><span class="token punctuation">.</span>

<span class="token comment">//the handler </span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CellKeyPress</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">KeyPressEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//don&#39;t allow 1&#39;s </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>KeyChar <span class="token operator">==</span> <span class="token char">&#39;1&#39;</span><span class="token punctuation">)</span>
        e<span class="token punctuation">.</span>Handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token comment">&#39;in formload </span>
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>dataSet11<span class="token punctuation">.</span>Customers <span class="token comment">&#39; set the data source</span>

<span class="token comment">&#39;make sure grid has a tablestyle</span>
<span class="token keyword">Dim</span> ts <span class="token keyword">As</span> <span class="token keyword">New</span> DataGridTableStyle<span class="token punctuation">(</span><span class="token punctuation">)</span>
ts<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>dataSet11<span class="token punctuation">.</span>Customers<span class="token punctuation">.</span>TableName
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>ts<span class="token punctuation">)</span>

<span class="token comment">&#39;now we can wire up wire up events for columns 1 and 4 ....</span>
<span class="token keyword">Dim</span> tbc <span class="token keyword">as</span> DataGridTextBoxColumn <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>ts<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DataGridTextBoxColumn<span class="token punctuation">)</span>
<span class="token keyword">AddHandler</span> tbc<span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>KeyPress<span class="token punctuation">,</span> <span class="token keyword">AddressOf</span> CellKeyPress

tbc <span class="token operator">=</span> <span class="token keyword">CType</span><span class="token punctuation">(</span>ts<span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DataGridTextBoxColumn<span class="token punctuation">)</span>
<span class="token keyword">AddHandler</span> tbc<span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span>KeyPress<span class="token punctuation">,</span> <span class="token keyword">AddressOf</span> CellKeyPress
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 

<span class="token comment">&#39;the handler </span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> CellKeyPress<span class="token punctuation">(</span>sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> e <span class="token keyword">As</span> KeyPressEventArgs<span class="token punctuation">)</span>
    <span class="token comment">&#39;don&#39;t allow 1&#39;s</span>
    <span class="token keyword">If</span> e<span class="token punctuation">.</span>KeyChar <span class="token operator">=</span> <span class="token string">&quot;1&quot;c</span> <span class="token keyword">Then</span>
        e<span class="token punctuation">.</span>Handled <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;CellKeyPress</span>
</code></pre></div><h3 id="_5-71-how-can-i-format-columns-in-my-datagrid-without-explicilty-adding-datagridcolumnstyles" tabindex="-1"><a class="header-anchor" href="#_5-71-how-can-i-format-columns-in-my-datagrid-without-explicilty-adding-datagridcolumnstyles" aria-hidden="true">#</a> 5.71 How can I format columns in my DataGrid without explicilty adding DataGridColumnStyles?</h3><p>To format column output, you do not have to explicitly add DataGridColumns for each column provided you do add a DataGridTableStyle to your DataGrid prior to setting the DataSource property. When you set the DataSource property with a DataGrid that has a tablestyle with an empty columnstyle collection, the framework generates default columnstyle objects for each column in the datasource. You can then access these columnstyles directly and set properties in them such as Format, HeaderText and Width.</p><p>Download working samples here (VB.NET, C#).</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Dim</span> dataTableName <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> <span class="token string">&quot;theTable&quot;</span>

<span class="token comment">&#39;add a tablestyle to the grid so there will be custom columnstyles available</span>
<span class="token comment">&#39; after the datasource has been set....</span>
<span class="token keyword">Dim</span> ts <span class="token keyword">As</span> <span class="token keyword">New</span> DataGridTableStyle<span class="token punctuation">(</span><span class="token punctuation">)</span>
ts<span class="token punctuation">.</span>MappingName <span class="token operator">=</span> dataTableName

<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>ts<span class="token punctuation">)</span>
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> GetTheTable<span class="token punctuation">(</span>dataTableName<span class="token punctuation">)</span>

<span class="token comment">&#39;now default customcolumnstyles have been created, so we can use them to set properties</span>
<span class="token keyword">Dim</span> dgtbc <span class="token keyword">As</span> DataGridTextBoxColumn

<span class="token comment">&#39;format the int</span>
dgtbc <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">If</span> <span class="token keyword">Not</span><span class="token punctuation">(</span>dgtbc <span class="token keyword">Is</span> <span class="token boolean">Nothing</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
     dgtbc<span class="token punctuation">.</span>Format <span class="token operator">=</span> <span class="token string">&quot;n0&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">If</span>

<span class="token comment">&#39;format the double</span>
dgtbc <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">&#39;</span>
<span class="token keyword">If</span> <span class="token keyword">Not</span><span class="token punctuation">(</span>dgtbc <span class="token keyword">Is</span> <span class="token boolean">Nothing</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
     dgtbc<span class="token punctuation">.</span>Format <span class="token operator">=</span> <span class="token string">&quot;f3&quot;</span> <span class="token comment">&#39; 0r &quot;#.000&quot;;</span>
<span class="token keyword">End</span> <span class="token keyword">If</span>

<span class="token comment">&#39;format the double as currency</span>
dgtbc <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">&#39;</span>
<span class="token keyword">If</span> <span class="token keyword">Not</span><span class="token punctuation">(</span>dgtbc <span class="token keyword">Is</span> <span class="token boolean">Nothing</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
     dgtbc<span class="token punctuation">.</span>Format <span class="token operator">=</span> <span class="token string">&quot;c4&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">If</span>

<span class="token comment">&#39;format the date</span>
dgtbc <span class="token operator">=</span> dataGrid1<span class="token punctuation">.</span>TableStyles<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>GridColumnStyles<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">&#39;</span>
<span class="token keyword">If</span> <span class="token keyword">Not</span><span class="token punctuation">(</span>dgtbc <span class="token keyword">Is</span> <span class="token boolean">Nothing</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
     dgtbc<span class="token punctuation">.</span>Format <span class="token operator">=</span> <span class="token string">&quot;d&quot;</span> <span class="token comment">&#39; or &quot;g&quot; or &quot;u&quot; or whatever format you want to see</span>
     dgtbc<span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token number">100</span> <span class="token comment">&#39;size it</span>
<span class="token keyword">End</span> <span class="token keyword">If</span>
</code></pre></div><h3 id="_5-72-how-can-i-auto-adjust-keyboard-input-for-example-make-typing-12312002-be-taken-as-a-valid-date-12-31-2002" tabindex="-1"><a class="header-anchor" href="#_5-72-how-can-i-auto-adjust-keyboard-input-for-example-make-typing-12312002-be-taken-as-a-valid-date-12-31-2002" aria-hidden="true">#</a> 5.72 How can I auto-adjust keyboard input? For example, make typing 12312002 be taken as a valid date, 12/31/2002</h3><p>One possible solution is that as you move off the cell, you get the typed value, and modify it before it is passed onto the DataGrid for its standard processing.</p><p>One problem is that there are several ways to leave the cell, and you would want to handle each (depending upon your needs). You can leave the cell by clicking on another cell, by tabbing off the cell, by arrowing off the cell, and by pressing Enter on an edited cell.</p><p>Another problem is that you want to catch these actions early enough to make a change in the typed value that can be passed onto the DataGrid itself. To catch the typed entries before they are handed off to the DataGrid, you have to gain access to the DataGridTextBoxColumn&#39;s embedded TextBox. This requires that your DataGrid either has explicitly had these columns styles added to it, or that you miminally add a DataGridTableStyle to your DataGrid so the Framework generates ColumnsStyle objects for you.</p><p>To solve these problems, you can derive the dataGrid and override OnMouseDown, OnProcessDialogKey, and OnProcessPreviewKey. The last override will handle both the arrowing off the cell and pressing Enter on an edited cell.</p><p>You can download a sample (C#, VB.NET) that implements this technique.</p><h3 id="_5-73-can-i-display-the-rows-in-my-datagrid-in-a-free-form-layout-using-textboxes-on-a-panel" tabindex="-1"><a class="header-anchor" href="#_5-73-can-i-display-the-rows-in-my-datagrid-in-a-free-form-layout-using-textboxes-on-a-panel" aria-hidden="true">#</a> 5.73 Can I display the rows in my datagrid in a free-form layout using textboxes on a panel?</h3><p>Here is a VB and C# sample showing how you might do this.</p><p>The idea is to add textboxes and lables to a panel with whatever layout you want to use.</p><p>Then use DataBindings.Add calls to bind the textboxes to columns in your grid (actually in your grid&#39;s datasource). Then, since the grid and the textboxes share the same BindingContext, you can move the BindingManagerBase.Position property to scroll through the rows in your grid, and the textboxes will remain in sync. You can hide the grid just to show the textboxes if you do not want the grid to have a presence. Also, any edits in the textboxes will appear in the DataGrid and vice versa.</p><h3 id="_5-74-how-can-i-tell-whether-a-scrollbar-is-visible-in-my-datagrid-is-visible" tabindex="-1"><a class="header-anchor" href="#_5-74-how-can-i-tell-whether-a-scrollbar-is-visible-in-my-datagrid-is-visible" aria-hidden="true">#</a> 5.74 How can I tell whether a scrollbar is visible in my DataGrid is visible?</h3><p>If you are using a derived DataGrid, then you can check the Visible property on the protected VertScrollBar property of DataGrid. So, you could check Me.VertScrollBar.Visible from within your derived DataGrid.</p><p>To check it without access to the protected scrollbar properties is a little more work, but possible. One techigue is to loop through the Controls property of the DataGrid looking for the scrollbar, and then checking its visible property at that time.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token comment">//sample usage </span>
<span class="token class-name"><span class="token keyword">bool</span></span> vSrollBarVisible <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">IsScrollBarVisible</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token range operator">..</span><span class="token range operator">..</span><span class="token punctuation">.</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsScrollBarVisible</span><span class="token punctuation">(</span><span class="token class-name">Control</span> aControl<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Control</span> c <span class="token keyword">in</span> aControl<span class="token punctuation">.</span>Controls<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">VScrollBar</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> c<span class="token punctuation">.</span>Visible<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token comment">&#39;sample usage</span>
<span class="token keyword">Dim</span> vScrollBarVisible <span class="token operator">=</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>IsScrollBarVisible<span class="token punctuation">(</span><span class="token keyword">Me</span><span class="token punctuation">.</span>DataGrid1<span class="token punctuation">)</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">Private</span> <span class="token keyword">Function</span> IsScrollBarVisible<span class="token punctuation">(</span><span class="token keyword">ByVal</span> aControl <span class="token keyword">As</span> Control<span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Boolean</span>
    <span class="token keyword">Dim</span> c <span class="token keyword">As</span> Control
    <span class="token keyword">For</span> <span class="token keyword">Each</span> c <span class="token keyword">In</span> aControl<span class="token punctuation">.</span>Controls
        <span class="token keyword">If</span> c<span class="token punctuation">.</span><span class="token keyword">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">Is</span> <span class="token keyword">GetType</span><span class="token punctuation">(</span>VScrollBar<span class="token punctuation">)</span> <span class="token keyword">Then</span>
            <span class="token keyword">Return</span> c<span class="token punctuation">.</span>Visible
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Next</span>
    <span class="token keyword">Return</span> <span class="token boolean">False</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>
</code></pre></div><h3 id="_5-75-how-do-i-autosize-the-columns-in-my-datagrid-so-they-always-fill-the-the-grid-s-client-area" tabindex="-1"><a class="header-anchor" href="#_5-75-how-do-i-autosize-the-columns-in-my-datagrid-so-they-always-fill-the-the-grid-s-client-area" aria-hidden="true">#</a> 5.75 How do I autosize the columns in my DataGrid so they always fill the the grid&#39;s client area?</h3><p>If you add a DataGridTableStyle to your Datagrid, then you can use the ColWidth property of the GridColumnStyles to set the width of each column. To dynamically set these widths as the grid is resized, you can handle the SizeChanged event of the the DataGrid. In your handler, you can compute the width of each column by dividing the client width minus the width of the row header column by the number of columns. Now there are a couple of technical points. You have to adjust for a possible vertical scrollbar. And, you have to adjust things for possible integer rounding in the calculations. To handle this last problem, the attached samples (both VB and C#) apply the single computed width to all but the last column. And this last column is just given all the space left. This means the last column may differ in width from the other columns by a couple of pixels.</p><h3 id="_5-76-how-can-i-prevent-all-the-cells-in-my-datagrid-from-being-edited-without-deriving-gridcolumnstyle" tabindex="-1"><a class="header-anchor" href="#_5-76-how-can-i-prevent-all-the-cells-in-my-datagrid-from-being-edited-without-deriving-gridcolumnstyle" aria-hidden="true">#</a> 5.76 How can I prevent all the cells in my DataGrid from being edited without deriving GridColumnStyle?</h3><p>One solution is to remove all the editing controls from the DataGrid.Controls collection. Without these controls, the grid contents cannot be edited. There is a technical problem that requires a little care. You do not want to delete all the controls in DataGrid.Controls as you would lose your scrollbars.</p><p>The code below deletes all controls except the scrollbars. Alternativel, you could also loop through the controls and only delete the TextBox.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token class-name">ArrayList</span> al <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Control</span> c <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>Controls<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">VScrollBar</span><span class="token punctuation">)</span> <span class="token operator">||</span> c<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">HScrollBar</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        al<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Control<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>al<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Control</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Dim</span> al <span class="token keyword">As</span> <span class="token keyword">New</span> ArrayList<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token keyword">Dim</span> c <span class="token keyword">As</span> Control 
<span class="token keyword">For</span> <span class="token keyword">Each</span> c <span class="token keyword">In</span> <span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>Controls 
     <span class="token keyword">If</span> c<span class="token punctuation">.</span><span class="token keyword">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">GetType</span><span class="token punctuation">(</span>VScrollBar<span class="token punctuation">)</span> <span class="token keyword">Or</span> c<span class="token punctuation">.</span><span class="token keyword">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">GetType</span><span class="token punctuation">(</span>HScrollBar<span class="token punctuation">)</span> <span class="token keyword">Then</span>
          al<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
     <span class="token keyword">End</span> <span class="token keyword">If</span> 
<span class="token keyword">Next</span> c 
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Clear<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>AddRange<span class="token punctuation">(</span><span class="token keyword">CType</span><span class="token punctuation">(</span>al<span class="token punctuation">.</span>ToArray<span class="token punctuation">(</span><span class="token keyword">GetType</span><span class="token punctuation">(</span>Control<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Control<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-77-how-can-i-prevent-the-plus-minus-icon-that-appears-next-to-the-row-header-when-i-have-a-datagrid-displayed-bound-to-a-datasource-that-has-a-relation-defined" tabindex="-1"><a class="header-anchor" href="#_5-77-how-can-i-prevent-the-plus-minus-icon-that-appears-next-to-the-row-header-when-i-have-a-datagrid-displayed-bound-to-a-datasource-that-has-a-relation-defined" aria-hidden="true">#</a> 5.77 How can I prevent the plus-minus icon that appears next to the row header when I have a datagrid displayed bound to a datasource that has a relation defined?</h3><p>Set the <code>DataGrid.AllowNavigation</code> property to false.</p><h3 id="_5-78-how-can-i-display-master-details-details-in-three-separate-grids" tabindex="-1"><a class="header-anchor" href="#_5-78-how-can-i-display-master-details-details-in-three-separate-grids" aria-hidden="true">#</a> 5.78 How can I display master-details-details in three separate grids?</h3><p>Here is a sample (both VB and C#) that illustrates how to have a parent table whcih has a related child table, which also has a related grandchild table.</p><p>Below are some code snippets. The trick is to always make the main parent table be the DataSource for all the grid, and then set the DataMember to be the relation name where teh relation starts at the parent table. This means the DisplayMember for the Child table is &quot;ParentToChild&quot;, the name of that relation. And, the DisplayMember for the grandchild grid is &quot;ParentToChild.ChildToGrandChild&quot; whcih defines the relation starting at the parent grid through the child grid.</p><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token keyword">Dim</span> dSet <span class="token keyword">As</span> <span class="token keyword">New</span> DataSet<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">&#39;get the tables</span>
<span class="token keyword">Dim</span> parentTable <span class="token keyword">As</span> DataTable <span class="token operator">=</span> GetParentTable<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> childTable <span class="token keyword">As</span> DataTable <span class="token operator">=</span> GetChildTable<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> grandChildTable <span class="token keyword">As</span> DataTable <span class="token operator">=</span> GetGrandChildTable<span class="token punctuation">(</span><span class="token punctuation">)</span>
dSet<span class="token punctuation">.</span>Tables<span class="token punctuation">.</span>AddRange<span class="token punctuation">(</span><span class="token keyword">New</span> DataTable<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> parentTable<span class="token punctuation">,</span> childTable<span class="token punctuation">,</span> grandChildTable<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">&#39;setup the relations</span>
<span class="token keyword">Dim</span> parentColumn <span class="token keyword">As</span> DataColumn <span class="token operator">=</span> parentTable<span class="token punctuation">.</span>Columns<span class="token punctuation">(</span><span class="token string">&quot;parentID&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">Dim</span> childColumn <span class="token keyword">As</span> DataColumn <span class="token operator">=</span> childTable<span class="token punctuation">.</span>Columns<span class="token punctuation">(</span><span class="token string">&quot;ParentID&quot;</span><span class="token punctuation">)</span>
dSet<span class="token punctuation">.</span>Relations<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token string">&quot;ParentToChild&quot;</span><span class="token punctuation">,</span> parentColumn<span class="token punctuation">,</span> childColumn<span class="token punctuation">)</span>

parentColumn <span class="token operator">=</span> childTable<span class="token punctuation">.</span>Columns<span class="token punctuation">(</span><span class="token string">&quot;childID&quot;</span><span class="token punctuation">)</span>
childColumn <span class="token operator">=</span> grandChildTable<span class="token punctuation">.</span>Columns<span class="token punctuation">(</span><span class="token string">&quot;ChildID&quot;</span><span class="token punctuation">)</span>
dSet<span class="token punctuation">.</span>Relations<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token string">&quot;ChildToGrandChild&quot;</span><span class="token punctuation">,</span> parentColumn<span class="token punctuation">,</span> childColumn<span class="token punctuation">)</span>

<span class="token comment">&#39;set the grids</span>
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> parentTable

<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> parentTable
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">.</span>DataMember <span class="token operator">=</span> <span class="token string">&quot;ParentToChild&quot;</span>

<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid3<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> parentTable
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid3<span class="token punctuation">.</span>DataMember <span class="token operator">=</span> <span class="token string">&quot;ParentToChild.ChildToGrandChild&quot;</span>

<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid1<span class="token punctuation">.</span>AllowNavigation <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid2<span class="token punctuation">.</span>AllowNavigation <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token keyword">Me</span><span class="token punctuation">.</span>dataGrid3<span class="token punctuation">.</span>AllowNavigation <span class="token operator">=</span> <span class="token boolean">False</span>
</code></pre></div><h3 id="_5-79-in-my-datagrid-if-i-press-tab-to-enter-a-column-using-a-derived-columnstyle-the-column-does-not-receive-focus-why" tabindex="-1"><a class="header-anchor" href="#_5-79-in-my-datagrid-if-i-press-tab-to-enter-a-column-using-a-derived-columnstyle-the-column-does-not-receive-focus-why" aria-hidden="true">#</a> 5.79 In my datagrid, if I press tab to enter a column using a derived columnstyle, the column does not receive focus. Why?</h3><p>This behavior can be seen when you embedded a control like a textbox or combobox in your derived GridColumnStyle. If you press the tabkey slowly, you may see the cell get focus on the downkey and the cell lose focus on the upkey. One way to avoid this problem is to subclass the embedded control, and override its WndProc method, ignoring the KeyUp.</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// [C#]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCombo</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ComboBox</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> WM_KEYUP <span class="token operator">=</span> <span class="token number">0x101</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">WndProc</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Message</span> m<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span>Msg <span class="token operator">==</span> WM_KEYUP<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//ignore the keyup </span>
        <span class="token punctuation">}</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">WndProc</span><span class="token punctuation">(</span><span class="token keyword">ref</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vb" data-ext="vb"><pre class="language-vb"><code><span class="token comment">&#39; [VB.NET]</span>
<span class="token keyword">Public</span> <span class="token keyword">Class</span> MyTextBox
    <span class="token keyword">Inherits</span> TextBox
    <span class="token keyword">Private</span> WM_KEYUP <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token operator">=</span> <span class="token number">&amp;H101</span>

    <span class="token keyword">Protected</span> <span class="token keyword">Overrides</span> <span class="token keyword">Sub</span> WndProc<span class="token punctuation">(</span><span class="token keyword">ByRef</span> m <span class="token keyword">As</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Message<span class="token punctuation">)</span>
        <span class="token keyword">If</span> m<span class="token punctuation">.</span>Msg <span class="token operator">=</span> WM_KEYUP <span class="token keyword">Then</span>
            <span class="token keyword">Return</span> <span class="token comment">&#39;ignore the keyup</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">MyBase</span><span class="token punctuation">.</span>WndProc<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">Sub</span> <span class="token comment">&#39;WndProc</span>
<span class="token keyword">End</span> <span class="token keyword">Class</span> <span class="token comment">&#39;MyTextBox</span>
</code></pre></div><h3 id="_5-80-how-can-i-detect-when-a-cell-starts-being-edited-not-when-it-becomes-current" tabindex="-1"><a class="header-anchor" href="#_5-80-how-can-i-detect-when-a-cell-starts-being-edited-not-when-it-becomes-current" aria-hidden="true">#</a> 5.80 How can I detect when a cell starts being edited, not when it becomes current?</h3><p>You can use the CurrentCellChanged event to detect when the currentcell changes position. But this event will not allow you to catch the start of a cell being edited.</p><p>One way you can do this is to catch the TextChanged event in the embedded TextBox within the cell. If the text changes, then it might be the beginning of a cell edit provided the text in the TextBox differs from the stored value from the DataSource. The reason you need to check for a different value between the grid DataSource and the TextBox contents is that the TextChanged event is fired initially when the TextBox is initialized when the cell becomes current and moves the value from the grid ataSource to the TextBox. You also have to ignore subsequent hits of TextChanged as the same cell continues to be edited. Here is both a VB and C# sample that implements this strategy to flagged current cell start editing.</p><h3 id="_5-81-how-can-i-have-a-column-of-bitmaps-in-a-datagrid" tabindex="-1"><a class="header-anchor" href="#_5-81-how-can-i-have-a-column-of-bitmaps-in-a-datagrid" aria-hidden="true">#</a> 5.81 How can I have a column of bitmaps in a DataGrid?</h3><p>You can derive a custom columnstyle and override its Paint method to draw the image. Here are both C# and VB.Net samples.</p><p>The Paint override offers three ways to draw the bimap in the cell; size it to fit the cell bounds, size it proportionally to fit the cell bounds, and draw it with it&#39;s original size (clipping the bitmap to fit in the cell bounds). In the sample, the DataGrid is anchored on all four sides, so as you size the form, the DataGrid sizes as well. The dataGrid1_Resized event is handled to dynamically change the PreferredRowHeight and PreferredColumnWidth so the cells occupy all of the datagrid&#39;s client area. So, as you size the form, the grid cells size also so you can easily see the bitmaps.</p><h3 id="_5-82-how-can-i-add-my-custom-columnstyles-to-the-designer-so-i-can-use-them-in-my-datagrid-at-design-time" tabindex="-1"><a class="header-anchor" href="#_5-82-how-can-i-add-my-custom-columnstyles-to-the-designer-so-i-can-use-them-in-my-datagrid-at-design-time" aria-hidden="true">#</a> 5.82 How can I add my custom columnstyles to the designer so I can use them in my DataGrid at design time?</h3><p>To make your custom columnstyle accessible at design time requires deriving a CollectionEditor from System.ComponentModel.Design.CollectionEditor that will return an instance of your custom columnstyle. To make your datagrid use this editor, you need to derive a DataGridTableStyle where you hide(shadow in VB.NET) the baseclass GridColumnStyles collection with a new GridColumnStyle property that has an Editor attribute that points to your derived columnstyle collection editor. Also, in your derived tablestyle, you add a derived collection editor for your derived tablestyle. Finally, you do the same thing again by deriving DataGrid, hiding its TableStyle property with a new TableStyle property that has an Editor attribute that points to your derived tablestyle collection editor.</p>`,127),b={href:"http://www.syncfusion.com/faq/winforms/Files/DataGridColumnStyleDesigner.zip",target:"_blank",rel:"noopener noreferrer"};function f(v,C){const s=p("ExternalLinkIcon");return c(),l("div",null,[k,n("p",null,[n("a",d,[a("Complete Sample: simpledata.zip"),t(s)])]),h,n("p",null,[n("a",m,[a("simpledata2.zip"),t(s)])]),y,n("p",null,[a("Take a look at this Microsoft KB article, "),n("a",w,[a("HOW TO: Extend the Windows Form DataGridTextBoxColumn Control to Custom-Format Data (Q318581)"),t(s)]),a(". It subclasses a DataGridColumnStyle and overrides both GetColumnValueAtRow and Commit to implement this behavior.")]),g,n("p",null,[a("So in addition to your custom columnstyles, this task requires deriving DataGrid and DataTableStyle, as well as providing CollectionEditiors for GridColumnStyles and TableStyles properties. Here is "),n("a",b,[a("sample projects"),t(s)]),a(" in both VB.NET and C#. The sample custom columnstyledoes not allow an edit cursor to appear in a column.")])])}const D=e(r,[["render",f],["__file","dg39.html.vue"]]);export{D as default};
