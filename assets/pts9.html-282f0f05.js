import{_ as t,r as p,o,c as e,b as n,d as s,e as c,a as u}from"./app-57d1f7b1.js";const l={},i={id:"删除windows服务",tabindex:"-1"},k=n("a",{class:"header-anchor",href:"#删除windows服务","aria-hidden":"true"},"#",-1),r={href:"https://blog.csdn.net/i_like_cpp/article/details/209425",target:"_blank",rel:"noopener noreferrer"},d=u(`<p>对于编程高手来说，这个题目有点无聊，不过在某些情况下还是相当有用的。像我删除卸载了一个软件，结果什么都删除了，结果服务还在那儿，很不雅观，找遍注册表都找不到，只好自己动手写了个小程序来删除服务。</p><p>首先做好界面，如下：</p><p>这要用到Windows的服务管理函数组，首先要打开服务管理器，这要在头文件中包含<code>winsvc.h</code></p><p>把<code>SC_HANDLE sh；</code>定义加入对话框类中。</p><p>在<code>OnInitDialog</code>成员函数中加入如下代码，以初始化服务管理。</p><div class="language-cpp" data-ext="cpp"><pre class="language-cpp"><code>sh<span class="token operator">=</span><span class="token function">OpenSCManager</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>SERVICES_ACTIVE_DATABASE<span class="token punctuation">,</span>SC_MANAGER_ALL_ACCESS<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>sh<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token string">&quot;faile to Open SCManager&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>在OnClose成员函数中加入</p><p><code>CloseServiceHandle(sh);</code></p><p>然后处理两个按钮事件</p><div class="language-cpp" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token class-name">CdelsDlg</span><span class="token double-colon punctuation">::</span><span class="token function">ListServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO: Add your control notification handler code here</span>
    DWORD eh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> d1<span class="token punctuation">,</span> nret<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
    BOOL ret<span class="token punctuation">;</span>
    SCV<span class="token punctuation">.</span><span class="token function">ResetContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret <span class="token operator">=</span> <span class="token function">EnumServicesStatus</span><span class="token punctuation">(</span>sh<span class="token punctuation">,</span> SERVICE_WIN32 <span class="token operator">|</span> SERVICE_DRIVER<span class="token punctuation">,</span> SERVICE_INACTIVE<span class="token punctuation">,</span> ess<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>ess<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>d1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nret<span class="token punctuation">,</span> <span class="token operator">&amp;</span>eh<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ret<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">MessageBox</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token string">&quot;failed to enum services&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nret<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        SCV<span class="token punctuation">.</span><span class="token function">AddString</span><span class="token punctuation">(</span>ess<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lpDisplayName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">CdelsDlg</span><span class="token double-colon punctuation">::</span><span class="token function">DelService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO: Add your control notification handler code here</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> ret<span class="token punctuation">;</span>
    <span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> SCV<span class="token punctuation">.</span><span class="token function">GetCurSel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token string">&quot;Do you realy want to remove the service\\r\\n&quot;</span>  <span class="token string">&quot;%d:\\t%s\\r\\n%s&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> ess<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lpServiceName<span class="token punctuation">,</span> ess<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lpDisplayName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret <span class="token operator">=</span> <span class="token function">MessageBox</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token string">&quot;Alert!&quot;</span><span class="token punctuation">,</span> MB_YESNO <span class="token operator">|</span> MB_ICONWARNING <span class="token operator">|</span> MB_DEFBUTTON2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">==</span> IDYES<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        SC_HANDLE ds<span class="token punctuation">;</span>
        ds <span class="token operator">=</span> <span class="token function">OpenService</span><span class="token punctuation">(</span>sh<span class="token punctuation">,</span> ess<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lpServiceName<span class="token punctuation">,</span> SC_MANAGER_ALL_ACCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ds<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to Open Service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">DeleteService</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token string">&quot;Success to remove the service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token string">&quot;Failed to remove the service\\r\\nERROR CODE:\\t%d&quot;</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">MessageBox</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">CloseServiceHandle</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>前者枚举不活动的服务，并把它加入列表框，后者直接删除对应服务</p><p>发表于 2004年12月08日 5:15 PM</p><hr><p>回复：删除Windows服务 2004-12-08 11:06 PM Meteor</p><blockquote><p>windows 自带的有个程序<br><br> sc.exe<br><code>sc delete 服务名字</code><br><br> 而且2003下面是中文界面的了<br><br> 可以删除</p></blockquote>`,15);function f(_,m){const a=p("ExternalLinkIcon");return o(),e("div",null,[n("h1",i,[k,s(),n("a",r,[s("删除Windows服务"),c(a)])]),d])}const h=t(l,[["render",f],["__file","pts9.html.vue"]]);export{h as default};
