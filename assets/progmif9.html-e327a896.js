import{_ as o,r as p,o as e,c,b as n,d as s,e as t,a as u}from"./app-d9da1b6d.js";const i="/steven-blogs/assets/progmif9_1-3f816c1a.png",l="/steven-blogs/assets/progmif9_2-8c941b73.png",r="/steven-blogs/assets/progmif9_3-2e763e24.png",k="/steven-blogs/assets/progmif9_4-216b982e.png",_={},m={id:"在任务栏图标上显示自定义的右键菜单",tabindex:"-1"},d=n("a",{class:"header-anchor",href:"#在任务栏图标上显示自定义的右键菜单","aria-hidden":"true"},"#",-1),g={href:"http://www.cnblogs.com/ZDJ/archive/2005/02/03/101276.html",target:"_blank",rel:"noopener noreferrer"},f=u('<p>.Net Framework提供的NotifyIcon组件真是方便，用它可以很容易的实现任务栏图标功能，再结合ContextMenu组件就可以在任务栏图标上显示右键菜单，但是当ContextMenu组件的菜单项的OwnerDraw属性设置为true时，却不能正确显示自定义的菜单，微软已确认这是个BUG(http://support.microsoft.com/?id=827043)。</p><p>这是我自定义的右键菜单</p><p><img src="'+i+'" alt="img_1"><br> 设置NotifyIcon组件的ContextMenu属性</p><p><img src="'+l+'" alt="img_2"><br> 自定义菜单的效果不能正确显示</p><p><img src="'+r+`" alt="img_3"></p><p>有解决方法吗？当然！经过一些摸索，可以用Windows API来实现。<br> 方法是将NotifyIcon组件的ContextMenu属性设置为无，然后在NotifyIcon组件的MouseDown事件里加入下面代码：</p><div class="language-csharp" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Button <span class="token operator">==</span> MouseButtons<span class="token punctuation">.</span>Right<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//取得当前鼠标位置 </span>
    <span class="token class-name">Win32<span class="token punctuation">.</span>POINT</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestPopMenu<span class="token punctuation">.</span>Win32<span class="token punctuation">.</span>POINT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Win32<span class="token punctuation">.</span><span class="token function">GetCursorPos</span><span class="token punctuation">(</span><span class="token keyword">ref</span> point<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Win32<span class="token punctuation">.</span><span class="token function">SetForegroundWindow</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//显示菜单 </span>
    Win32<span class="token punctuation">.</span><span class="token function">TrackPopupMenuEx</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>contextMenu1<span class="token punctuation">.</span>Handle<span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> point<span class="token punctuation">.</span>x<span class="token punctuation">,</span> point<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Handle<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestPopMenu<span class="token punctuation">.</span>Win32<span class="token punctuation">.</span>TPMPARAMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>效果图</p><p><img src="`+k+'" alt="img_4"></p>',9),h={href:"https://files.cnblogs.com/ZDJ/TestPopMenu.rar",target:"_blank",rel:"noopener noreferrer"};function w(b,x){const a=p("ExternalLinkIcon");return e(),c("div",null,[n("h1",m,[d,s(),n("a",g,[s("在任务栏图标上显示自定义的右键菜单"),t(a)])]),f,n("p",null,[n("a",h,[s("演示代码下载"),t(a)])])])}const v=o(_,[["render",w],["__file","progmif9.html.vue"]]);export{v as default};
